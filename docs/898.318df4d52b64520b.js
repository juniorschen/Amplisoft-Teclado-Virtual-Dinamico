(self.webpackChunkamplisoft_dasher=self.webpackChunkamplisoft_dasher||[]).push([[898],{8898:(He,Ie,k)=>{"use strict";k.r(Ie),k.d(Ie,{DasherOnScreenModule:()=>je});var j=k(6895),ge=k(9814),G=k(284),B=k(9549),O=k(4006),i=k(4650),L=k(3238),y=k(1281);const S=["determinateSpinner"];function R(d,s){if(1&d&&(i.O4$(),i.TgZ(0,"svg",11),i._UZ(1,"circle",12),i.qZA()),2&d){const n=i.oxw();i.uIk("viewBox",n._viewBox()),i.xp6(1),i.Udp("stroke-dasharray",n._strokeCircumference(),"px")("stroke-dashoffset",n._strokeCircumference()/2,"px")("stroke-width",n._circleStrokeWidth(),"%"),i.uIk("r",n._circleRadius())}}const $=(0,L.pj)(class{constructor(d){this._elementRef=d}},"primary"),Y=new i.OlP("mat-progress-spinner-default-options",{providedIn:"root",factory:function N(){return{diameter:K}}}),K=100;let se=(()=>{class d extends ${constructor(n,r,l){super(n),this.mode="mat-spinner"===this._elementRef.nativeElement.nodeName.toLowerCase()?"indeterminate":"determinate",this._value=0,this._diameter=K,this._noopAnimations="NoopAnimations"===r&&!!l&&!l._forceAnimations,l&&(l.color&&(this.color=this.defaultColor=l.color),l.diameter&&(this.diameter=l.diameter),l.strokeWidth&&(this.strokeWidth=l.strokeWidth))}get value(){return"determinate"===this.mode?this._value:0}set value(n){this._value=Math.max(0,Math.min(100,(0,y.su)(n)))}get diameter(){return this._diameter}set diameter(n){this._diameter=(0,y.su)(n)}get strokeWidth(){return this._strokeWidth??this.diameter/10}set strokeWidth(n){this._strokeWidth=(0,y.su)(n)}_circleRadius(){return(this.diameter-10)/2}_viewBox(){const n=2*this._circleRadius()+this.strokeWidth;return`0 0 ${n} ${n}`}_strokeCircumference(){return 2*Math.PI*this._circleRadius()}_strokeDashOffset(){return"determinate"===this.mode?this._strokeCircumference()*(100-this._value)/100:null}_circleStrokeWidth(){return this.strokeWidth/this.diameter*100}}return d.\u0275fac=function(n){return new(n||d)(i.Y36(i.SBq),i.Y36(i.QbO,8),i.Y36(Y))},d.\u0275cmp=i.Xpm({type:d,selectors:[["mat-progress-spinner"],["mat-spinner"]],viewQuery:function(n,r){if(1&n&&i.Gf(S,5),2&n){let l;i.iGM(l=i.CRH())&&(r._determinateCircle=l.first)}},hostAttrs:["role","progressbar","tabindex","-1",1,"mat-mdc-progress-spinner","mdc-circular-progress"],hostVars:12,hostBindings:function(n,r){2&n&&(i.uIk("aria-valuemin",0)("aria-valuemax",100)("aria-valuenow","determinate"===r.mode?r.value:null)("mode",r.mode),i.Udp("width",r.diameter,"px")("height",r.diameter,"px"),i.ekj("_mat-animation-noopable",r._noopAnimations)("mdc-circular-progress--indeterminate","indeterminate"===r.mode))},inputs:{color:"color",mode:"mode",value:"value",diameter:"diameter",strokeWidth:"strokeWidth"},exportAs:["matProgressSpinner"],features:[i.qOj],decls:14,vars:11,consts:[["circle",""],["aria-hidden","true",1,"mdc-circular-progress__determinate-container"],["determinateSpinner",""],["xmlns","http://www.w3.org/2000/svg","focusable","false",1,"mdc-circular-progress__determinate-circle-graphic"],["cx","50%","cy","50%",1,"mdc-circular-progress__determinate-circle"],["aria-hidden","true",1,"mdc-circular-progress__indeterminate-container"],[1,"mdc-circular-progress__spinner-layer"],[1,"mdc-circular-progress__circle-clipper","mdc-circular-progress__circle-left"],[3,"ngTemplateOutlet"],[1,"mdc-circular-progress__gap-patch"],[1,"mdc-circular-progress__circle-clipper","mdc-circular-progress__circle-right"],["xmlns","http://www.w3.org/2000/svg","focusable","false",1,"mdc-circular-progress__indeterminate-circle-graphic"],["cx","50%","cy","50%"]],template:function(n,r){if(1&n&&(i.YNc(0,R,2,8,"ng-template",null,0,i.W1O),i.TgZ(2,"div",1,2),i.O4$(),i.TgZ(4,"svg",3),i._UZ(5,"circle",4),i.qZA()(),i.kcU(),i.TgZ(6,"div",5)(7,"div",6)(8,"div",7),i.GkF(9,8),i.qZA(),i.TgZ(10,"div",9),i.GkF(11,8),i.qZA(),i.TgZ(12,"div",10),i.GkF(13,8),i.qZA()()()),2&n){const l=i.MAs(1);i.xp6(4),i.uIk("viewBox",r._viewBox()),i.xp6(1),i.Udp("stroke-dasharray",r._strokeCircumference(),"px")("stroke-dashoffset",r._strokeDashOffset(),"px")("stroke-width",r._circleStrokeWidth(),"%"),i.uIk("r",r._circleRadius()),i.xp6(4),i.Q6J("ngTemplateOutlet",l),i.xp6(2),i.Q6J("ngTemplateOutlet",l),i.xp6(2),i.Q6J("ngTemplateOutlet",l)}},dependencies:[j.tP],styles:["@keyframes mdc-circular-progress-container-rotate{to{transform:rotate(360deg)}}@keyframes mdc-circular-progress-spinner-layer-rotate{12.5%{transform:rotate(135deg)}25%{transform:rotate(270deg)}37.5%{transform:rotate(405deg)}50%{transform:rotate(540deg)}62.5%{transform:rotate(675deg)}75%{transform:rotate(810deg)}87.5%{transform:rotate(945deg)}100%{transform:rotate(1080deg)}}@keyframes mdc-circular-progress-color-1-fade-in-out{from{opacity:.99}25%{opacity:.99}26%{opacity:0}89%{opacity:0}90%{opacity:.99}to{opacity:.99}}@keyframes mdc-circular-progress-color-2-fade-in-out{from{opacity:0}15%{opacity:0}25%{opacity:.99}50%{opacity:.99}51%{opacity:0}to{opacity:0}}@keyframes mdc-circular-progress-color-3-fade-in-out{from{opacity:0}40%{opacity:0}50%{opacity:.99}75%{opacity:.99}76%{opacity:0}to{opacity:0}}@keyframes mdc-circular-progress-color-4-fade-in-out{from{opacity:0}65%{opacity:0}75%{opacity:.99}90%{opacity:.99}to{opacity:0}}@keyframes mdc-circular-progress-left-spin{from{transform:rotate(265deg)}50%{transform:rotate(130deg)}to{transform:rotate(265deg)}}@keyframes mdc-circular-progress-right-spin{from{transform:rotate(-265deg)}50%{transform:rotate(-130deg)}to{transform:rotate(-265deg)}}.mdc-circular-progress{display:inline-flex;position:relative;direction:ltr;line-height:0;transition:opacity 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-circular-progress__determinate-container,.mdc-circular-progress__indeterminate-circle-graphic,.mdc-circular-progress__indeterminate-container,.mdc-circular-progress__spinner-layer{position:absolute;width:100%;height:100%}.mdc-circular-progress__determinate-container{transform:rotate(-90deg)}.mdc-circular-progress__indeterminate-container{font-size:0;letter-spacing:0;white-space:nowrap;opacity:0}.mdc-circular-progress__determinate-circle-graphic,.mdc-circular-progress__indeterminate-circle-graphic{fill:rgba(0,0,0,0)}.mdc-circular-progress__determinate-circle{transition:stroke-dashoffset 500ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-circular-progress__gap-patch{position:absolute;top:0;left:47.5%;box-sizing:border-box;width:5%;height:100%;overflow:hidden}.mdc-circular-progress__gap-patch .mdc-circular-progress__indeterminate-circle-graphic{left:-900%;width:2000%;transform:rotate(180deg)}.mdc-circular-progress__circle-clipper{display:inline-flex;position:relative;width:50%;height:100%;overflow:hidden}.mdc-circular-progress__circle-clipper .mdc-circular-progress__indeterminate-circle-graphic{width:200%}.mdc-circular-progress__circle-right .mdc-circular-progress__indeterminate-circle-graphic{left:-100%}.mdc-circular-progress--indeterminate .mdc-circular-progress__determinate-container{opacity:0}.mdc-circular-progress--indeterminate .mdc-circular-progress__indeterminate-container{opacity:1}.mdc-circular-progress--indeterminate .mdc-circular-progress__indeterminate-container{animation:mdc-circular-progress-container-rotate 1568.2352941176ms linear infinite}.mdc-circular-progress--indeterminate .mdc-circular-progress__spinner-layer{animation:mdc-circular-progress-spinner-layer-rotate 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__color-1{animation:mdc-circular-progress-spinner-layer-rotate 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both,mdc-circular-progress-color-1-fade-in-out 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__color-2{animation:mdc-circular-progress-spinner-layer-rotate 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both,mdc-circular-progress-color-2-fade-in-out 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__color-3{animation:mdc-circular-progress-spinner-layer-rotate 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both,mdc-circular-progress-color-3-fade-in-out 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__color-4{animation:mdc-circular-progress-spinner-layer-rotate 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both,mdc-circular-progress-color-4-fade-in-out 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__circle-left .mdc-circular-progress__indeterminate-circle-graphic{animation:mdc-circular-progress-left-spin 1333ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__circle-right .mdc-circular-progress__indeterminate-circle-graphic{animation:mdc-circular-progress-right-spin 1333ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--closed{opacity:0}.mat-mdc-progress-spinner{display:block;overflow:hidden;line-height:0}.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle,.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic{stroke:var(--mdc-circular-progress-active-indicator-color, transparent)}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle,.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mat-mdc-progress-spinner .mdc-circular-progress--four-color .mdc-circular-progress__color-1 .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mat-mdc-progress-spinner .mdc-circular-progress--four-color .mdc-circular-progress__color-2 .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mat-mdc-progress-spinner .mdc-circular-progress--four-color .mdc-circular-progress__color-3 .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mat-mdc-progress-spinner .mdc-circular-progress--four-color .mdc-circular-progress__color-4 .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}.mat-mdc-progress-spinner._mat-animation-noopable,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__determinate-circle{transition:none}.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-circle-graphic,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__spinner-layer,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-container{animation:none}.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-container circle{stroke-dasharray:0 !important}.cdk-high-contrast-active .mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic,.cdk-high-contrast-active .mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle{stroke:currentColor;stroke:CanvasText}"],encapsulation:2,changeDetection:0}),d})(),ne=(()=>{class d{}return d.\u0275fac=function(n){return new(n||d)},d.\u0275mod=i.oAB({type:d}),d.\u0275inj=i.cJS({imports:[j.ez,L.BQ]}),d})();var Ve=k(7392),Oe=k(4883),H=k(3353),Ze=k(2687),V=k(7579),ie=k(727),P=k(4986),ye=k(5963),me=k(6406),fe=k(9751),M=k(6451),Pe=k(2722),F=k(4004),D=k(5698),ke=k(8675),Ye=k(8505),at=k(3900),Xe=k(445);function Re(d,s,n){for(let r in s)if(s.hasOwnProperty(r)){const l=s[r];l?d.setProperty(r,l,n?.has(r)?"important":""):d.removeProperty(r)}return d}function De(d,s){const n=s?"":"none";Re(d.style,{"touch-action":s?"":"none","-webkit-user-drag":s?"":"none","-webkit-tap-highlight-color":s?"":"transparent","user-select":n,"-ms-user-select":n,"-webkit-user-select":n,"-moz-user-select":n})}function Te(d,s,n){Re(d.style,{position:s?"":"fixed",top:s?"":"0",opacity:s?"":"0",left:s?"":"-999em"},n)}function Ae(d,s){return s&&"none"!=s?d+" "+s:d}function he(d){const s=d.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(d)*s}function ve(d,s){return d.getPropertyValue(s).split(",").map(r=>r.trim())}function Le(d){const s=d.getBoundingClientRect();return{top:s.top,right:s.right,bottom:s.bottom,left:s.left,width:s.width,height:s.height,x:s.x,y:s.y}}function oe(d,s,n){const{top:r,bottom:l,left:u,right:p}=d;return n>=r&&n<=l&&s>=u&&s<=p}function _e(d,s,n){d.top+=s,d.bottom=d.top+d.height,d.left+=n,d.right=d.left+d.width}function qe(d,s,n,r){const{top:l,right:u,bottom:p,left:m,width:_,height:w}=d,T=_*s,J=w*s;return r>l-J&&r<p+J&&n>m-T&&n<u+T}class e{constructor(s){this._document=s,this.positions=new Map}clear(){this.positions.clear()}cache(s){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),s.forEach(n=>{this.positions.set(n,{scrollPosition:{top:n.scrollTop,left:n.scrollLeft},clientRect:Le(n)})})}handleScroll(s){const n=(0,H.sA)(s),r=this.positions.get(n);if(!r)return null;const l=r.scrollPosition;let u,p;if(n===this._document){const w=this.getViewportScrollPosition();u=w.top,p=w.left}else u=n.scrollTop,p=n.scrollLeft;const m=l.top-u,_=l.left-p;return this.positions.forEach((w,T)=>{w.clientRect&&n!==T&&n.contains(T)&&_e(w.clientRect,m,_)}),l.top=u,l.left=p,{top:m,left:_}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}}function t(d){const s=d.cloneNode(!0),n=s.querySelectorAll("[id]"),r=d.nodeName.toLowerCase();s.removeAttribute("id");for(let l=0;l<n.length;l++)n[l].removeAttribute("id");return"canvas"===r?h(d,s):("input"===r||"select"===r||"textarea"===r)&&c(d,s),o("canvas",d,s,h),o("input, textarea, select",d,s,c),s}function o(d,s,n,r){const l=s.querySelectorAll(d);if(l.length){const u=n.querySelectorAll(d);for(let p=0;p<l.length;p++)r(l[p],u[p])}}let a=0;function c(d,s){"file"!==s.type&&(s.value=d.value),"radio"===s.type&&s.name&&(s.name=`mat-clone-${s.name}-${a++}`)}function h(d,s){const n=s.getContext("2d");if(n)try{n.drawImage(d,0,0)}catch{}}const f=(0,H.i$)({passive:!0}),g=(0,H.i$)({passive:!1}),b=new Set(["position"]);class E{constructor(s,n,r,l,u,p){this._config=n,this._document=r,this._ngZone=l,this._viewportRuler=u,this._dragDropRegistry=p,this._passiveTransform={x:0,y:0},this._activeTransform={x:0,y:0},this._hasStartedDragging=!1,this._moveEvents=new V.x,this._pointerMoveSubscription=ie.w0.EMPTY,this._pointerUpSubscription=ie.w0.EMPTY,this._scrollSubscription=ie.w0.EMPTY,this._resizeSubscription=ie.w0.EMPTY,this._boundaryElement=null,this._nativeInteractionsEnabled=!0,this._handles=[],this._disabledHandles=new Set,this._direction="ltr",this.dragStartDelay=0,this._disabled=!1,this.beforeStarted=new V.x,this.started=new V.x,this.released=new V.x,this.ended=new V.x,this.entered=new V.x,this.exited=new V.x,this.dropped=new V.x,this.moved=this._moveEvents,this._pointerDown=m=>{if(this.beforeStarted.next(),this._handles.length){const _=this._getTargetHandle(m);_&&!this._disabledHandles.has(_)&&!this.disabled&&this._initializeDragSequence(_,m)}else this.disabled||this._initializeDragSequence(this._rootElement,m)},this._pointerMove=m=>{const _=this._getPointerPositionOnPage(m);if(!this._hasStartedDragging){if(Math.abs(_.x-this._pickupPositionOnPage.x)+Math.abs(_.y-this._pickupPositionOnPage.y)>=this._config.dragStartThreshold){const Ce=Date.now()>=this._dragStartTime+this._getDragStartDelay(m),xe=this._dropContainer;if(!Ce)return void this._endDragSequence(m);(!xe||!xe.isDragging()&&!xe.isReceiving())&&(m.preventDefault(),this._hasStartedDragging=!0,this._ngZone.run(()=>this._startDragSequence(m)))}return}m.preventDefault();const w=this._getConstrainedPointerPosition(_);if(this._hasMoved=!0,this._lastKnownPointerPosition=_,this._updatePointerDirectionDelta(w),this._dropContainer)this._updateActiveDropContainer(w,_);else{const T=this.constrainPosition?this._initialClientRect:this._pickupPositionOnPage,J=this._activeTransform;J.x=w.x-T.x+this._passiveTransform.x,J.y=w.y-T.y+this._passiveTransform.y,this._applyRootElementTransform(J.x,J.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:w,event:m,distance:this._getDragDistance(w),delta:this._pointerDirectionDelta})})},this._pointerUp=m=>{this._endDragSequence(m)},this._nativeDragStart=m=>{if(this._handles.length){const _=this._getTargetHandle(m);_&&!this._disabledHandles.has(_)&&!this.disabled&&m.preventDefault()}else this.disabled||m.preventDefault()},this.withRootElement(s).withParent(n.parentDragRef||null),this._parentPositions=new e(r),p.registerDragItem(this)}get disabled(){return this._disabled||!(!this._dropContainer||!this._dropContainer.disabled)}set disabled(s){const n=(0,y.Ig)(s);n!==this._disabled&&(this._disabled=n,this._toggleNativeDragInteractions(),this._handles.forEach(r=>De(r,n)))}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(s){this._handles=s.map(r=>(0,y.fI)(r)),this._handles.forEach(r=>De(r,this.disabled)),this._toggleNativeDragInteractions();const n=new Set;return this._disabledHandles.forEach(r=>{this._handles.indexOf(r)>-1&&n.add(r)}),this._disabledHandles=n,this}withPreviewTemplate(s){return this._previewTemplate=s,this}withPlaceholderTemplate(s){return this._placeholderTemplate=s,this}withRootElement(s){const n=(0,y.fI)(s);return n!==this._rootElement&&(this._rootElement&&this._removeRootElementListeners(this._rootElement),this._ngZone.runOutsideAngular(()=>{n.addEventListener("mousedown",this._pointerDown,g),n.addEventListener("touchstart",this._pointerDown,f),n.addEventListener("dragstart",this._nativeDragStart,g)}),this._initialTransform=void 0,this._rootElement=n),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(s){return this._boundaryElement=s?(0,y.fI)(s):null,this._resizeSubscription.unsubscribe(),s&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(s){return this._parentDragRef=s,this}dispose(){this._removeRootElementListeners(this._rootElement),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeSubscriptions(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(s){!this._disabledHandles.has(s)&&this._handles.indexOf(s)>-1&&(this._disabledHandles.add(s),De(s,!0))}enableHandle(s){this._disabledHandles.has(s)&&(this._disabledHandles.delete(s),De(s,this.disabled))}withDirection(s){return this._direction=s,this}_withDropContainer(s){this._dropContainer=s}getFreeDragPosition(){const s=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:s.x,y:s.y}}setFreeDragPosition(s){return this._activeTransform={x:0,y:0},this._passiveTransform.x=s.x,this._passiveTransform.y=s.y,this._dropContainer||this._applyRootElementTransform(s.x,s.y),this}withPreviewContainer(s){return this._previewContainer=s,this}_sortFromLastPointerPosition(){const s=this._lastKnownPointerPosition;s&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(s),s)}_removeSubscriptions(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe()}_destroyPreview(){this._preview?.remove(),this._previewRef?.destroy(),this._preview=this._previewRef=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_endDragSequence(s){if(this._dragDropRegistry.isDragging(this)&&(this._removeSubscriptions(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),this._hasStartedDragging))if(this.released.next({source:this,event:s}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(s),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;const n=this._getPointerPositionOnPage(s);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(n),dropPoint:n,event:s})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(s){I(s)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();const n=this._dropContainer;if(n){const r=this._rootElement,l=r.parentNode,u=this._placeholder=this._createPlaceholderElement(),p=this._anchor=this._anchor||this._document.createComment(""),m=this._getShadowRoot();l.insertBefore(p,r),this._initialTransform=r.style.transform||"",this._preview=this._createPreviewElement(),Te(r,!1,b),this._document.body.appendChild(l.replaceChild(u,r)),this._getPreviewInsertionPoint(l,m).appendChild(this._preview),this.started.next({source:this,event:s}),n.start(),this._initialContainer=n,this._initialIndex=n.getItemIndex(this)}else this.started.next({source:this,event:s}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(n?n.getScrollableParents():[])}_initializeDragSequence(s,n){this._parentDragRef&&n.stopPropagation();const r=this.isDragging(),l=I(n),u=!l&&0!==n.button,p=this._rootElement,m=(0,H.sA)(n),_=!l&&this._lastTouchEventTime&&this._lastTouchEventTime+800>Date.now(),w=l?(0,Ze.yG)(n):(0,Ze.X6)(n);if(m&&m.draggable&&"mousedown"===n.type&&n.preventDefault(),r||u||_||w)return;if(this._handles.length){const U=p.style;this._rootElementTapHighlight=U.webkitTapHighlightColor||"",U.webkitTapHighlightColor="transparent"}this._hasStartedDragging=this._hasMoved=!1,this._removeSubscriptions(),this._initialClientRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(U=>this._updateOnScroll(U)),this._boundaryElement&&(this._boundaryRect=Le(this._boundaryElement));const T=this._previewTemplate;this._pickupPositionInElement=T&&T.template&&!T.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialClientRect,s,n);const J=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(n);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:J.x,y:J.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,n)}_cleanupDragArtifacts(s){Te(this._rootElement,!0,b),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialClientRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{const n=this._dropContainer,r=n.getItemIndex(this),l=this._getPointerPositionOnPage(s),u=this._getDragDistance(l),p=n._isOverContainer(l.x,l.y);this.ended.next({source:this,distance:u,dropPoint:l,event:s}),this.dropped.next({item:this,currentIndex:r,previousIndex:this._initialIndex,container:n,previousContainer:this._initialContainer,isPointerOverContainer:p,distance:u,dropPoint:l,event:s}),n.drop(this,r,this._initialIndex,this._initialContainer,p,u,l,s),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:s,y:n},{x:r,y:l}){let u=this._initialContainer._getSiblingContainerFromPosition(this,s,n);!u&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(s,n)&&(u=this._initialContainer),u&&u!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=u,this._dropContainer.enter(this,s,n,u===this._initialContainer&&u.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:u,currentIndex:u.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(r,l),this._dropContainer._sortItem(this,s,n,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(s,n):this._applyPreviewTransform(s-this._pickupPositionInElement.x,n-this._pickupPositionInElement.y))}_createPreviewElement(){const s=this._previewTemplate,n=this.previewClass,r=s?s.template:null;let l;if(r&&s){const u=s.matchSize?this._initialClientRect:null,p=s.viewContainer.createEmbeddedView(r,s.context);p.detectChanges(),l=A(p,this._document),this._previewRef=p,s.matchSize?q(l,u):l.style.transform=C(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else l=t(this._rootElement),q(l,this._initialClientRect),this._initialTransform&&(l.style.transform=this._initialTransform);return Re(l.style,{"pointer-events":"none",margin:"0",position:"fixed",top:"0",left:"0","z-index":`${this._config.zIndex||1e3}`},b),De(l,!1),l.classList.add("cdk-drag-preview"),l.setAttribute("dir",this._direction),n&&(Array.isArray(n)?n.forEach(u=>l.classList.add(u)):l.classList.add(n)),l}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();const s=this._placeholder.getBoundingClientRect();this._preview.classList.add("cdk-drag-animating"),this._applyPreviewTransform(s.left,s.top);const n=function de(d){const s=getComputedStyle(d),n=ve(s,"transition-property"),r=n.find(m=>"transform"===m||"all"===m);if(!r)return 0;const l=n.indexOf(r),u=ve(s,"transition-duration"),p=ve(s,"transition-delay");return he(u[l])+he(p[l])}(this._preview);return 0===n?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(r=>{const l=p=>{(!p||(0,H.sA)(p)===this._preview&&"transform"===p.propertyName)&&(this._preview?.removeEventListener("transitionend",l),r(),clearTimeout(u))},u=setTimeout(l,1.5*n);this._preview.addEventListener("transitionend",l)}))}_createPlaceholderElement(){const s=this._placeholderTemplate,n=s?s.template:null;let r;return n?(this._placeholderRef=s.viewContainer.createEmbeddedView(n,s.context),this._placeholderRef.detectChanges(),r=A(this._placeholderRef,this._document)):r=t(this._rootElement),r.style.pointerEvents="none",r.classList.add("cdk-drag-placeholder"),r}_getPointerPositionInElement(s,n,r){const l=n===this._rootElement?null:n,u=l?l.getBoundingClientRect():s,p=I(r)?r.targetTouches[0]:r,m=this._getViewportScrollPosition();return{x:u.left-s.left+(p.pageX-u.left-m.left),y:u.top-s.top+(p.pageY-u.top-m.top)}}_getPointerPositionOnPage(s){const n=this._getViewportScrollPosition(),r=I(s)?s.touches[0]||s.changedTouches[0]||{pageX:0,pageY:0}:s,l=r.pageX-n.left,u=r.pageY-n.top;if(this._ownerSVGElement){const p=this._ownerSVGElement.getScreenCTM();if(p){const m=this._ownerSVGElement.createSVGPoint();return m.x=l,m.y=u,m.matrixTransform(p.inverse())}}return{x:l,y:u}}_getConstrainedPointerPosition(s){const n=this._dropContainer?this._dropContainer.lockAxis:null;let{x:r,y:l}=this.constrainPosition?this.constrainPosition(s,this,this._initialClientRect,this._pickupPositionInElement):s;if("x"===this.lockAxis||"x"===n?l=this._pickupPositionOnPage.y:("y"===this.lockAxis||"y"===n)&&(r=this._pickupPositionOnPage.x),this._boundaryRect){const{x:u,y:p}=this._pickupPositionInElement,m=this._boundaryRect,{width:_,height:w}=this._getPreviewRect(),T=m.top+p,J=m.bottom-(w-p);r=x(r,m.left+u,m.right-(_-u)),l=x(l,T,J)}return{x:r,y:l}}_updatePointerDirectionDelta(s){const{x:n,y:r}=s,l=this._pointerDirectionDelta,u=this._pointerPositionAtLastDirectionChange,p=Math.abs(n-u.x),m=Math.abs(r-u.y);return p>this._config.pointerDirectionChangeThreshold&&(l.x=n>u.x?1:-1,u.x=n),m>this._config.pointerDirectionChangeThreshold&&(l.y=r>u.y?1:-1,u.y=r),l}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;const s=this._handles.length>0||!this.isDragging();s!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=s,De(this._rootElement,s))}_removeRootElementListeners(s){s.removeEventListener("mousedown",this._pointerDown,g),s.removeEventListener("touchstart",this._pointerDown,f),s.removeEventListener("dragstart",this._nativeDragStart,g)}_applyRootElementTransform(s,n){const r=C(s,n),l=this._rootElement.style;null==this._initialTransform&&(this._initialTransform=l.transform&&"none"!=l.transform?l.transform:""),l.transform=Ae(r,this._initialTransform)}_applyPreviewTransform(s,n){const r=this._previewTemplate?.template?void 0:this._initialTransform,l=C(s,n);this._preview.style.transform=Ae(l,r)}_getDragDistance(s){const n=this._pickupPositionOnPage;return n?{x:s.x-n.x,y:s.y-n.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:s,y:n}=this._passiveTransform;if(0===s&&0===n||this.isDragging()||!this._boundaryElement)return;const r=this._rootElement.getBoundingClientRect(),l=this._boundaryElement.getBoundingClientRect();if(0===l.width&&0===l.height||0===r.width&&0===r.height)return;const u=l.left-r.left,p=r.right-l.right,m=l.top-r.top,_=r.bottom-l.bottom;l.width>r.width?(u>0&&(s+=u),p>0&&(s-=p)):s=0,l.height>r.height?(m>0&&(n+=m),_>0&&(n-=_)):n=0,(s!==this._passiveTransform.x||n!==this._passiveTransform.y)&&this.setFreeDragPosition({y:n,x:s})}_getDragStartDelay(s){const n=this.dragStartDelay;return"number"==typeof n?n:I(s)?n.touch:n?n.mouse:0}_updateOnScroll(s){const n=this._parentPositions.handleScroll(s);if(n){const r=(0,H.sA)(s);this._boundaryRect&&r!==this._boundaryElement&&r.contains(this._boundaryElement)&&_e(this._boundaryRect,n.top,n.left),this._pickupPositionOnPage.x+=n.left,this._pickupPositionOnPage.y+=n.top,this._dropContainer||(this._activeTransform.x-=n.left,this._activeTransform.y-=n.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return void 0===this._cachedShadowRoot&&(this._cachedShadowRoot=(0,H.kV)(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(s,n){const r=this._previewContainer||"global";if("parent"===r)return s;if("global"===r){const l=this._document;return n||l.fullscreenElement||l.webkitFullscreenElement||l.mozFullScreenElement||l.msFullscreenElement||l.body}return(0,y.fI)(r)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialClientRect),this._previewRect}_getTargetHandle(s){return this._handles.find(n=>s.target&&(s.target===n||n.contains(s.target)))}}function C(d,s){return`translate3d(${Math.round(d)}px, ${Math.round(s)}px, 0)`}function x(d,s,n){return Math.max(s,Math.min(n,d))}function I(d){return"t"===d.type[0]}function A(d,s){const n=d.rootNodes;if(1===n.length&&n[0].nodeType===s.ELEMENT_NODE)return n[0];const r=s.createElement("div");return n.forEach(l=>r.appendChild(l)),r}function q(d,s){d.style.width=`${s.width}px`,d.style.height=`${s.height}px`,d.style.transform=C(s.left,s.top)}function Q(d,s){return Math.max(0,Math.min(s,d))}class le{constructor(s,n){this._element=s,this._dragDropRegistry=n,this._itemPositions=[],this.orientation="vertical",this._previousSwap={drag:null,delta:0,overlaps:!1}}start(s){this.withItems(s)}sort(s,n,r,l){const u=this._itemPositions,p=this._getItemIndexFromPointerPosition(s,n,r,l);if(-1===p&&u.length>0)return null;const m="horizontal"===this.orientation,_=u.findIndex(ce=>ce.drag===s),w=u[p],J=w.clientRect,U=_>p?1:-1,Ce=this._getItemOffsetPx(u[_].clientRect,J,U),xe=this._getSiblingOffsetPx(_,u,U),Fe=u.slice();return function ee(d,s,n){const r=Q(s,d.length-1),l=Q(n,d.length-1);if(r===l)return;const u=d[r],p=l<r?-1:1;for(let m=r;m!==l;m+=p)d[m]=d[m+p];d[l]=u}(u,_,p),u.forEach((ce,Gi)=>{if(Fe[Gi]===ce)return;const bt=ce.drag===s,ot=bt?Ce:xe,Et=bt?s.getPlaceholderElement():ce.drag.getRootElement();ce.offset+=ot,m?(Et.style.transform=Ae(`translate3d(${Math.round(ce.offset)}px, 0, 0)`,ce.initialTransform),_e(ce.clientRect,0,ot)):(Et.style.transform=Ae(`translate3d(0, ${Math.round(ce.offset)}px, 0)`,ce.initialTransform),_e(ce.clientRect,ot,0))}),this._previousSwap.overlaps=oe(J,n,r),this._previousSwap.drag=w.drag,this._previousSwap.delta=m?l.x:l.y,{previousIndex:_,currentIndex:p}}enter(s,n,r,l){const u=null==l||l<0?this._getItemIndexFromPointerPosition(s,n,r):l,p=this._activeDraggables,m=p.indexOf(s),_=s.getPlaceholderElement();let w=p[u];if(w===s&&(w=p[u+1]),!w&&(null==u||-1===u||u<p.length-1)&&this._shouldEnterAsFirstChild(n,r)&&(w=p[0]),m>-1&&p.splice(m,1),w&&!this._dragDropRegistry.isDragging(w)){const T=w.getRootElement();T.parentElement.insertBefore(_,T),p.splice(u,0,s)}else(0,y.fI)(this._element).appendChild(_),p.push(s);_.style.transform="",this._cacheItemPositions()}withItems(s){this._activeDraggables=s.slice(),this._cacheItemPositions()}withSortPredicate(s){this._sortPredicate=s}reset(){this._activeDraggables.forEach(s=>{const n=s.getRootElement();if(n){const r=this._itemPositions.find(l=>l.drag===s)?.initialTransform;n.style.transform=r||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(s){return("horizontal"===this.orientation&&"rtl"===this.direction?this._itemPositions.slice().reverse():this._itemPositions).findIndex(r=>r.drag===s)}updateOnScroll(s,n){this._itemPositions.forEach(({clientRect:r})=>{_e(r,s,n)}),this._itemPositions.forEach(({drag:r})=>{this._dragDropRegistry.isDragging(r)&&r._sortFromLastPointerPosition()})}_cacheItemPositions(){const s="horizontal"===this.orientation;this._itemPositions=this._activeDraggables.map(n=>{const r=n.getVisibleElement();return{drag:n,offset:0,initialTransform:r.style.transform||"",clientRect:Le(r)}}).sort((n,r)=>s?n.clientRect.left-r.clientRect.left:n.clientRect.top-r.clientRect.top)}_getItemOffsetPx(s,n,r){const l="horizontal"===this.orientation;let u=l?n.left-s.left:n.top-s.top;return-1===r&&(u+=l?n.width-s.width:n.height-s.height),u}_getSiblingOffsetPx(s,n,r){const l="horizontal"===this.orientation,u=n[s].clientRect,p=n[s+-1*r];let m=u[l?"width":"height"]*r;if(p){const _=l?"left":"top",w=l?"right":"bottom";-1===r?m-=p.clientRect[_]-u[w]:m+=u[_]-p.clientRect[w]}return m}_shouldEnterAsFirstChild(s,n){if(!this._activeDraggables.length)return!1;const r=this._itemPositions,l="horizontal"===this.orientation;if(r[0].drag!==this._activeDraggables[0]){const p=r[r.length-1].clientRect;return l?s>=p.right:n>=p.bottom}{const p=r[0].clientRect;return l?s<=p.left:n<=p.top}}_getItemIndexFromPointerPosition(s,n,r,l){const u="horizontal"===this.orientation,p=this._itemPositions.findIndex(({drag:m,clientRect:_})=>{if(m===s)return!1;if(l){const w=u?l.x:l.y;if(m===this._previousSwap.drag&&this._previousSwap.overlaps&&w===this._previousSwap.delta)return!1}return u?n>=Math.floor(_.left)&&n<Math.floor(_.right):r>=Math.floor(_.top)&&r<Math.floor(_.bottom)});return-1!==p&&this._sortPredicate(p,s)?p:-1}}class Me{constructor(s,n,r,l,u){this._dragDropRegistry=n,this._ngZone=l,this._viewportRuler=u,this.disabled=!1,this.sortingDisabled=!1,this.autoScrollDisabled=!1,this.autoScrollStep=2,this.enterPredicate=()=>!0,this.sortPredicate=()=>!0,this.beforeStarted=new V.x,this.entered=new V.x,this.exited=new V.x,this.dropped=new V.x,this.sorted=new V.x,this._isDragging=!1,this._draggables=[],this._siblings=[],this._activeSiblings=new Set,this._viewportScrollSubscription=ie.w0.EMPTY,this._verticalScrollDirection=0,this._horizontalScrollDirection=0,this._stopScrollTimers=new V.x,this._cachedShadowRoot=null,this._startScrollInterval=()=>{this._stopScrolling(),function ue(d=0,s=P.z){return d<0&&(d=0),(0,ye.H)(d,d,s)}(0,me.Z).pipe((0,Pe.R)(this._stopScrollTimers)).subscribe(()=>{const p=this._scrollNode,m=this.autoScrollStep;1===this._verticalScrollDirection?p.scrollBy(0,-m):2===this._verticalScrollDirection&&p.scrollBy(0,m),1===this._horizontalScrollDirection?p.scrollBy(-m,0):2===this._horizontalScrollDirection&&p.scrollBy(m,0)})},this.element=(0,y.fI)(s),this._document=r,this.withScrollableParents([this.element]),n.registerDropContainer(this),this._parentPositions=new e(r),this._sortStrategy=new le(this.element,n),this._sortStrategy.withSortPredicate((p,m)=>this.sortPredicate(p,m,this))}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(s,n,r,l){this._draggingStarted(),null==l&&this.sortingDisabled&&(l=this._draggables.indexOf(s)),this._sortStrategy.enter(s,n,r,l),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:s,container:this,currentIndex:this.getItemIndex(s)})}exit(s){this._reset(),this.exited.next({item:s,container:this})}drop(s,n,r,l,u,p,m,_={}){this._reset(),this.dropped.next({item:s,currentIndex:n,previousIndex:r,container:this,previousContainer:l,isPointerOverContainer:u,distance:p,dropPoint:m,event:_})}withItems(s){const n=this._draggables;return this._draggables=s,s.forEach(r=>r._withDropContainer(this)),this.isDragging()&&(n.filter(l=>l.isDragging()).every(l=>-1===s.indexOf(l))?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(s){return this._sortStrategy.direction=s,this}connectedTo(s){return this._siblings=s.slice(),this}withOrientation(s){return this._sortStrategy.orientation=s,this}withScrollableParents(s){const n=(0,y.fI)(this.element);return this._scrollableElements=-1===s.indexOf(n)?[n,...s]:s.slice(),this}getScrollableParents(){return this._scrollableElements}getItemIndex(s){return this._isDragging?this._sortStrategy.getItemIndex(s):this._draggables.indexOf(s)}isReceiving(){return this._activeSiblings.size>0}_sortItem(s,n,r,l){if(this.sortingDisabled||!this._clientRect||!qe(this._clientRect,.05,n,r))return;const u=this._sortStrategy.sort(s,n,r,l);u&&this.sorted.next({previousIndex:u.previousIndex,currentIndex:u.currentIndex,container:this,item:s})}_startScrollingIfNecessary(s,n){if(this.autoScrollDisabled)return;let r,l=0,u=0;if(this._parentPositions.positions.forEach((p,m)=>{m===this._document||!p.clientRect||r||qe(p.clientRect,.05,s,n)&&([l,u]=function St(d,s,n,r){const l=lt(s,r),u=ct(s,n);let p=0,m=0;if(l){const _=d.scrollTop;1===l?_>0&&(p=1):d.scrollHeight-_>d.clientHeight&&(p=2)}if(u){const _=d.scrollLeft;1===u?_>0&&(m=1):d.scrollWidth-_>d.clientWidth&&(m=2)}return[p,m]}(m,p.clientRect,s,n),(l||u)&&(r=m))}),!l&&!u){const{width:p,height:m}=this._viewportRuler.getViewportSize(),_={width:p,height:m,top:0,right:p,bottom:m,left:0};l=lt(_,n),u=ct(_,s),r=window}r&&(l!==this._verticalScrollDirection||u!==this._horizontalScrollDirection||r!==this._scrollNode)&&(this._verticalScrollDirection=l,this._horizontalScrollDirection=u,this._scrollNode=r,(l||u)&&r?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){const s=(0,y.fI)(this.element).style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=s.msScrollSnapType||s.scrollSnapType||"",s.scrollSnapType=s.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){const s=(0,y.fI)(this.element);this._parentPositions.cache(this._scrollableElements),this._clientRect=this._parentPositions.positions.get(s).clientRect}_reset(){this._isDragging=!1;const s=(0,y.fI)(this.element).style;s.scrollSnapType=s.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(n=>n._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_isOverContainer(s,n){return null!=this._clientRect&&oe(this._clientRect,s,n)}_getSiblingContainerFromPosition(s,n,r){return this._siblings.find(l=>l._canReceive(s,n,r))}_canReceive(s,n,r){if(!this._clientRect||!oe(this._clientRect,n,r)||!this.enterPredicate(s,this))return!1;const l=this._getShadowRoot().elementFromPoint(n,r);if(!l)return!1;const u=(0,y.fI)(this.element);return l===u||u.contains(l)}_startReceiving(s,n){const r=this._activeSiblings;!r.has(s)&&n.every(l=>this.enterPredicate(l,this)||this._draggables.indexOf(l)>-1)&&(r.add(s),this._cacheParentPositions(),this._listenToScrollEvents())}_stopReceiving(s){this._activeSiblings.delete(s),this._viewportScrollSubscription.unsubscribe()}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(s=>{if(this.isDragging()){const n=this._parentPositions.handleScroll(s);n&&this._sortStrategy.updateOnScroll(n.top,n.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){const s=(0,H.kV)((0,y.fI)(this.element));this._cachedShadowRoot=s||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){const s=this._sortStrategy.getActiveItemsSnapshot().filter(n=>n.isDragging());this._siblings.forEach(n=>n._startReceiving(this,s))}}function lt(d,s){const{top:n,bottom:r,height:l}=d,u=.05*l;return s>=n-u&&s<=n+u?1:s>=r-u&&s<=r+u?2:0}function ct(d,s){const{left:n,right:r,width:l}=d,u=.05*l;return s>=n-u&&s<=n+u?1:s>=r-u&&s<=r+u?2:0}const Ge=(0,H.i$)({passive:!1,capture:!0});let wt=(()=>{class d{constructor(n,r){this._ngZone=n,this._dropInstances=new Set,this._dragInstances=new Set,this._activeDragInstances=[],this._globalListeners=new Map,this._draggingPredicate=l=>l.isDragging(),this.pointerMove=new V.x,this.pointerUp=new V.x,this.scroll=new V.x,this._preventDefaultWhileDragging=l=>{this._activeDragInstances.length>0&&l.preventDefault()},this._persistentTouchmoveListener=l=>{this._activeDragInstances.length>0&&(this._activeDragInstances.some(this._draggingPredicate)&&l.preventDefault(),this.pointerMove.next(l))},this._document=r}registerDropContainer(n){this._dropInstances.has(n)||this._dropInstances.add(n)}registerDragItem(n){this._dragInstances.add(n),1===this._dragInstances.size&&this._ngZone.runOutsideAngular(()=>{this._document.addEventListener("touchmove",this._persistentTouchmoveListener,Ge)})}removeDropContainer(n){this._dropInstances.delete(n)}removeDragItem(n){this._dragInstances.delete(n),this.stopDragging(n),0===this._dragInstances.size&&this._document.removeEventListener("touchmove",this._persistentTouchmoveListener,Ge)}startDragging(n,r){if(!(this._activeDragInstances.indexOf(n)>-1)&&(this._activeDragInstances.push(n),1===this._activeDragInstances.length)){const l=r.type.startsWith("touch");this._globalListeners.set(l?"touchend":"mouseup",{handler:u=>this.pointerUp.next(u),options:!0}).set("scroll",{handler:u=>this.scroll.next(u),options:!0}).set("selectstart",{handler:this._preventDefaultWhileDragging,options:Ge}),l||this._globalListeners.set("mousemove",{handler:u=>this.pointerMove.next(u),options:Ge}),this._ngZone.runOutsideAngular(()=>{this._globalListeners.forEach((u,p)=>{this._document.addEventListener(p,u.handler,u.options)})})}}stopDragging(n){const r=this._activeDragInstances.indexOf(n);r>-1&&(this._activeDragInstances.splice(r,1),0===this._activeDragInstances.length&&this._clearGlobalListeners())}isDragging(n){return this._activeDragInstances.indexOf(n)>-1}scrolled(n){const r=[this.scroll];return n&&n!==this._document&&r.push(new fe.y(l=>this._ngZone.runOutsideAngular(()=>{const p=m=>{this._activeDragInstances.length&&l.next(m)};return n.addEventListener("scroll",p,!0),()=>{n.removeEventListener("scroll",p,!0)}}))),(0,M.T)(...r)}ngOnDestroy(){this._dragInstances.forEach(n=>this.removeDragItem(n)),this._dropInstances.forEach(n=>this.removeDropContainer(n)),this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_clearGlobalListeners(){this._globalListeners.forEach((n,r)=>{this._document.removeEventListener(r,n.handler,n.options)}),this._globalListeners.clear()}}return d.\u0275fac=function(n){return new(n||d)(i.LFG(i.R0b),i.LFG(j.K0))},d.\u0275prov=i.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})();const Ct={dragStartThreshold:5,pointerDirectionChangeThreshold:5};let ht=(()=>{class d{constructor(n,r,l,u){this._document=n,this._ngZone=r,this._viewportRuler=l,this._dragDropRegistry=u}createDrag(n,r=Ct){return new E(n,r,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry)}createDropList(n){return new Me(n,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}}return d.\u0275fac=function(n){return new(n||d)(i.LFG(j.K0),i.LFG(i.R0b),i.LFG(Oe.rL),i.LFG(wt))},d.\u0275prov=i.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})();const dt=new i.OlP("CDK_DRAG_PARENT"),xt=new i.OlP("CDK_DRAG_CONFIG"),It=new i.OlP("CdkDropList"),ut=new i.OlP("CdkDragHandle"),Ot=new i.OlP("CdkDragPlaceholder"),Pt=new i.OlP("CdkDragPreview");let ft=(()=>{class d{constructor(n,r,l,u,p,m,_,w,T,J,U){this.element=n,this.dropContainer=r,this._ngZone=u,this._viewContainerRef=p,this._dir=_,this._changeDetectorRef=T,this._selfHandle=J,this._parentDrag=U,this._destroyed=new V.x,this.started=new i.vpe,this.released=new i.vpe,this.ended=new i.vpe,this.entered=new i.vpe,this.exited=new i.vpe,this.dropped=new i.vpe,this.moved=new fe.y(Ce=>{const xe=this._dragRef.moved.pipe((0,F.U)(Fe=>({source:this,pointerPosition:Fe.pointerPosition,event:Fe.event,delta:Fe.delta,distance:Fe.distance}))).subscribe(Ce);return()=>{xe.unsubscribe()}}),this._dragRef=w.createDrag(n,{dragStartThreshold:m&&null!=m.dragStartThreshold?m.dragStartThreshold:5,pointerDirectionChangeThreshold:m&&null!=m.pointerDirectionChangeThreshold?m.pointerDirectionChangeThreshold:5,zIndex:m?.zIndex}),this._dragRef.data=this,d._dragInstances.push(this),m&&this._assignDefaults(m),r&&(this._dragRef._withDropContainer(r._dropListRef),r.addItem(this)),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}get disabled(){return this._disabled||this.dropContainer&&this.dropContainer.disabled}set disabled(n){this._disabled=(0,y.Ig)(n),this._dragRef.disabled=this._disabled}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(n){this._dragRef.setFreeDragPosition(n)}ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe((0,D.q)(1),(0,Pe.R)(this._destroyed)).subscribe(()=>{this._updateRootElement(),this._setupHandlesListener(),this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)})})}ngOnChanges(n){const r=n.rootElementSelector,l=n.freeDragPosition;r&&!r.firstChange&&this._updateRootElement(),l&&!l.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this);const n=d._dragInstances.indexOf(this);n>-1&&d._dragInstances.splice(n,1),this._ngZone.runOutsideAngular(()=>{this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_updateRootElement(){const n=this.element.nativeElement;let r=n;this.rootElementSelector&&(r=void 0!==n.closest?n.closest(this.rootElementSelector):n.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(r||n)}_getBoundaryElement(){const n=this.boundaryElement;return n?"string"==typeof n?this.element.nativeElement.closest(n):(0,y.fI)(n):null}_syncInputs(n){n.beforeStarted.subscribe(()=>{if(!n.isDragging()){const r=this._dir,l=this.dragStartDelay,u=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,p=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;n.disabled=this.disabled,n.lockAxis=this.lockAxis,n.dragStartDelay="object"==typeof l&&l?l:(0,y.su)(l),n.constrainPosition=this.constrainPosition,n.previewClass=this.previewClass,n.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(u).withPreviewTemplate(p).withPreviewContainer(this.previewContainer||"global"),r&&n.withDirection(r.value)}}),n.beforeStarted.pipe((0,D.q)(1)).subscribe(()=>{if(this._parentDrag)return void n.withParent(this._parentDrag._dragRef);let r=this.element.nativeElement.parentElement;for(;r;){if(r.classList.contains("cdk-drag")){n.withParent(d._dragInstances.find(l=>l.element.nativeElement===r)?._dragRef||null);break}r=r.parentElement}})}_handleEvents(n){n.started.subscribe(r=>{this.started.emit({source:this,event:r.event}),this._changeDetectorRef.markForCheck()}),n.released.subscribe(r=>{this.released.emit({source:this,event:r.event})}),n.ended.subscribe(r=>{this.ended.emit({source:this,distance:r.distance,dropPoint:r.dropPoint,event:r.event}),this._changeDetectorRef.markForCheck()}),n.entered.subscribe(r=>{this.entered.emit({container:r.container.data,item:this,currentIndex:r.currentIndex})}),n.exited.subscribe(r=>{this.exited.emit({container:r.container.data,item:this})}),n.dropped.subscribe(r=>{this.dropped.emit({previousIndex:r.previousIndex,currentIndex:r.currentIndex,previousContainer:r.previousContainer.data,container:r.container.data,isPointerOverContainer:r.isPointerOverContainer,item:this,distance:r.distance,dropPoint:r.dropPoint,event:r.event})})}_assignDefaults(n){const{lockAxis:r,dragStartDelay:l,constrainPosition:u,previewClass:p,boundaryElement:m,draggingDisabled:_,rootElementSelector:w,previewContainer:T}=n;this.disabled=_??!1,this.dragStartDelay=l||0,r&&(this.lockAxis=r),u&&(this.constrainPosition=u),p&&(this.previewClass=p),m&&(this.boundaryElement=m),w&&(this.rootElementSelector=w),T&&(this.previewContainer=T)}_setupHandlesListener(){this._handles.changes.pipe((0,ke.O)(this._handles),(0,Ye.b)(n=>{const r=n.filter(l=>l._parentDrag===this).map(l=>l.element);this._selfHandle&&this.rootElementSelector&&r.push(this.element),this._dragRef.withHandles(r)}),(0,at.w)(n=>(0,M.T)(...n.map(r=>r._stateChanges.pipe((0,ke.O)(r))))),(0,Pe.R)(this._destroyed)).subscribe(n=>{const r=this._dragRef,l=n.element.nativeElement;n.disabled?r.disableHandle(l):r.enableHandle(l)})}}return d._dragInstances=[],d.\u0275fac=function(n){return new(n||d)(i.Y36(i.SBq),i.Y36(It,12),i.Y36(j.K0),i.Y36(i.R0b),i.Y36(i.s_b),i.Y36(xt,8),i.Y36(Xe.Is,8),i.Y36(ht),i.Y36(i.sBO),i.Y36(ut,10),i.Y36(dt,12))},d.\u0275dir=i.lG2({type:d,selectors:[["","cdkDrag",""]],contentQueries:function(n,r,l){if(1&n&&(i.Suo(l,Pt,5),i.Suo(l,Ot,5),i.Suo(l,ut,5)),2&n){let u;i.iGM(u=i.CRH())&&(r._previewTemplate=u.first),i.iGM(u=i.CRH())&&(r._placeholderTemplate=u.first),i.iGM(u=i.CRH())&&(r._handles=u)}},hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(n,r){2&n&&i.ekj("cdk-drag-disabled",r.disabled)("cdk-drag-dragging",r._dragRef.isDragging())},inputs:{data:["cdkDragData","data"],lockAxis:["cdkDragLockAxis","lockAxis"],rootElementSelector:["cdkDragRootElement","rootElementSelector"],boundaryElement:["cdkDragBoundary","boundaryElement"],dragStartDelay:["cdkDragStartDelay","dragStartDelay"],freeDragPosition:["cdkDragFreeDragPosition","freeDragPosition"],disabled:["cdkDragDisabled","disabled"],constrainPosition:["cdkDragConstrainPosition","constrainPosition"],previewClass:["cdkDragPreviewClass","previewClass"],previewContainer:["cdkDragPreviewContainer","previewContainer"]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[i._Bn([{provide:dt,useExisting:d}]),i.TTD]}),d})(),Rt=(()=>{class d{}return d.\u0275fac=function(n){return new(n||d)},d.\u0275mod=i.oAB({type:d}),d.\u0275inj=i.cJS({providers:[ht],imports:[Oe.ZD]}),d})();var pt=k(1951),ze=k(5861),gt=k(8372),W=k(6578),ae=(()=>{return(d=ae||(ae={})).TOP="top",d.TOP_RIGHT="top-right",d.RIGHT="right",d.BOTTOM_RIGHT="bottom-right",d.BOTTOM="bottom",d.BOTTOM_LEFT="bottom-left",d.LEFT="left",d.TOP_LEFT="top-left",ae;var d})();let mt=(()=>{class d{constructor(n,r){this.elementRef=n,this.renderer2=r,this.applyClass="resizing",this.resizeStart=new i.vpe,this.resize=new i.vpe,this.resizeEnd=new i.vpe,this.listenMouseDownEvent()}ngOnChanges(n){n.useDrag&&this.listenMouseDownEvent()}ngOnDestroy(){this.mouseClickListener&&this.mouseClickListener(),this.mouseUpListener&&this.mouseUpListener(),this.mouseMoveListener&&this.mouseMoveListener()}listenMouseDownEvent(){this.mouseClickListener&&this.mouseClickListener(),this.mouseClickListener=this.renderer2.listen(this.elementRef.nativeElement,this.useDrag?"dragstart":"mousedown",r=>this.onMouseDown(r))}onMouseDown(n){n.preventDefault(),this.setOriginalData(n),this.resizeStart.emit(this.generateValuesForEvent(n)),this.mouseUpListener=this.renderer2.listen("document","mouseup",r=>this.onMouseUp(r)),this.mouseMoveListener=this.renderer2.listen("document","mousemove",r=>this.onMouseMove(r)),this.renderer2.addClass(this.targetNativeElement,this.applyClass)}onMouseUp(n){const r=this.generateValuesForEvent(n);this.resize.emit(r),this.mouseMoveListener(),this.mouseUpListener(),this.renderer2.removeClass(this.targetNativeElement,this.applyClass),this.resizeEnd.emit(r)}onMouseMove(n){this.resize.emit(this.generateValuesForEvent(n))}setOriginalData(n){if(this.originalEvent=n,this.targetElement){const r=this.targetNativeElement;this.targetElementWidthValue=r.offsetWidth,this.targetElementHeightValue=r.offsetHeight,this.targetElementTopValue=r.offsetTop,this.targetElementLeftValue=r.offsetLeft}else this.targetElementWidthValue=0,this.targetElementHeightValue=0,this.targetElementTopValue=0,this.targetElementLeftValue=0}get targetNativeElement(){return this.targetElement instanceof i.SBq?this.targetElement.nativeElement:this.targetElement}generateValuesForEvent(n){let u=n.clientX-this.originalEvent.clientX,p=n.clientY-this.originalEvent.clientY,m=p,_=u;switch(this.direction){case ae.TOP:p*=-1,u=0,_=0;break;case ae.TOP_RIGHT:p*=-1,_=0;break;case ae.RIGHT:p=0,m=0,_=0;break;case ae.BOTTOM_RIGHT:m=0,_=0;break;case ae.BOTTOM:u=0,_=0,m=0;break;case ae.BOTTOM_LEFT:u*=-1,m=0;break;case ae.LEFT:u*=-1,p=0,m=0;break;case ae.TOP_LEFT:p*=-1,u*=-1}let w=this.targetElementWidthValue+u,T=this.targetElementHeightValue+p;this.proportionalResize&&(w>T?w=T:T=w),T<=1&&(m+=T),w<=1&&(_+=w),w<=0&&(w=0),T<=0&&(T=0);let J=this.targetElementTopValue+m,U=this.targetElementLeftValue+_;return this.rect&&(J<this.rect.top&&(T=this.targetElementHeightValue+this.targetElementTopValue-this.rect.top,J=this.rect.top),T+J>this.rect.height&&(T=this.rect.height-J),U<this.rect.left&&(w=this.targetElementWidthValue+this.targetElementLeftValue-this.rect.left,U=this.rect.left),w+U>this.rect.width&&(w=this.rect.width-U)),{originalEvent:this.originalEvent,currentWidthValue:w,currentHeightValue:T,currentTopValue:J,currentLeftValue:U,originalWidthValue:this.targetElementWidthValue,originalHeightValue:this.targetElementHeightValue,originalTopValue:this.targetElementTopValue,originalLeftValue:this.targetElementLeftValue,differenceWidthValue:w-this.targetElementWidthValue,differenceHeightValue:T-this.targetElementHeightValue,differenceTopValue:J-this.targetElementTopValue,differenceLeftValue:U-this.targetElementLeftValue,direction:this.direction}}}return d.\u0275fac=function(n){return new(n||d)(i.Y36(i.SBq),i.Y36(i.Qsj))},d.\u0275dir=i.lG2({type:d,selectors:[["","resize",""],["","resizeStart",""],["","resizeEnd",""]],hostVars:1,hostBindings:function(n,r){2&n&&i.uIk("draggable",r.useDrag)},inputs:{applyClass:"applyClass",targetElement:"targetElement",direction:"direction",proportionalResize:"proportionalResize",rect:"rect",useDrag:"useDrag"},outputs:{resizeStart:"resizeStart",resize:"resize",resizeEnd:"resizeEnd"},features:[i.TTD]}),d})(),Tt=(()=>{class d{}return d.\u0275fac=function(n){return new(n||d)},d.\u0275mod=i.oAB({type:d}),d.\u0275inj=i.cJS({}),d})();function et(d,s){return d&&s?Math.abs(d.getTime()-s.getTime()):0}function be(d,s){return d&&s?Math.abs(d.getTime()-s.getTime())/1e3:0}var At=k(7340),tt=k(7312),Ee=k(1576),vt=k(5829);const Lt=["wordOrLetterElementRef"],Mt=["pElementRef"];class Ne{constructor(s,n,r){this.animationBuilder=s,this.configurationService=n,this.hostEl=r,this.bufferDoDetectSensorial=100,this.mouseMovedEvent=new V.x,this.onResetDasherEvent=new V.x,this.onContentChangedEvent=new V.x,this.wordOrLetterSelectedEvent=new i.vpe,this.animateDivSelection=!1,this.wordOrLetterSelected=!1,this.AngularResizeElementDirection=ae}ngOnInit(){this.mouseMovedEvent.subscribe(s=>{}),this.onResetDasherEvent.subscribe(()=>{this.wordOrLetterSelected=!1}),this.onContentChangedEvent.subscribe(s=>{s.id==this.elId&&(this.wordOrLetter=s.value)}),this.configurationService.isAnyControlConfigured()&&this.constantCheckElementOverAnother()}ngOnDestroy(){this.intervalCheckColision&&clearInterval(this.intervalCheckColision),this.intervalSensorialDetection&&clearInterval(this.intervalSensorialDetection)}mouseOverWordOrLetterEvent(){if(this.configurationService.isAnyControlConfigured())return;let s=()=>{this.enableLayoutEdition||(this.clearSensorialBufers(),this.wordOrLetterSelectedEvent.next(this.wordOrLetter))};this.doDetect()?s():this.intervalSensorialDetection||(this.intervalSensorialDetection=setInterval(()=>{s()},this.configurationService.sensorialSelectionDelayMs-this.bufferDoDetectSensorial))}mouseOutWordOrLetterEvent(){this.configurationService.isAnyControlConfigured()||this.clearSensorialBufers()}onResize(s){const n=this.wordOrLetterElementRef.nativeElement,r=n.parentElement.getBoundingClientRect().width,l=n.parentElement.getBoundingClientRect().height;n.style.position="absolute",n.style.flex="none",n.style.width=s.currentWidthValue+"px",n.style.height=s.currentHeightValue+"px",n.parentElement.style.width=r+"px",n.parentElement.style.height=l+"px",n.classList.add("el_changed")}cdkDragStarted(){this.wordOrLetterElementRef.nativeElement.classList.add("el_changed")}constantCheckElementOverAnother(){this.intervalCheckColision=setInterval(()=>{(0,W.ug)(document.getElementById("suportDiv"),this.pElementRef.nativeElement)?(this.wordOrLetterSelected=!0,this.doDetect()&&this.wordOrLetterSelectedEvent.next(this.wordOrLetter)):(this.wordOrLetterSelected=!1,this.clearSensorialBufers())},50)}clearSensorialBufers(){this.animateDivSelection=!1,this.lastSensorialDetectionTime=void 0,this.intervalSensorialDetection&&(clearInterval(this.intervalSensorialDetection),this.intervalSensorialDetection=void 0)}doDetect(){return!this.enableLayoutEdition&&(!this.configurationService.isDelayedDetectionAction()||(this.animateDivSelection||(this.hostEl.nativeElement.style.setProperty("--animation-duration",this.configurationService.sensorialSelectionDelayMs/1e3+"s"),this.animateDivSelection=!0),this.lastSensorialDetectionTime||(this.lastSensorialDetectionTime=new Date),et(this.lastSensorialDetectionTime,new Date)>=this.configurationService.sensorialSelectionDelayMs))}static#e=this.\u0275fac=function(n){return new(n||Ne)(i.Y36(At._j),i.Y36(tt.x),i.Y36(i.SBq))};static#t=this.\u0275cmp=i.Xpm({type:Ne,selectors:[["app-dasher-on-screen-player"]],viewQuery:function(n,r){if(1&n&&(i.Gf(Lt,5),i.Gf(Mt,5)),2&n){let l;i.iGM(l=i.CRH())&&(r.wordOrLetterElementRef=l.first),i.iGM(l=i.CRH())&&(r.pElementRef=l.first)}},inputs:{elId:"elId",mouseMovedEvent:"mouseMovedEvent",onResetDasherEvent:"onResetDasherEvent",enableLayoutEdition:"enableLayoutEdition",onContentChangedEvent:"onContentChangedEvent",showBackGroundSelection:"showBackGroundSelection"},outputs:{wordOrLetterSelectedEvent:"wordOrLetterSelectedEvent"},decls:9,vars:14,consts:[["cdkDrag","",3,"id","cdkDragDisabled","ngClass","cdkDragStarted"],["wordOrLetterElementRef",""],[1,"resize","resize__right",3,"targetElement","direction","resize"],[1,"resize","resize__bottom",3,"targetElement","direction","resize"],[1,"resize","resize__top",3,"targetElement","direction","resize"],[1,"resize","resize__left",3,"targetElement","direction","resize"],["fxLayoutAlign","center center",1,"label-default-font-size","action-border","action-sized",3,"mouseover","mouseout"],["pElementRef",""]],template:function(n,r){if(1&n&&(i.TgZ(0,"div",0,1),i.NdJ("cdkDragStarted",function(){return r.cdkDragStarted()}),i.TgZ(2,"div",2),i.NdJ("resize",function(u){return r.onResize(u)}),i.qZA(),i.TgZ(3,"div",3),i.NdJ("resize",function(u){return r.onResize(u)}),i.qZA(),i.TgZ(4,"div",4),i.NdJ("resize",function(u){return r.onResize(u)}),i.qZA(),i.TgZ(5,"div",5),i.NdJ("resize",function(u){return r.onResize(u)}),i.qZA(),i.TgZ(6,"p",6,7),i.NdJ("mouseover",function(){return r.mouseOverWordOrLetterEvent()})("mouseout",function(){return r.mouseOutWordOrLetterEvent()}),i._uU(8),i.qZA()()),2&n){const l=i.MAs(1);i.ekj("fill-animation",r.animateDivSelection),i.Q6J("id",r.elId)("cdkDragDisabled",!r.enableLayoutEdition)("ngClass",r.showBackGroundSelection?"full-div-selection":"full-div"),i.xp6(2),i.Q6J("targetElement",l)("direction",r.AngularResizeElementDirection.RIGHT),i.xp6(1),i.Q6J("targetElement",l)("direction",r.AngularResizeElementDirection.BOTTOM),i.xp6(1),i.Q6J("targetElement",l)("direction",r.AngularResizeElementDirection.TOP),i.xp6(1),i.Q6J("targetElement",l)("direction",r.AngularResizeElementDirection.LEFT),i.xp6(3),i.Oqu(r.wordOrLetter)}},dependencies:[j.mk,Ee.Wh,vt.oO,ft,mt],styles:["[_nghost-%COMP%]{--animation-duration: 5s}.action-border[_ngcontent-%COMP%]{border-width:2px;border-style:groove;border-color:#fafad2;margin:0!important}.action-sized[_ngcontent-%COMP%]{width:100%}.full-div[_ngcontent-%COMP%]{display:flex;height:100%;width:100%;background:linear-gradient(to right,rgb(230,255,230) 50%,transparent 0);background-size:200% 100%;background-position:right;background-color:#fff}.full-div-selection[_ngcontent-%COMP%]{display:flex;height:100%;width:100%;background:linear-gradient(to right,rgb(230,255,230) 50%,transparent 0);background-size:200% 100%;background-position:right;background-color:#fafad2}@keyframes _ngcontent-%COMP%_makeItfadeIn{to{background-position:left}}.fill-animation[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_makeItfadeIn var(--animation-duration) 0s forwards}"]})}var _t=k(7439);const Se=["b","c","d","f","g","j","l","m","n","p","s","t","h"].concat(["a","e","q","r"]),we=["a","e","i","o","u","q","r","v","w","x","y","k","z"].concat(["b","c","j","l"]),it=["0","1","2","3","4","5","6","7","8","9","=","+","-","*","|","'",'"'],nt=[".",",",":","^","~","[","]","`","\xb4","!","?","/",";","(",")","{","}"],Nt=["Sugest\xe3o 1","Letra 1 (c)","Letra 2 (d)","Letra 3 (f)","Letra 4 (g)","Sugest\xe3o 2","Sugest\xe3o 3","Letra 5 (m)","Letra 6 (n)","Letra 7 (p)","Letra 8 (s)","Letra 9 (t)","Letra 10 (h)","Letra 11 (a)","Letra 12 (e)","Letra 13 (q)","Letra 14 (r)"],Bt=["Sugest\xe3o 1","Letra 1 (e)","Letra 2 (i)","Letra 3 (o)","Letra 4 (u)","Sugest\xe3o 2","Sugest\xe3o 3","Letra 5 (v)","Letra 6 (w)","Letra 7 (x)","Letra 8 (y)","Letra 9 (k)","Letra 10 (z)","Letra 11 (b)","Letra 12 (c)","Letra 13 (j)","Letra 14 (l)"],Jt=["b","c","d","f","g","j","l","m","n","p","s","t","h","a","e","i","o","u","q","r","v","w","x","y","k","z"],yt={"~":"\u0303","^":"\u0302","`":"\u0300","\xb4":"\u0301"};function rt(d){return d%2==0}var Dt=k(8933),st=k(9476),We=k(7274);function Vt(d,s){1&d&&i._UZ(0,"mat-spinner",2)}class Be{constructor(s,n){this.dialogRef=s,this.data=n,this.message=this.data.message,this.showSpinner=this.data.showSpinner}static#e=this.\u0275fac=function(n){return new(n||Be)(i.Y36(We.so),i.Y36(We.WI))};static#t=this.\u0275cmp=i.Xpm({type:Be,selectors:[["app-dasher-on-screen-feedback-modal"]],decls:4,vars:2,consts:[["fxLayoutAlign","center center","fxLayout","column",2,"padding","20px"],["diameter","40",4,"ngIf"],["diameter","40"]],template:function(n,r){1&n&&(i.TgZ(0,"div",0)(1,"p"),i._uU(2),i.qZA(),i.YNc(3,Vt,1,0,"mat-spinner",1),i.qZA()),2&n&&(i.xp6(2),i.Oqu(r.message),i.xp6(1),i.Q6J("ngIf",r.showSpinner))},dependencies:[j.O5,Ee.xw,Ee.Wh,se]})}var Zt=k(8333),qt=k(290);class Je{constructor(s,n,r,l){this.deviceService=s,this.identifierService=n,this.controlProviderService=r,this.dialog=l,this.firestore=(0,i.f3M)(st.gg),this.miniumUsageSeconds=60*(W.h2?1:15),this.backSpaceDateList=new Array,this.predictonsDateList=new Array,this.predictionClassifierList=new Array,this.fullInput="",this.sendingFeedback=!1}start(){this.startDate=new Date}end(s=0){var n=this;return(0,ze.Z)(function*(){n.sendingFeedback||(n.sendingFeedback=!0,n.endDate=new Date,n.endDate.setMilliseconds(n.endDate.getMilliseconds()-s),be(n.startDate,n.endDate)>n.miniumUsageSeconds&&(yield n.sendPerfomaceIndicatior()),n.resetCache(),n.sendingFeedback=!1)})()}backSpace(){this.fullInput.length>1&&(this.backSpaceDateList.push(new Date),this.fullInput=this.fullInput.substring(0,this.fullInput.length-1))}blankSpace(){this.fullInput=this.fullInput+" "}wordSelected(s){if(s.length>1){const n=this.fullInput.split(" "),r=n[n.length-1],l=s.length-r.length;l>1&&(this.predictonsDateList.push(new Date),this.predictionClassifierList.push({charactersOtimization:l,predictionWord:s,word:r})),this.fullInput=this.fullInput.substring(0,this.fullInput.length-r.length),this.fullInput=this.fullInput+s}else this.fullInput=this.fullInput+s}sendPerfomaceIndicatior(){var s=this;return(0,ze.Z)(function*(){const r=s.fullInput.split("").length/be(s.startDate,s.endDate)*60,l=r/5;let u=0;s.backSpaceDateList.length>0&&(u=s.backSpaceDateList.length/be(s.startDate,s.endDate)*60);let p=0;s.predictonsDateList.length>0&&(p=s.predictonsDateList.length/be(s.startDate,s.endDate)*60);const m=s.deviceService.getDeviceInfo();if(W.h2){let _="",w="";"Sensorial"==window.Cypress.Tipo?(_=`Resultados dos Testes ${window.Cypress.Tipo} DelayMsEscolha ${window.Cypress.DelayMsEscolha}, DelayMsIteracao ${window.Cypress.DelayMsIteracao}}:`,w=window.Cypress.Tipo+"_DelayMsEscolha_"+window.Cypress.DelayMsEscolha+"_DelayMsIteracao_"+window.Cypress.DelayMsIteracao+"_Loop_"+window.Cypress.Loop):(_=`Resultados dos Testes ${window.Cypress.Tipo} Dpi ${window.Cypress.Dpi}}:`,w=window.Cypress.Tipo+"_DPI_"+window.Cypress.Dpi+"_Loop_"+window.Cypress.Loop),yield(0,st.pl)((0,st.JU)(s.firestore,"Testes",w),{date:new Date,browser:window.navigator.userAgent,os:m.os,os_version:m.os_version,device:m.deviceType,deviceId:s.identifierService.getDeviceId(),control:s.controlProviderService.getActiveControl(),data:{cpmIndicator:r,wpmIndicator:l,epmIndicator:u,ppmIndicator:p,startDate:s.startDate,endDate:s.endDate,predictionClassifierList:s.predictionClassifierList,totalUsageSeconds:be(s.startDate,s.endDate)}}),s.dialog.open(Be,{data:{message:`${_}\n                    "cpmIndicator": ${r}\n                    "wpmIndicator": ${l}\n                    "epmIndicator": ${u}\n                    "ppmIndicator": ${p}\n                    "startDate": ${s.startDate}\n                    "endDate": ${s.endDate}\n                    "totalUsageSeconds": ${be(s.startDate,s.endDate)}\n                    `}})}else console.log("feedback sended",{browser:window.navigator.userAgent,os:m.os,os_version:m.os_version,device:m.deviceType,deviceId:s.identifierService.getDeviceId(),control:s.controlProviderService.getActiveControl(),data:{cpmIndicator:r,wpmIndicator:l,epmIndicator:u,ppmIndicator:p,startDate:s.startDate,endDate:s.endDate,predictionClassifierList:s.predictionClassifierList,totalUsageSeconds:be(s.startDate,s.endDate)}})})()}resetCache(){this.startDate=void 0,this.endDate=void 0,this.backSpaceDateList=new Array,this.predictonsDateList=new Array,this.predictionClassifierList=new Array,this.fullInput=""}static#e=this.\u0275fac=function(n){return new(n||Je)(i.LFG(Zt.x0),i.LFG(qt.u),i.LFG(tt.x),i.LFG(We.uw))};static#t=this.\u0275prov=i.Yz7({token:Je,factory:Je.\u0275fac,providedIn:"root"})}var Gt=k(6805),Wt=k(930),Ut=k(2527),Ke=k.n(Ut),Qt=k(529);class $e{constructor(s,n){this.http=s,this.dialog=n,this.rankTreshHoldWord=25e3}getWord(s){if(s.length<2)return[];const n=new RegExp("^"+s,"i");return this.dbLoki.getCollection(s.charAt(0)).chain().find({word:{$regex:n}}).simplesort("rank",{desc:!0}).limit(20).data().filter(u=>u.word!==s)}doAddWordOnDb(s){var n=this;return(0,ze.Z)(function*(){s.trim();const r=n.dbLoki.getCollection(s.charAt(0)),l=r.chain().find({word:{$regex:s.charAt(0)+s.charAt(1)+s.charAt(2)}}).simplesort("rank",{desc:!0}).limit(10).data(),u=r.findOne({word:s});if(u)u.rank+=1,l.length>0&&u.rank<l[l.length-1].rank&&(u.rank=l[l.length-1].rank+1),r.update(u);else{let p=1;l.length>0&&(p=l[l.length-1].rank+1),r.insert({word:s,rank:p})}})()}ensureHasCreatedDatabases(){var s=this;return(0,ze.Z)(function*(){if(s.dialog.open(Be,{data:{message:"Carregando Database",showSpinner:!0}}),"true"!=localStorage.getItem("CreatedLocalDatabase")){s.dbLoki=new(Ke())("wordsDb",{adapter:new(Ke().LokiLocalStorageAdapter)});let r=(yield function Kt(d,s){const n="object"==typeof s;return new Promise((r,l)=>{const u=new Wt.Hp({next:p=>{r(p),u.unsubscribe()},error:l,complete:()=>{n?r(s.defaultValue):l(new Gt.K)}});d.subscribe(u)})}(s.http.get("assets/tf.txt",{responseType:"text"}))).split("\n");r=r.filter(l=>l),r=r.filter(l=>Number(l.split(",")[1])>=s.rankTreshHoldWord),Jt.forEach(l=>{s.inserOnColletion(r,l.normalize("NFD").replace(/[\u0300-\u036f]/g,""))}),s.dbLoki.saveDatabase(),localStorage.setItem("CreatedLocalDatabase","true"),s.dialog.closeAll()}else{const n=new(Ke())("wordsDb",{adapter:new(Ke().LokiLocalStorageAdapter)});n.loadDatabase({},()=>{console.log("Banco de dados carregado com sucesso."),s.dialog.closeAll(),s.dbLoki=n})}})()}inserOnColletion(s,n){const r=this.dbLoki.addCollection(n),u=s.filter(m=>{let _="";for(let w=0;w<n.length;w++)_+=m.charAt(w);return _==n}).map(m=>({word:m.split(",")[0],rank:Number(m.split(",")[1])}));u.sort((m,_)=>m.rank-_.rank),u.map((m,_)=>({word:m.word.normalize("NFD").replace(/[\u0300-\u036f]/g,""),rank:_+1})).forEach(m=>{r.insert(m)})}static#e=this.\u0275fac=function(n){return new(n||$e)(i.LFG(Qt.eN),i.LFG(We.uw))};static#t=this.\u0275prov=i.Yz7({token:$e,factory:$e.\u0275fac,providedIn:"root"})}const jt=["limparElementRef"],Yt=["falarElementRef"],Xt=["limparTudoElementRef"],ei=["espacoElementRef"],ti=["centerDivElementRef"],ii=["simboloElementRef"],ni=["playerDivElementRef"];function ri(d,s){1&d&&(i.TgZ(0,"mat-icon",40),i._uU(1,"stop"),i.qZA())}function si(d,s){1&d&&i._UZ(0,"mat-spinner",41)}function oi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",42),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"limparTudoElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(12);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.RIGHT)}}function ai(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",43),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"limparTudoElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(12);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.BOTTOM)}}function li(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",44),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"limparTudoElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(12);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.TOP)}}function ci(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",45),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"limparTudoElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(12);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.LEFT)}}function hi(d,s){1&d&&(i.TgZ(0,"div",46)(1,"p",47),i._uU(2," Limpar Toda Digita\xe7\xe3o "),i.qZA()())}function di(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",42),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"simboloElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(22);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.RIGHT)}}function ui(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",43),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"simboloElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(22);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.BOTTOM)}}function fi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",44),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"simboloElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(22);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.TOP)}}function pi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",45),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"simboloElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(22);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.LEFT)}}function gi(d,s){1&d&&(i.TgZ(0,"div",48)(1,"p",47),i._uU(2," Simbolos "),i.qZA()())}function mi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",42),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"falarElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(32);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.RIGHT)}}function vi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",43),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"falarElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(32);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.BOTTOM)}}function _i(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",44),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"falarElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(32);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.TOP)}}function yi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",45),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"falarElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(32);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.LEFT)}}function Di(d,s){1&d&&(i.TgZ(0,"div",49)(1,"p",47),i._uU(2," Falar Texto Completo "),i.qZA()())}function bi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",42),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"espacoElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(42);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.RIGHT)}}function Ei(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",43),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"espacoElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(42);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.BOTTOM)}}function Si(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",44),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"espacoElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(42);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.TOP)}}function wi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",45),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"espacoElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(42);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.LEFT)}}function Ci(d,s){1&d&&(i.TgZ(0,"div",50)(1,"p",47),i._uU(2," Inserir Espa\xe7o "),i.qZA()())}function xi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",42),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"limparElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(54);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.RIGHT)}}function Ii(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",43),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"limparElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(54);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.BOTTOM)}}function Oi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",44),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"limparElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(54);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.TOP)}}function Pi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"div",45),i.NdJ("resize",function(l){i.CHM(n);const u=i.oxw();return i.KtG(u.onResize(l,"limparElementRef"))}),i.qZA()}if(2&d){const n=i.oxw(),r=i.MAs(54);i.Q6J("targetElement",r)("direction",n.AngularResizeElementDirection.LEFT)}}function ki(d,s){1&d&&(i.TgZ(0,"div",51)(1,"p",47),i._uU(2," Limpar \xdaltimo "),i.qZA()())}function Ri(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"app-dasher-on-screen-player",64),i.NdJ("click",function(){i.CHM(n);const l=i.oxw().index,u=i.oxw(2);return i.KtG(u.onClickElementCalibration(l,"top"))})("wordOrLetterSelectedEvent",function(l){i.CHM(n);const u=i.oxw(3);return i.KtG(u.wordOrLetterSelectedEvent(l))}),i.qZA()}if(2&d){const n=i.oxw().index,r=i.oxw(2);i.Q6J("elId",r.getIdPrefix()+"ptop"+n.toString())("showBackGroundSelection",r.clickElementsCount.get("top_"+n)==r.defaultCalibrationCount)("mouseMovedEvent",r.mouseMovedEvent)("onResetDasherEvent",r.onResetDasherEvent)("enableLayoutEdition",r.enableLayoutEdition)("onContentChangedEvent",r.onContentChangedEvent)}}function Ti(d,s){if(1&d&&i.YNc(0,Ri,1,6,"app-dasher-on-screen-player",63),2&d){const n=s.index,r=i.oxw(2);i.Q6J("ngIf",n>=r.splitIndexHeader)}}function Ai(d,s){1&d&&i._UZ(0,"div",38)}function Li(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"app-dasher-on-screen-player",64),i.NdJ("click",function(){i.CHM(n);const l=i.oxw().index,u=i.oxw(2);return i.KtG(u.onClickElementCalibration(l,"top"))})("wordOrLetterSelectedEvent",function(l){i.CHM(n);const u=i.oxw(3);return i.KtG(u.wordOrLetterSelectedEvent(l))}),i.qZA()}if(2&d){const n=i.oxw().index,r=i.oxw(2);i.Q6J("elId",r.getIdPrefix()+"ptop"+n.toString())("showBackGroundSelection",r.clickElementsCount.get("top_"+n)==r.defaultCalibrationCount)("mouseMovedEvent",r.mouseMovedEvent)("onResetDasherEvent",r.onResetDasherEvent)("enableLayoutEdition",r.enableLayoutEdition)("onContentChangedEvent",r.onContentChangedEvent)}}function Mi(d,s){if(1&d&&(i.YNc(0,Ai,1,0,"div",65),i.YNc(1,Li,1,6,"app-dasher-on-screen-player",63)),2&d){const n=s.index,r=i.oxw(2);i.Q6J("ngIf",3==n),i.xp6(1),i.Q6J("ngIf",n<r.splitIndexHeader)}}function zi(d,s){1&d&&i._UZ(0,"div",38)}function Fi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"app-dasher-on-screen-player",64),i.NdJ("click",function(){i.CHM(n);const l=i.oxw().index,u=i.oxw(2);return i.KtG(u.onClickElementCalibration(l,"bottom"))})("wordOrLetterSelectedEvent",function(l){i.CHM(n);const u=i.oxw(3);return i.KtG(u.wordOrLetterSelectedEvent(l))}),i.qZA()}if(2&d){const n=i.oxw().index,r=i.oxw(2);i.Q6J("elId",r.getIdPrefix()+"pbottom"+n.toString())("showBackGroundSelection",r.clickElementsCount.get("bottom_"+n)==r.defaultCalibrationCount)("mouseMovedEvent",r.mouseMovedEvent)("onResetDasherEvent",r.onResetDasherEvent)("enableLayoutEdition",r.enableLayoutEdition)("onContentChangedEvent",r.onContentChangedEvent)}}function Ni(d,s){if(1&d&&(i.YNc(0,zi,1,0,"div",65),i.YNc(1,Fi,1,6,"app-dasher-on-screen-player",63)),2&d){const n=s.index,r=i.oxw(2);i.Q6J("ngIf",3==n),i.xp6(1),i.Q6J("ngIf",n<r.splitIndexBottom)}}function Bi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"app-dasher-on-screen-player",64),i.NdJ("click",function(){i.CHM(n);const l=i.oxw().index,u=i.oxw(2);return i.KtG(u.onClickElementCalibration(l,"bottom"))})("wordOrLetterSelectedEvent",function(l){i.CHM(n);const u=i.oxw(3);return i.KtG(u.wordOrLetterSelectedEvent(l))}),i.qZA()}if(2&d){const n=i.oxw().index,r=i.oxw(2);i.Q6J("elId",r.getIdPrefix()+"pbottom"+n.toString())("showBackGroundSelection",r.clickElementsCount.get("bottom_"+n)==r.defaultCalibrationCount)("mouseMovedEvent",r.mouseMovedEvent)("onResetDasherEvent",r.onResetDasherEvent)("enableLayoutEdition",r.enableLayoutEdition)("onContentChangedEvent",r.onContentChangedEvent)}}function Ji(d,s){if(1&d&&i.YNc(0,Bi,1,6,"app-dasher-on-screen-player",63),2&d){const n=s.index,r=i.oxw(2);i.Q6J("ngIf",n>=r.splitIndexBottom)}}function $i(d,s){if(1&d&&(i.TgZ(0,"div",52)(1,"div",53)(2,"div",54)(3,"div",55),i.YNc(4,Ti,1,1,"ng-template",56),i.qZA()(),i._UZ(5,"div",57),i.TgZ(6,"div",58)(7,"div",55),i.YNc(8,Mi,2,2,"ng-template",56),i.qZA()(),i._UZ(9,"div",59),i.TgZ(10,"div",60)(11,"div",55),i.YNc(12,Ni,2,2,"ng-template",56),i.qZA()(),i._UZ(13,"div",61),i.TgZ(14,"div",62)(15,"div",55),i.YNc(16,Ji,1,1,"ng-template",56),i.qZA()()()()),2&d){const n=i.oxw();i.xp6(4),i.Q6J("ngForOf",n.initialTopLetters),i.xp6(4),i.Q6J("ngForOf",n.initialTopLetters),i.xp6(4),i.Q6J("ngForOf",n.initialBottomLetters),i.xp6(4),i.Q6J("ngForOf",n.initialBottomLetters)}}function Hi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"app-dasher-on-screen-player",64),i.NdJ("click",function(){const u=i.CHM(n).index,p=i.oxw(2);return i.KtG(p.onClickElementCalibration(u,"top"))})("wordOrLetterSelectedEvent",function(l){i.CHM(n);const u=i.oxw(2);return i.KtG(u.wordOrLetterSelectedEvent(l))}),i.qZA()}if(2&d){const n=s.index,r=i.oxw(2);i.Q6J("elId",r.getIdPrefix()+"ptop"+n.toString())("showBackGroundSelection",r.clickElementsCount.get("top_"+n)==r.defaultCalibrationCount)("mouseMovedEvent",r.mouseMovedEvent)("onResetDasherEvent",r.onResetDasherEvent)("enableLayoutEdition",r.enableLayoutEdition)("onContentChangedEvent",r.onContentChangedEvent)}}function Vi(d,s){if(1&d){const n=i.EpF();i.TgZ(0,"app-dasher-on-screen-player",64),i.NdJ("click",function(){const u=i.CHM(n).index,p=i.oxw(2);return i.KtG(p.onClickElementCalibration(u,"bottom"))})("wordOrLetterSelectedEvent",function(l){i.CHM(n);const u=i.oxw(2);return i.KtG(u.wordOrLetterSelectedEvent(l))}),i.qZA()}if(2&d){const n=s.index,r=i.oxw(2);i.Q6J("elId",r.getIdPrefix()+"pbottom"+n.toString())("showBackGroundSelection",r.clickElementsCount.get("bottom_"+n)==r.defaultCalibrationCount)("mouseMovedEvent",r.mouseMovedEvent)("onResetDasherEvent",r.onResetDasherEvent)("enableLayoutEdition",r.enableLayoutEdition)("onContentChangedEvent",r.onContentChangedEvent)}}function Zi(d,s){if(1&d&&(i.TgZ(0,"div",52)(1,"div",66)(2,"div",54)(3,"div",55),i.YNc(4,Hi,1,6,"ng-template",56),i.qZA()(),i._UZ(5,"div",59),i.TgZ(6,"div",60)(7,"div",55),i.YNc(8,Vi,1,6,"ng-template",56),i.qZA()()()()),2&d){const n=i.oxw();i.xp6(4),i.Q6J("ngForOf",n.initialTopLetters),i.xp6(4),i.Q6J("ngForOf",n.initialBottomLetters)}}class Ue{constructor(s,n,r,l){this.configurationService=s,this.perfomanceIndicatorService=n,this.predicionsService=r,this.hostEl=l,this.lastActionExecuted=new Date,this.afkCheckDelayMs=1e3*(W.h2?10:45),this.showingSimbols=!1,this.canSelectWordLetter=!0,this.actionSensorialDetectionBuffer={top:void 0,right:void 0,bottom:void 0,left:void 0},this.bufferDoDetectSensorial=100,this.mouseMovedEvent=new V.x,this.onResetDasherEvent=new V.x,this.onContentChangedEvent=new V.x,this.isAfk=!1,this.input="",this.initialTopLetters=Se,this.splitIndexHeader=Math.ceil(this.initialTopLetters.length/2),this.initialBottomLetters=we,this.splitIndexBottom=Math.ceil(this.initialBottomLetters.length/2),this.layoutTypes=Dt.m,this.layoutType=this.configurationService.layoutType,this.lastLayoutType=this.configurationService.lastLayoutType,this.animateDivSelectionSpace=!1,this.animateDivSelectionClear=!1,this.animateDivSelectionClearAll=!1,this.animateDivSelectionSpeak=!1,this.animateDivSelectionSimbols=!1,this.AngularResizeElementDirection=ae,this.enableLayoutEdition=!1,this.getIdPrefix=()=>this.showingSimbols?"simb_":"default_",this.clickElementsCount=new Map,this.defaultCalibrationCount=5,speechSynthesis.addEventListener("voiceschanged",()=>{}),this.listenEditLayout()}ngAfterViewInit(){var s=this;return(0,ze.Z)(function*(){yield s.predicionsService.ensureHasCreatedDatabases(),s.initHidControl(),s.lastActionExecuted=new Date,s.perfomanceIndicatorService.start(),s.afkInterval=setInterval(()=>s.checkDasherAfk(),1e3),s.doSetDynamicLayout(),s.redefinedWords(!0)})()}ngOnDestroy(){var s=this;return(0,ze.Z)(function*(){clearInterval(s.afkInterval),yield s.perfomanceIndicatorService.end()})()}onClickElementCalibration(s,n){if(this.configurationService.isOcularDeviceConfigured()&&"true"!=localStorage.getItem("CalibratedEyeControl")){const r=5+this.initialBottomLetters.length+this.initialTopLetters.length,l=this.clickElementsCount.get(n+"_"+s);l&&l<this.defaultCalibrationCount?this.clickElementsCount.set(n+"_"+s,l+1):l||this.clickElementsCount.set(n+"_"+s,1);let u=0;for(let p of this.clickElementsCount.values())u+=p;u>1&&(0,_t.Yc)(),u==r*this.defaultCalibrationCount&&(this.clickElementsCount=new Map,(0,_t.sQ)(),this.configurationService.initializeControl())}}checkDasherAfk(){const s=this.isAfk;this.isAfk=et(new Date,this.lastActionExecuted)>this.afkCheckDelayMs,this.isAfk&&this.isAfk!=s?this.perfomanceIndicatorService.end(this.afkCheckDelayMs):this.isAfk!=s&&this.perfomanceIndicatorService.start()}mouseMovedDasher(s){this.configurationService.isAnyControlConfigured()||this.mouseMovedEvent.next(s)}mouseOverBlankSpace(){if(!this.configurationService.isAnyControlConfigured()&&!this.enableLayoutEdition){let s=()=>{this.doResetSensorialDetection(),this.insertBlankSpace()};this.doDetect("animateDivSelectionSpace")?s():this.intervalSensorialDetection||(this.intervalSensorialDetection=setInterval(()=>{s()},this.configurationService.sensorialSelectionDelayMs-this.bufferDoDetectSensorial))}}mouseOutBlankSpace(){this.configurationService.isAnyControlConfigured()||this.doResetSensorialDetection()}insertBlankSpace(s=!0){if(this.input){const n=this.input.split(" ");this.input=this.input+" ",this.perfomanceIndicatorService.blankSpace(),n[n.length-1].trim().length>0&&this.predicionsService.doAddWordOnDb(n[n.length-1]),s&&this.redefinedWords(),this.lastActionExecuted=new Date}}mouseOverReset(s=!1){if(!this.configurationService.isAnyControlConfigured()&&!this.enableLayoutEdition){let n=()=>{this.doResetSensorialDetection(),this.reset(s)};this.doDetect(s?"animateDivSelectionClearAll":"animateDivSelectionClear")?n():this.intervalSensorialDetection||(this.intervalSensorialDetection=setInterval(()=>{n()},this.configurationService.sensorialSelectionDelayMs-this.bufferDoDetectSensorial))}}mouseOutReset(){this.configurationService.isAnyControlConfigured()||this.doResetSensorialDetection()}reset(s=!1){s?this.input="":(this.input=this.input.substring(0,this.input.length-1),this.perfomanceIndicatorService.backSpace()),this.redefinedWords(s),this.lastActionExecuted=new Date}mouseOverSpeak(){if(!this.configurationService.isAnyControlConfigured()&&!this.enableLayoutEdition){let s=()=>{this.doResetSensorialDetection(),this.speak()};this.doDetect("animateDivSelectionSpeak")?s():this.intervalSensorialDetection||(this.intervalSensorialDetection=setInterval(()=>{s()},this.configurationService.sensorialSelectionDelayMs-this.bufferDoDetectSensorial))}}mouseOutSpeak(){this.configurationService.isAnyControlConfigured()||this.doResetSensorialDetection()}speak(){this.synthesizeSpeechFromText(this.input),this.lastActionExecuted=new Date}mouseOverSimbols(){if(!this.configurationService.isAnyControlConfigured()&&!this.enableLayoutEdition){let s=()=>{this.changeToSimbols(),this.doResetSensorialDetection()};this.doDetect("animateDivSelectionSimbols")?s():this.intervalSensorialDetection||(this.intervalSensorialDetection=setInterval(()=>{s()},this.configurationService.sensorialSelectionDelayMs-this.bufferDoDetectSensorial))}}mouseOutSimbols(){this.configurationService.isAnyControlConfigured()||this.doResetSensorialDetection()}changeToSimbols(){this.showingSimbols?(this.redefinedWords(),this.showingSimbols=!1,setTimeout(()=>{this.doSetDynamicLayout()},1)):(it.forEach((s,n)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"ptop"+n.toString(),value:s})}),nt.forEach((s,n)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"pbottom"+n.toString(),value:s})}),this.showingSimbols=!0,setTimeout(()=>{this.doSetDynamicLayout()},1))}wordOrLetterSelectedEvent(s){if(this.canSelectWordLetter||this.enableLayoutEdition){if(this.canSelectWordLetter=!1,this.resetAuxDisplay(),this.showingSimbols)yt[s]?this.input+=yt[s]:this.input=this.input+s;else if(this.perfomanceIndicatorService.wordSelected(s),s.length>1){const n=this.input.split(" ");this.input=this.input.substring(0,this.input.length-n[n.length-1].length),this.input=this.input+s,this.insertBlankSpace(!1)}else this.input=this.input+s;this.redefinedWords(),this.doResetSensorialDetection(),this.onResetDasherEvent.next(),this.lastActionExecuted=new Date,setTimeout(()=>{const n=document.getElementById("input");n.focus(),n.setSelectionRange(this.input.length,this.input.length),this.canSelectWordLetter=!0},100)}}synthesizeSpeechFromText(s){var n=new SpeechSynthesisUtterance(s);n.voice=speechSynthesis.getVoices()[0],speechSynthesis.speak(n)}redefinedWords(s=!1){if(s)Se.forEach((r,l)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"ptop"+l.toString(),value:r})}),we.forEach((r,l)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"pbottom"+l.toString(),value:r})});else{const r=this.input.split(" ");var n=this.predicionsService.getWord(r[r.length-1]);if(n.length>0){const u=function Ht(d,s){const n=[],r=[],l=d.slice(0,6);if(l.length>=2&&(n.push(l[0].word),r.push(l[1].word)),s){Se.forEach((m,_)=>{5==_&&_<7&&(l.length>=3&&n.push(l[2].word),l.length>=4&&n.push(l[3].word)),n.push(m)});let u=Se.length-n.length;for(;u>0;)n.pop(),u-=1;we.forEach((m,_)=>{5==_&&_<7&&(l.length>=5&&r.push(l[4].word),l.length>=6&&r.push(l[5].word)),r.push(m)});let p=we.length-r.length;for(;p>0;)r.pop(),p-=1}else{(function $t(d){const s={};d.forEach(l=>{l=l.replace(/\s/g,"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");for(let u=0;u<l.length;u++){const p=l[u];s[p]=(s[p]||0)+1}});const n=Object.entries(s);return n.sort((l,u)=>u[1]-l[1]),n.map(l=>l[0])})(d.map(_=>_.word)).forEach((_,w)=>{w<8&&(rt(w)?n.push(_):r.push(_))});for(let _=2;_<6;_++)l[_]&&(rt(_)?n.push(l[_].word):r.push(l[_].word));const p=Se.concat(we),m=[];p.forEach((_,w)=>{const T=n.findIndex(U=>U==_),J=r.findIndex(U=>U==_);-1==T&&-1==J&&m.push(_)}),m.forEach((_,w)=>{rt(w)?n.push(_):r.push(_)})}return{topWords:n,bottomWords:r}}(n,this.configurationService.keepOrderLetters);u.topWords.forEach((p,m)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"ptop"+m.toString(),value:p})}),u.bottomWords.forEach((p,m)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"pbottom"+m.toString(),value:p})})}else Se.forEach((u,p)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"ptop"+p.toString(),value:u})}),we.forEach((u,p)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"pbottom"+p.toString(),value:u})})}}doDetect(s){return!this.enableLayoutEdition&&(!this.configurationService.isDelayedDetectionAction()||(this[s]||(this.hostEl.nativeElement.style.setProperty("--animation-duration",this.configurationService.sensorialSelectionDelayMs/1e3+"s"),this[s]=!0),this.lastSensorialDetectionTime||(this.lastSensorialDetectionTime=new Date),et(this.lastSensorialDetectionTime,new Date)>=this.configurationService.sensorialSelectionDelayMs))}doTriggerAction(){(0,W.ug)(this.suportDiv,this.limparElementRef.nativeElement)?(this.reset(),this.resetAuxDisplay()):(0,W.ug)(this.suportDiv,this.falarElementRef.nativeElement)?(this.speak(),this.resetAuxDisplay()):(0,W.ug)(this.suportDiv,this.limparTudoElementRef.nativeElement)?(this.reset(!0),this.resetAuxDisplay()):(0,W.ug)(this.suportDiv,this.espacoElementRef.nativeElement)?(this.insertBlankSpace(),this.resetAuxDisplay()):(0,W.ug)(this.suportDiv,this.simboloElementRef.nativeElement)&&(this.changeToSimbols(),this.resetAuxDisplay()),this.doResetSensorialDetection()}doResetSensorialDetection(){!this.configurationService.isDelayedDetectionAction()||(this.animateDivSelectionSpace=!1,this.animateDivSelectionClearAll=!1,this.animateDivSelectionClear=!1,this.animateDivSelectionSpeak=!1,this.animateDivSelectionSimbols=!1,this.lastSensorialDetectionTime=void 0,this.intervalSensorialDetection&&(clearInterval(this.intervalSensorialDetection),this.intervalSensorialDetection=void 0))}listenEditLayout(){this.configurationService.enablePageEdition.pipe((0,gt.b)(500)).subscribe(s=>{s?this.showingSimbols?(it.forEach((n,r)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"ptop"+r.toString(),value:n})}),nt.forEach((n,r)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"pbottom"+r.toString(),value:n})})):(Nt.forEach((n,r)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"ptop"+r.toString(),value:n})}),Bt.forEach((n,r)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"pbottom"+r.toString(),value:n})})):(this.showingSimbols?(it.forEach((n,r)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"ptop"+r.toString(),value:n})}),nt.forEach((n,r)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"pbottom"+r.toString(),value:n})})):(Se.forEach((n,r)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"ptop"+r.toString(),value:n})}),we.forEach((n,r)=>{this.onContentChangedEvent.next({id:this.getIdPrefix()+"pbottom"+r.toString(),value:n})})),this.saveLayout()),this.enableLayoutEdition=s})}doSetDynamicLayout(){if(this.configurationService.layoutType==Dt.m.Customized){const s=this.configurationService.getDynamicLayout(this.showingSimbols);s&&s.forEach(n=>{const r=document.getElementById(n.id);r&&(r.style.position="absolute",r.style.flex="none",r.style.transform=n.transform,r.style.width=n.width+"px",r.style.height=n.height+"px",r.classList.add("el_changed"))})}}saveLayout(){const s=[];this.limparElementRef.nativeElement.parentElement.classList.contains("el_changed")&&s.push({id:this.limparElementRef.nativeElement.parentElement.id,transform:this.limparElementRef.nativeElement.parentElement.style.transform,width:this.limparElementRef.nativeElement.parentElement.getBoundingClientRect().width,height:this.limparElementRef.nativeElement.parentElement.getBoundingClientRect().height}),this.limparTudoElementRef.nativeElement.parentElement.classList.contains("el_changed")&&s.push({id:this.limparTudoElementRef.nativeElement.parentElement.id,transform:this.limparTudoElementRef.nativeElement.parentElement.style.transform,width:this.limparTudoElementRef.nativeElement.parentElement.getBoundingClientRect().width,height:this.limparTudoElementRef.nativeElement.parentElement.getBoundingClientRect().height}),this.simboloElementRef.nativeElement.parentElement.classList.contains("el_changed")&&s.push({id:this.simboloElementRef.nativeElement.parentElement.id,transform:this.simboloElementRef.nativeElement.parentElement.style.transform,width:this.simboloElementRef.nativeElement.parentElement.getBoundingClientRect().width,height:this.simboloElementRef.nativeElement.parentElement.getBoundingClientRect().height}),this.espacoElementRef.nativeElement.parentElement.classList.contains("el_changed")&&s.push({id:this.espacoElementRef.nativeElement.parentElement.id,transform:this.espacoElementRef.nativeElement.parentElement.style.transform,width:this.espacoElementRef.nativeElement.parentElement.getBoundingClientRect().width,height:this.espacoElementRef.nativeElement.parentElement.getBoundingClientRect().height}),this.falarElementRef.nativeElement.parentElement.classList.contains("el_changed")&&s.push({id:this.falarElementRef.nativeElement.parentElement.id,transform:this.falarElementRef.nativeElement.parentElement.style.transform,width:this.falarElementRef.nativeElement.parentElement.getBoundingClientRect().width,height:this.falarElementRef.nativeElement.getBoundingClientRect().height}),this.wordsOrLettersElements.forEach(n=>{s.push({id:n.wordOrLetterElementRef.nativeElement.id,transform:n.wordOrLetterElementRef.nativeElement.style.transform,width:n.wordOrLetterElementRef.nativeElement.getBoundingClientRect().width,height:n.wordOrLetterElementRef.nativeElement.getBoundingClientRect().height})}),this.configurationService.setDynamicLayout(s,this.showingSimbols)}onResize(s,n){const r=this[n].nativeElement.parentElement,l=r.parentElement.getBoundingClientRect().width,u=r.parentElement.getBoundingClientRect().height;r.style.position="absolute",r.style.flex="none",r.style.width=s.currentWidthValue+"px",r.style.height=s.currentHeightValue+"px",r.parentElement.style.width=l+"px",r.parentElement.style.height=u+"px",r.classList.add("el_changed")}cdkDragStarted(s){this[s].nativeElement.parentElement.classList.add("el_changed")}initHidControl(){this.configurationService.isAnyControlConfigured()&&(this.createAuxDisplay(),setTimeout(()=>{this.configurationService.initializeControl()}),this.configurationService.getPacketOutput().pipe((0,gt.b)(this.configurationService.getControlDebounceTime())).subscribe(s=>{this.reciveControlMovedEvent(s.detail)}))}createAuxDisplay(){setTimeout(()=>{this.suportDiv=document.createElement("div"),this.suportDiv.id="suportDiv",this.suportDiv.style.position="absolute";const r=this.centerDivElementRef.nativeElement.offsetTop+this.centerDivElementRef.nativeElement.offsetHeight/2,l=this.playerDivElementRef.nativeElement.clientHeight;this.suportDiv.style.left=100*(this.centerDivElementRef.nativeElement.offsetLeft+this.centerDivElementRef.nativeElement.offsetWidth/2)/this.playerDivElementRef.nativeElement.clientWidth+"%",this.suportDiv.style.top=100*r/l+"%",this.suportDiv.style.width="20px",this.suportDiv.style.height="20px",this.suportDiv.style.zIndex="1",this.suportDiv.style.background="red",this.suportDiv.style.background=this.configurationService.isSensorialDeviceConfigured()?"unset":"red",this.playerDivElementRef.nativeElement.appendChild(this.suportDiv)})}resetAuxDisplay(){this.configurationService.isAnyControlConfigured()&&(this.playerDivElementRef.nativeElement.removeChild(this.suportDiv),this.createAuxDisplay())}setAuxDisplayPositionCenterOn(s){const l=s.offsetTop+s.offsetHeight/2,u=this.playerDivElementRef.nativeElement.clientHeight;this.suportDiv.style.left=100*(s.offsetLeft+s.offsetWidth/2)/this.playerDivElementRef.nativeElement.clientWidth+"%",this.suportDiv.style.top=100*l/u+"%"}identifyJoystickSide(s){this.joystickSide||(s?.analogStickLeft&&Math.abs(s.analogStickLeft.horizontal)!=Math.abs(s.analogStickLeft.vertical)&&(this.joystickSide="left"),s?.analogStickRight&&Math.abs(s.analogStickRight.horizontal)!=Math.abs(s.analogStickRight.vertical)&&(this.joystickSide="right"))}moveByJoystick(s){const n=Number(this.suportDiv.style.left.substring(0,this.suportDiv.style.left.indexOf("%"))),r=Number(this.suportDiv.style.top.substring(0,this.suportDiv.style.top.indexOf("%")));if(this.identifyJoystickSide(s),this.joystickSide){const l="left"==this.joystickSide?s?.analogStickLeft:s?.analogStickRight;(l.horizontal>.1||l.horizontal<-.1)&&(this.suportDiv.style.left=n+l.horizontal*(this.configurationService.dpiSpeed/1e3)>100?"100%":n+l.horizontal*(this.configurationService.dpiSpeed/1e3)<0?"0%":n+l.horizontal*(this.configurationService.dpiSpeed/1e3)+"%",this.mouseMovedEvent.next({clientX:this.suportDiv.getBoundingClientRect().x,clientY:this.suportDiv.getBoundingClientRect().y,HTMLDivElement:this.suportDiv})),(l.vertical>.1||l.vertical<-.1)&&(this.suportDiv.style.top=r+l.vertical*(this.configurationService.dpiSpeed/1e3)>100?"100%":r+l.vertical*(this.configurationService.dpiSpeed/1e3)<0?"0%":r+l.vertical*(this.configurationService.dpiSpeed/1e3)+"%")}}moveBySensorial(s){if(!s.actualAccelerometer?.y||!s.actualAccelerometer?.x)return;let n=s.actualAccelerometer.y>.005,r=s.actualAccelerometer.y<-.005,l=s.actualAccelerometer.x>.005,u=s.actualAccelerometer.x<-.005;if(this.actionSensorialDetectionBuffer.right!=n||this.actionSensorialDetectionBuffer.left!=r||this.actionSensorialDetectionBuffer.top!=l||this.actionSensorialDetectionBuffer.bottom!=u){const m=[this.limparElementRef.nativeElement,this.falarElementRef.nativeElement,this.limparTudoElementRef.nativeElement,this.simboloElementRef.nativeElement,this.espacoElementRef.nativeElement,...this.wordsOrLettersElements.map(T=>T.wordOrLetterElementRef.nativeElement)],_=(0,W.Zu)(this.suportDiv,m);let w;n?w=(0,W.TO)(this.suportDiv,_.right):r?w=(0,W.TO)(this.suportDiv,_.left):l?w=(0,W.TO)(this.suportDiv,_.above):u&&(w=(0,W.TO)(this.suportDiv,_.below)),w&&this.setAuxDisplayPositionCenterOn(w)}this.actionSensorialDetectionBuffer={top:l,right:n,bottom:u,left:r}}moveByCamera(s){this.suportDiv.style.top=s.y+"px",this.suportDiv.style.left=s.x+"px"}reciveControlMovedEvent(s){if(s)if(this.configurationService.isOcularDeviceConfigured()?this.moveByCamera(s):this.configurationService.isSensorialDeviceConfigured()?this.moveBySensorial(s):this.moveByJoystick(s),(0,W.ug)(this.suportDiv,this.limparElementRef.nativeElement)||(0,W.ug)(this.suportDiv,this.falarElementRef.nativeElement)||(0,W.ug)(this.suportDiv,this.limparTudoElementRef.nativeElement)||(0,W.ug)(this.suportDiv,this.espacoElementRef.nativeElement)||(0,W.ug)(this.suportDiv,this.simboloElementRef.nativeElement)){let r="";(0,W.ug)(this.suportDiv,this.limparElementRef.nativeElement)?r="animateDivSelectionClear":(0,W.ug)(this.suportDiv,this.falarElementRef.nativeElement)?r="animateDivSelectionSpeak":(0,W.ug)(this.suportDiv,this.limparTudoElementRef.nativeElement)?r="animateDivSelectionClearAll":(0,W.ug)(this.suportDiv,this.espacoElementRef.nativeElement)?r="animateDivSelectionSpace":(0,W.ug)(this.suportDiv,this.simboloElementRef.nativeElement)&&(r="animateDivSelectionSimbols"),this.doDetect(r)&&this.doTriggerAction()}else this.doResetSensorialDetection()}static#e=this.\u0275fac=function(n){return new(n||Ue)(i.Y36(tt.x),i.Y36(Je),i.Y36($e),i.Y36(i.SBq))};static#t=this.\u0275cmp=i.Xpm({type:Ue,selectors:[["app-dasher-on-screen"]],viewQuery:function(n,r){if(1&n&&(i.Gf(jt,5),i.Gf(Yt,5),i.Gf(Xt,5),i.Gf(ei,5),i.Gf(ti,5),i.Gf(ii,5),i.Gf(ni,5),i.Gf(Ne,5)),2&n){let l;i.iGM(l=i.CRH())&&(r.limparElementRef=l.first),i.iGM(l=i.CRH())&&(r.falarElementRef=l.first),i.iGM(l=i.CRH())&&(r.limparTudoElementRef=l.first),i.iGM(l=i.CRH())&&(r.espacoElementRef=l.first),i.iGM(l=i.CRH())&&(r.centerDivElementRef=l.first),i.iGM(l=i.CRH())&&(r.simboloElementRef=l.first),i.iGM(l=i.CRH())&&(r.playerDivElementRef=l.first),i.iGM(l=i.CRH())&&(r.wordsOrLettersElements=l)}},decls:66,vars:51,consts:[["fxLayout","column","fxFill",""],["fxFlex","5"],["id","input","matInput","","type","text",3,"ngModel","ngModelChange"],["id","playerDivElementRef","fxFlex","",2,"background-color","lightgoldenrodyellow"],["playerDivElementRef",""],["fxLayoutAlign","center start",3,"ngClass"],["class","icon-display",4,"ngIf"],["diameter","40",4,"ngIf"],[1,"grid-start-actions"],["id","limparTudoBoxRef","cdkDrag","","fxLayoutAlign","center none",1,"mid-start-header",3,"cdkDragDisabled","ngClass","cdkDragStarted","click"],["limparTudoBoxRef",""],["class","resize resize__right",3,"targetElement","direction","resize",4,"ngIf"],["class","resize resize__bottom",3,"targetElement","direction","resize",4,"ngIf"],["class","resize resize__top",3,"targetElement","direction","resize",4,"ngIf"],["class","resize resize__left",3,"targetElement","direction","resize",4,"ngIf"],["fxLayoutAlign","center center",1,"label-default-font-size",3,"mouseover","mouseout"],["limparTudoElementRef",""],["class","mid-start-header ghost-container","fxLayoutAlign","center none",4,"ngIf"],["id","simbolosBoxRef","cdkDrag","","fxLayoutAlign","center none",1,"mid-start",3,"cdkDragDisabled","ngClass","cdkDragStarted","click"],["simbolosBoxRef",""],["simboloElementRef",""],["class","mid-start ghost-container","fxLayoutAlign","center none",4,"ngIf"],["id","falarBoxRef","cdkDrag","","fxLayoutAlign","center none",1,"mid-start-bottom",3,"cdkDragDisabled","ngClass","cdkDragStarted","click"],["falarBoxRef",""],["falarElementRef",""],["class","mid-start-bottom ghost-container","fxLayoutAlign","center none",4,"ngIf"],["id","espacoBoxRef","cdkDrag","","fxLayoutAlign","center none",1,"mid-start-header2",3,"cdkDragDisabled","ngClass","cdkDragStarted","click"],["espacoBoxRef",""],["id","espacoElementRef","fxLayoutAlign","center center",1,"label-default-font-size",3,"mouseover","mouseout"],["espacoElementRef",""],["class","mid-start-header2 ghost-container","fxLayoutAlign","center center",4,"ngIf"],["id","centerDivElementRef"],["centerDivElementRef",""],["id","limparBoxRef","cdkDrag","","fxLayoutAlign","center none",1,"mid-start-bottom2",3,"cdkDragDisabled","ngClass","cdkDragStarted","click"],["limparBoxRef",""],["id","limparElementRef","fxLayoutAlign","center center",1,"label-default-font-size",3,"mouseover","mouseout"],["limparElementRef",""],["class","mid-start-bottom2 ghost-container","fxLayoutAlign","center none",4,"ngIf"],[2,"width","100px"],["fxFlex","","fxLayout","column","fxFill","",4,"ngIf"],[1,"icon-display"],["diameter","40"],[1,"resize","resize__right",3,"targetElement","direction","resize"],[1,"resize","resize__bottom",3,"targetElement","direction","resize"],[1,"resize","resize__top",3,"targetElement","direction","resize"],[1,"resize","resize__left",3,"targetElement","direction","resize"],["fxLayoutAlign","center none",1,"mid-start-header","ghost-container"],["fxLayoutAlign","center center",1,"label-default-font-size"],["fxLayoutAlign","center none",1,"mid-start","ghost-container"],["fxLayoutAlign","center none",1,"mid-start-bottom","ghost-container"],["fxLayoutAlign","center center",1,"mid-start-header2","ghost-container"],["fxLayoutAlign","center none",1,"mid-start-bottom2","ghost-container"],["fxFlex","","fxLayout","column","fxFill",""],["fxFill","",1,"grid-container-horizontal"],["fxFill","",1,"grid-header1"],["fxLayout","row","fxFill",""],["ngFor","",3,"ngForOf"],[1,"grid-mainh"],["fxFill","",1,"grid-header2"],[1,"grid-main"],["fxFill","",1,"grid-bottom1"],[1,"grid-mainb"],["fxFill","",1,"grid-bottom2"],["fxFlex","","fxFill","",3,"elId","showBackGroundSelection","mouseMovedEvent","onResetDasherEvent","enableLayoutEdition","onContentChangedEvent","click","wordOrLetterSelectedEvent",4,"ngIf"],["fxFlex","","fxFill","",3,"elId","showBackGroundSelection","mouseMovedEvent","onResetDasherEvent","enableLayoutEdition","onContentChangedEvent","click","wordOrLetterSelectedEvent"],["style","width: 100px;",4,"ngIf"],["fxFill","",1,"grid-container-vertical"]],template:function(n,r){if(1&n&&(i.TgZ(0,"div",0)(1,"div",1)(2,"mat-form-field")(3,"input",2),i.NdJ("ngModelChange",function(u){return r.input=u}),i.qZA()()(),i.TgZ(4,"div",3,4)(6,"div",5)(7,"div"),i.YNc(8,ri,2,0,"mat-icon",6),i.YNc(9,si,1,0,"mat-spinner",7),i.qZA()(),i.TgZ(10,"div",8)(11,"div",9,10),i.NdJ("cdkDragStarted",function(){return r.cdkDragStarted("limparTudoElementRef")})("click",function(){return r.onClickElementCalibration(0,"limparTudoElementRef")}),i.YNc(13,oi,1,2,"div",11),i.YNc(14,ai,1,2,"div",12),i.YNc(15,li,1,2,"div",13),i.YNc(16,ci,1,2,"div",14),i.TgZ(17,"p",15,16),i.NdJ("mouseover",function(){return r.mouseOverReset(!0)})("mouseout",function(){return r.mouseOutReset()}),i._uU(19,"Limpar Toda Digita\xe7\xe3o"),i.qZA()(),i.YNc(20,hi,3,0,"div",17),i.TgZ(21,"div",18,19),i.NdJ("cdkDragStarted",function(){return r.cdkDragStarted("simboloElementRef")})("click",function(){return r.onClickElementCalibration(0,"simboloElementRef")}),i.YNc(23,di,1,2,"div",11),i.YNc(24,ui,1,2,"div",12),i.YNc(25,fi,1,2,"div",13),i.YNc(26,pi,1,2,"div",14),i.TgZ(27,"p",15,20),i.NdJ("mouseover",function(){return r.mouseOverSimbols()})("mouseout",function(){return r.mouseOutSimbols()}),i._uU(29,"Simbolos"),i.qZA()(),i.YNc(30,gi,3,0,"div",21),i.TgZ(31,"div",22,23),i.NdJ("cdkDragStarted",function(){return r.cdkDragStarted("falarElementRef")})("click",function(){return r.onClickElementCalibration(0,"falarElementRef")}),i.YNc(33,mi,1,2,"div",11),i.YNc(34,vi,1,2,"div",12),i.YNc(35,_i,1,2,"div",13),i.YNc(36,yi,1,2,"div",14),i.TgZ(37,"p",15,24),i.NdJ("mouseover",function(){return r.mouseOverSpeak()})("mouseout",function(){return r.mouseOutSpeak()}),i._uU(39,"Falar Texto Completo"),i.qZA()(),i.YNc(40,Di,3,0,"div",25),i.TgZ(41,"div",26,27),i.NdJ("cdkDragStarted",function(){return r.cdkDragStarted("espacoElementRef")})("click",function(){return r.onClickElementCalibration(0,"espacoElementRef")}),i.YNc(43,bi,1,2,"div",11),i.YNc(44,Ei,1,2,"div",12),i.YNc(45,Si,1,2,"div",13),i.YNc(46,wi,1,2,"div",14),i.TgZ(47,"p",28,29),i.NdJ("mouseover",function(){return r.mouseOverBlankSpace()})("mouseout",function(){return r.mouseOutBlankSpace()}),i._uU(49," Inserir Espa\xe7o"),i.qZA()(),i.YNc(50,Ci,3,0,"div",30),i._UZ(51,"div",31,32),i.TgZ(53,"div",33,34),i.NdJ("cdkDragStarted",function(){return r.cdkDragStarted("limparElementRef")})("click",function(){return r.onClickElementCalibration(0,"limparElementRef")}),i.YNc(55,xi,1,2,"div",11),i.YNc(56,Ii,1,2,"div",12),i.YNc(57,Oi,1,2,"div",13),i.YNc(58,Pi,1,2,"div",14),i.TgZ(59,"p",35,36),i.NdJ("mouseover",function(){return r.mouseOverReset(!1)})("mouseout",function(){return r.mouseOutReset()}),i._uU(61," Limpar \xdaltimo "),i.qZA()(),i.YNc(62,ki,3,0,"div",37),i.qZA(),i._UZ(63,"div",38),i.YNc(64,$i,17,4,"div",39),i.YNc(65,Zi,9,2,"div",39),i.qZA()()),2&n){const l=i.MAs(12),u=i.MAs(22),p=i.MAs(32),m=i.MAs(42),_=i.MAs(54);i.xp6(3),i.Q6J("ngModel",r.input),i.xp6(3),i.Q6J("ngClass",r.isAfk?"start-div":"stop-div"),i.xp6(2),i.Q6J("ngIf",r.isAfk),i.xp6(1),i.Q6J("ngIf",!r.isAfk),i.xp6(2),i.ekj("fill-animation",r.animateDivSelectionClearAll),i.Q6J("cdkDragDisabled",!r.enableLayoutEdition)("ngClass",r.clickElementsCount.get("limparTudoElementRef_0")==r.defaultCalibrationCount?"action-div-border-color":"action-div-border"),i.xp6(2),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(4),i.Q6J("ngIf","absolute"===l.style.position),i.xp6(1),i.ekj("fill-animation",r.animateDivSelectionSimbols),i.Q6J("cdkDragDisabled",!r.enableLayoutEdition)("ngClass",r.clickElementsCount.get("simboloElementRef_0")==r.defaultCalibrationCount?"action-div-border-color":"action-div-border"),i.xp6(2),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(4),i.Q6J("ngIf","absolute"===u.style.position),i.xp6(1),i.ekj("fill-animation",r.animateDivSelectionSpeak),i.Q6J("cdkDragDisabled",!r.enableLayoutEdition)("ngClass",r.clickElementsCount.get("falarElementRef_0")==r.defaultCalibrationCount?"action-div-border-color":"action-div-border"),i.xp6(2),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(4),i.Q6J("ngIf","absolute"===p.style.position),i.xp6(1),i.ekj("fill-animation",r.animateDivSelectionSpace),i.Q6J("cdkDragDisabled",!r.enableLayoutEdition)("ngClass",r.clickElementsCount.get("espacoElementRef_0")==r.defaultCalibrationCount?"action-div-border-color":"action-div-border"),i.xp6(2),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(4),i.Q6J("ngIf","absolute"===m.style.position),i.xp6(3),i.ekj("fill-animation",r.animateDivSelectionClear),i.Q6J("cdkDragDisabled",!r.enableLayoutEdition)("ngClass",r.clickElementsCount.get("limparElementRef_0")==r.defaultCalibrationCount?"action-div-border-color":"action-div-border"),i.xp6(2),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(1),i.Q6J("ngIf",r.enableLayoutEdition),i.xp6(4),i.Q6J("ngIf","absolute"===_.style.position),i.xp6(2),i.Q6J("ngIf",r.layoutType==r.layoutTypes.TypeFourLines||r.layoutType==r.layoutTypes.Customized&&r.lastLayoutType==r.layoutTypes.TypeFourLines),i.xp6(1),i.Q6J("ngIf",r.layoutType==r.layoutTypes.TypeTwoLines||r.layoutType==r.layoutTypes.Customized&&r.lastLayoutType==r.layoutTypes.TypeTwoLines)}},dependencies:[j.mk,j.sg,j.O5,Ee.xw,Ee.Wh,Ee.s9,Ee.yH,vt.oO,G.Nt,B.KE,O.Fj,O.JJ,O.On,Ve.Hw,se,ft,mt,Ne],styles:['[_nghost-%COMP%]{--animation-duration: 5s}.icon-display[_ngcontent-%COMP%]{margin-top:20px;transform:scale(1.5)}.start-div[_ngcontent-%COMP%]{width:50px;background-color:#fcafaf;align-items:center!important}.stop-div[_ngcontent-%COMP%]{width:50px;background-color:#67ff67;align-items:center!important}.action-div-border[_ngcontent-%COMP%]{border-width:2px;border-style:groove;border-color:#fafad2;background:linear-gradient(to right,rgb(230,255,230) 50%,transparent 0);background-size:200% 100%;background-position:right;position:relative;background-color:#fff}.action-div-border-color[_ngcontent-%COMP%]{border-width:2px;border-style:groove;border-color:#fafad2;background:linear-gradient(to right,rgb(230,255,230) 50%,transparent 0);background-size:200% 100%;background-position:right;position:relative;background-color:#fafad2}[_nghost-%COMP%]  mat-form-field{display:flex;height:100%}[_nghost-%COMP%]  mat-form-field .mat-mdc-text-field-wrapper{height:100%}[_nghost-%COMP%]  mat-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex{height:100%}[_nghost-%COMP%]  mat-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-form-field-infix{padding:0!important;height:100%;min-height:unset}[_nghost-%COMP%]  mat-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-form-field-infix input{height:100%}[_nghost-%COMP%]  mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.grid-header1[_ngcontent-%COMP%]{grid-area:header1}.grid-mainh[_ngcontent-%COMP%]{grid-area:mainh}.grid-header2[_ngcontent-%COMP%]{grid-area:header2}.grid-main[_ngcontent-%COMP%]{grid-area:main}.grid-bottom1[_ngcontent-%COMP%]{grid-area:bottom1}.grid-mainb[_ngcontent-%COMP%]{grid-area:mainb}.grid-bottom2[_ngcontent-%COMP%]{grid-area:bottom2}.grid-container-horizontal[_ngcontent-%COMP%]{display:grid;grid-template-areas:"header1" "mainh" "header2" "main" "bottom1" "mainb" "bottom2";grid-template-rows:repeat(7,1fr)}.grid-container-vertical[_ngcontent-%COMP%]{display:grid;grid-template-areas:"header1" "main" "bottom1";grid-template-rows:repeat(3,1fr)}.mid-start-header[_ngcontent-%COMP%]{grid-area:mid-start-header}.mid-start-bottom[_ngcontent-%COMP%]{grid-area:mid-start-bottom}.mid-start-header2[_ngcontent-%COMP%]{grid-area:mid-start-header2}.mid-start-bottom2[_ngcontent-%COMP%]{grid-area:mid-start-bottom2}.mid-start[_ngcontent-%COMP%]{grid-area:mid-start}.ghost-container[_ngcontent-%COMP%]{opacity:0}.grid-start-actions[_ngcontent-%COMP%]{display:grid;grid-template-areas:"mid-start-header mid-start-header2" "mid-start-header mid-666" "mid-start mid-666" "mid-start-bottom mid-666" "mid-start-bottom mid-start-bottom2";grid-template-rows:2fr 1fr 100px 1fr 2fr;position:relative}@keyframes _ngcontent-%COMP%_makeItfadeIn{to{background-position:left}}.fill-animation[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_makeItfadeIn var(--animation-duration) 0s forwards}']})}const qi=[{path:"dasher-on-screen",component:Ue},{path:"**",redirectTo:"dasher-on-screen"}];class Qe{static#e=this.\u0275fac=function(n){return new(n||Qe)};static#t=this.\u0275mod=i.oAB({type:Qe});static#i=this.\u0275inj=i.cJS({imports:[pt.Bz.forChild(qi),pt.Bz]})}class je{static#e=this.\u0275fac=function(n){return new(n||je)};static#t=this.\u0275mod=i.oAB({type:je});static#i=this.\u0275inj=i.cJS({imports:[j.ez,Qe,ge.o9,G.c,B.lN,O.u5,Ve.Ps,ne,Rt,Tt]})}},9820:function(He,Ie){var ge;void 0!==(ge=function(){return function(){function G(O,i){if(this.app="loki",this.options=i||{},typeof O<"u"&&(this.app=O),this.catalog=null,!this.checkAvailability())throw new Error("indexedDB does not seem to be supported for your environment")}function B(O){this.db=null,this.initializeLokiCatalog(O)}return G.prototype.closeDatabase=function(){this.catalog&&this.catalog.db&&(this.catalog.db.close(),this.catalog.db=null)},G.prototype.checkAvailability=function(){return!!(typeof indexedDB<"u"&&indexedDB)},G.prototype.loadKey=G.prototype.loadDatabase=function(O,i){var y=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(this.app,O,function(S){if("function"==typeof i){if(0===S.id)return void i(null);i(S.val)}else console.log(S.val)}):this.catalog=new B(function(S){y.catalog=S,y.loadDatabase(O,i)})},G.prototype.saveKey=G.prototype.saveDatabase=function(O,i,L){var S=this;function R($){L($&&!0===$.success?null:new Error("Error saving database")),S.options.closeAfterSave&&S.closeDatabase()}null!==this.catalog&&null!==this.catalog.db?this.catalog.setAppKey(this.app,O,i,R):this.catalog=new B(function($){S.saveDatabase(O,i,R)})},G.prototype.deleteKey=G.prototype.deleteDatabase=function(O,i){var y=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(this.app,O,function(S){var R=S.id;0!==R?y.catalog.deleteAppKey(R,i):"function"==typeof i&&i({success:!0})}):this.catalog=new B(function(S){y.catalog=S,y.deleteDatabase(O,i)})},G.prototype.deleteDatabasePartitions=function(O){var i=this;this.getDatabaseList(function(L){L.forEach(function(y){y.startsWith(O)&&i.deleteDatabase(y)})})},G.prototype.getKeyList=G.prototype.getDatabaseList=function(O){var L=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKeys(this.app,function(y){for(var S=[],R=0;R<y.length;R++)S.push(y[R].key);"function"==typeof O?O(S):S.forEach(function($){console.log($)})}):this.catalog=new B(function(y){L.catalog=y,L.getDatabaseList(O)})},G.prototype.getCatalogSummary=function(O){var L=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAllKeys(function(y){for(var R,S=[],Z=0;Z<y.length;Z++)S.push({app:(R=y[Z]).app,key:R.key,size:2*(R.app||"").length+2*(R.key||"").length+(R.val||"").length+1});"function"==typeof O?O(S):S.forEach(function(se){console.log(se)})}):this.catalog=new B(function(y){L.catalog=y,L.getCatalogSummary(O)})},B.prototype.initializeLokiCatalog=function(O){var i=indexedDB.open("LokiCatalog",1),L=this;i.onupgradeneeded=function(y){var S=y.target.result;if(S.objectStoreNames.contains("LokiAKV")&&S.deleteObjectStore("LokiAKV"),!S.objectStoreNames.contains("LokiAKV")){var R=S.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0});R.createIndex("app","app",{unique:!1}),R.createIndex("key","key",{unique:!1}),R.createIndex("appkey","appkey",{unique:!0})}},i.onsuccess=function(y){L.db=y.target.result,"function"==typeof O&&O(L)},i.onerror=function(y){throw y}},B.prototype.getAppKey=function(O,i,L){var N,Y=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("appkey").get(O+","+i);Y.onsuccess=(N=L,function(K){var Z=K.target.result;(null===Z||typeof Z>"u")&&(Z={id:0,success:!1}),"function"==typeof N?N(Z):console.log(Z)}),Y.onerror=function(N){return function(K){if("function"!=typeof N)throw K;N({id:0,success:!1})}}(L)},B.prototype.getAppKeyById=function(O,i,L){var $,Y;this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").get(O).onsuccess=($=L,Y=i,function(N){"function"==typeof Y?Y(N.target.result,$):console.log(N.target.result)})},B.prototype.setAppKey=function(O,i,L,y){var K,R=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV"),N=R.index("appkey").get(O+","+i);N.onsuccess=function(K){var Z=K.target.result;null==Z?Z={app:O,key:i,appkey:O+","+i,val:L}:Z.val=L;var te,se=R.put(Z);se.onerror=(te=y,function(ne){"function"==typeof te?te({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(N.error))}),se.onsuccess=function(te){return function(ne){"function"==typeof te&&te({success:!0})}}(y)},N.onerror=(K=y,function(Z){"function"==typeof K?K({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(N.error))})},B.prototype.deleteAppKey=function(O,i){var R,S=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV").delete(O);S.onsuccess=(R=i,function($){"function"==typeof R&&R({success:!0})}),S.onerror=function(R){return function($){"function"==typeof R?R({success:!1}):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(S.error))}}(i)},B.prototype.getAppKeys=function(O,i){var N,K,S=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("app"),R=IDBKeyRange.only(O),$=S.openCursor(R);$.onsuccess=(N=[],K=i,function(Z){var se=Z.target.result;se?(N.push(se.value),se.continue()):"function"==typeof K?K(N):console.log(N)}),$.onerror=function(N){return function(K){"function"==typeof N?N(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(K))}}(i)},B.prototype.getAllKeys=function(O){var R,$,y=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").openCursor();y.onsuccess=(R=[],$=O,function(Y){var N=Y.target.result;N?(R.push(N.value),N.continue()):"function"==typeof $?$(R):console.log(R)}),y.onerror=function(R){return function($){"function"==typeof R&&R(null)}}(O)},G}()}.apply(Ie,[]))&&(He.exports=ge)},2527:function(He,Ie,k){var j,G;j=function(){return function(){"use strict";var B=Object.prototype.hasOwnProperty;function O(e){var t,o;if(Array.isArray(e)){for(o=0;o<e.length;o++)O(e[o]);i(e)}else if(null!==e&&"object"==typeof e){for(t in e)e.hasOwnProperty(t)&&O(e[t]);i(e)}}function i(e){Object.isFrozen(e)||Object.freeze(e)}function L(e){return Object.isFrozen(e)?H(e,"shallow"):e}var y={copyProperties:function(e,t){var o;for(o in e)t[o]=e[o]},resolveTransformObject:function(e,t,o){var a,c;if("number"!=typeof o&&(o=0),++o>=10)return e;for(a in e)"string"==typeof e[a]&&0===e[a].indexOf("[%lktxp]")?(c=e[a].substring(8),t.hasOwnProperty(c)&&(e[a]=t[c])):"object"==typeof e[a]&&(e[a]=y.resolveTransformObject(e[a],t,o));return e},resolveTransformParams:function(e,t){var o,a,c=[];if(typeof t>"u")return e;for(o=0;o<e.length;o++)a=H(e[o],"shallow-recurse-objects"),c.push(y.resolveTransformObject(a,t));return c},getIn:function(e,t,o){if(null!=e){if(!o)return e[t];if("string"==typeof t&&(t=t.split(".")),!Array.isArray(t))throw new Error("path must be a string or array. Found "+typeof t);for(var a=0,c=t.length;null!=e&&a<c;)e=e[t[a++]];return a&&a==c?e:void 0}}},S={aeq:R,lt:$,gt:Y};function R(e,t){var o,a,c,h;if(e===t)return!0;if(!e||!t||!0===e||!0===t||e!=e||t!=t){switch(e){case void 0:case null:c=1;break;case!1:c=3;break;case!0:c=4;break;case"":c=5;break;default:c=e==e?9:0}switch(t){case void 0:case null:h=1;break;case!1:h=3;break;case!0:h=4;break;case"":h=5;break;default:h=t==t?9:0}if(9!==c||9!==h)return c===h}return o=Number(e),a=Number(t),o==o||a==a?o===a:(o=e.toString())==(a=t.toString())}function $(e,t,o){var a,c,h,f;if(!e||!t||!0===e||!0===t||e!=e||t!=t){switch(e){case void 0:case null:h=1;break;case!1:h=3;break;case!0:h=4;break;case"":h=5;break;default:h=e==e?9:0}switch(t){case void 0:case null:f=1;break;case!1:f=3;break;case!0:f=4;break;case"":f=5;break;default:f=t==t?9:0}if(9!==h||9!==f)return h===f?o:h<f}return a=Number(e),c=Number(t),a==a&&c==c?a<c||!(a>c)&&o:a==a&&c!=c||(c!=c||a==a)&&(e<t||!(e>t)&&(e==t?o:(a=e.toString())<(c=t.toString())||a==c&&o))}function Y(e,t,o){var a,c,h,f;if(!e||!t||!0===e||!0===t||e!=e||t!=t){switch(e){case void 0:case null:h=1;break;case!1:h=3;break;case!0:h=4;break;case"":h=5;break;default:h=e==e?9:0}switch(t){case void 0:case null:f=1;break;case!1:f=3;break;case!0:f=4;break;case"":f=5;break;default:f=t==t?9:0}if(9!==h||9!==f)return h===f?o:h>f}return a=Number(e),c=Number(t),a==a&&c==c?a>c||!(a<c)&&o:(a!=a||c==c)&&(c==c&&a!=a||e>t||!(e<t)&&(e==t?o:(a=e.toString())>(c=t.toString())||a==c&&o))}function N(e,t,o){return S.aeq(e,t)?0:S.lt(e,t,!1)?o?1:-1:S.gt(e,t,!1)?o?-1:1:0}function Z(e,t,o,a,c,h){var b,f=h||0,g=t[f],v=!1;if("object"==typeof e&&g in e&&(b=e[g]),f+1>=t.length)v=o(b,a,c);else if(Array.isArray(b))for(var E=0,C=b.length;E<C&&!0!==(v=Z(b[E],t,o,a,c,f+1));E+=1);else v=Z(b,t,o,a,c,f+1);return v}function se(e){return"string"==typeof e||Array.isArray(e)?function(t){return-1!==e.indexOf(t)}:"object"==typeof e&&null!==e?function(t){return B.call(e,t)}:null}function te(e,t,o){for(var a in t)if(B.call(t,a))return ne[a](e,t[a],o);return!1}var ne={$eq:function(e,t){return e===t},$aeq:function(e,t){return e==t},$ne:function(e,t){return t!=t?e==e:e!==t},$dteq:function(e,t){return S.aeq(e,t)},$gt:function(e,t){return S.gt(e,t,!1)},$gte:function(e,t){return S.gt(e,t,!0)},$lt:function(e,t){return S.lt(e,t,!1)},$lte:function(e,t){return S.lt(e,t,!0)},$jgt:function(e,t){return e>t},$jgte:function(e,t){return e>=t},$jlt:function(e,t){return e<t},$jlte:function(e,t){return e<=t},$between:function(e,t){return null!=e&&S.gt(e,t[0],!0)&&S.lt(e,t[1],!0)},$jbetween:function(e,t){return null!=e&&e>=t[0]&&e<=t[1]},$in:function(e,t){return-1!==t.indexOf(e)},$inSet:function(e,t){return t.has(e)},$nin:function(e,t){return-1===t.indexOf(e)},$keyin:function(e,t){return e in t},$nkeyin:function(e,t){return!(e in t)},$definedin:function(e,t){return void 0!==t[e]},$undefinedin:function(e,t){return void 0===t[e]},$regex:function(e,t){return t.test(e)},$containsString:function(e,t){return"string"==typeof e&&-1!==e.indexOf(t)},$containsNone:function(e,t){return!ne.$containsAny(e,t)},$containsAny:function(e,t){var o=se(e);return null!==o&&(Array.isArray(t)?t.some(o):o(t))},$contains:function(e,t){var o=se(e);return null!==o&&(Array.isArray(t)?t.every(o):o(t))},$elemMatch:function(e,t){return!!Array.isArray(e)&&e.some(function(o){return Object.keys(t).every(function(a){var c=t[a];return"object"==typeof c&&c||(c={$eq:c}),-1!==a.indexOf(".")?Z(o,a.split("."),te,t[a],o):te(o[a],c,o)})})},$type:function(e,t,o){var a=typeof e;return"object"===a&&(Array.isArray(e)?a="array":e instanceof Date&&(a="date")),"object"!=typeof t?a===t:te(a,t,o)},$finite:function(e,t){return t===isFinite(e)},$size:function(e,t,o){return!!Array.isArray(e)&&("object"!=typeof t?e.length===t:te(e.length,t,o))},$len:function(e,t,o){return"string"==typeof e&&("object"!=typeof t?e.length===t:te(e.length,t,o))},$where:function(e,t){return!0===t(e)},$not:function(e,t,o){return!te(e,t,o)},$and:function(e,t,o){for(var a=0,c=t.length;a<c;a+=1)if(!te(e,t[a],o))return!1;return!0},$or:function(e,t,o){for(var a=0,c=t.length;a<c;a+=1)if(te(e,t[a],o))return!0;return!1},$exists:function(e,t){return t?void 0!==e:void 0===e}};["$eq","$aeq","$ne","$dteq","$gt","$gte","$lt","$lte","$jgt","$jgte","$jlt","$jlte","$type"].forEach(function(e){var t=ne[e];ne["$"+e]=function(o,a,c){if("string"==typeof a)return t(o,c[a]);if("function"==typeof a)return t(o,a(c));throw new Error("Invalid argument to $$ matcher")}});var Oe={$eq:ne.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0};function H(e,t){if(null==e)return null;var a;switch(t||"parse-stringify"){case"parse-stringify":a=JSON.parse(JSON.stringify(e));break;case"jquery-extend-deep":a=jQuery.extend(!0,{},e);break;case"shallow":a=Object.create(e.constructor.prototype),Object.keys(e).map(function(h){a[h]=e[h]});break;case"shallow-assign":a=Object.create(e.constructor.prototype),Object.assign(a,e);break;case"shallow-recurse-objects":a=H(e,"shallow"),Object.keys(e).forEach(function(h){"object"==typeof e[h]&&"Object"===e[h].constructor.name?a[h]=H(e[h],"shallow-recurse-objects"):Array.isArray(e[h])&&(a[h]=function Ze(e,t){if("parse-stringify"==t)return H(e,t);for(var o=[],a=0,c=e.length;a<c;a++)o[a]=H(e[a],t);return o}(e[h],"shallow-recurse-objects"))})}return a}function V(){try{return window&&void 0!==window.localStorage&&null!==window.localStorage}catch{return!1}}function ie(){}function P(e,t){this.filename=e||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=!(!t||!t.hasOwnProperty("verbose"))&&t.verbose,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]};this.ENV=t&&t.hasOwnProperty("env")?t.env:typeof global<"u"&&(global.android||global.NSObject)?"NATIVESCRIPT":typeof window>"u"||typeof global<"u"&&global.window&&typeof process<"u"?"NODEJS":typeof document<"u"?-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER":"CORDOVA","undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(t,!0),this.on("init",this.clearChanges)}function ye(e){this.hashStore={},this.options=e||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}function ue(e,t){if(this.mode="reference",this.adapter=null,this.options=t||{},this.dbref=null,this.dbname="",this.pageIterator={},!e)throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");if("reference"===e.mode)throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=e,this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=26214400),this.options.hasOwnProperty("delimiter")||(this.options.delimiter="$<\n")}function me(){try{this.fs=k(Object(function(){var t=new Error("Cannot find module 'fs'");throw t.code="MODULE_NOT_FOUND",t}()))}catch{this.fs=null}}function fe(){}function M(e,t){return t=t||{},this.collection=e,this.filteredrows=[],this.filterInitialized=!1,this}function Pe(e,t){if("$regex"===e)Array.isArray(t)?t=new RegExp(t[0],t[1]):t instanceof RegExp||(t=new RegExp(t));else if("object"==typeof t)for(var o in t)("$regex"===o||"object"==typeof t[o])&&(t[o]=Pe(o,t[o]));return t}function F(e,t,o){this.collection=e,this.name=t,this.rebuildPending=!1,this.options=o||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.options.hasOwnProperty("minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new M(e),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.collection.disableFreeze||Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[],filter:[],sort:[]}}function D(e,t){this.name=e,this.data=[],this.idIndex=null,this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var o=this;(t=t||{}).hasOwnProperty("unique")&&(Array.isArray(t.unique)||(t.unique=[t.unique]),t.unique.forEach(function(b){o.uniqueNames.push(b)})),t.hasOwnProperty("exact")&&t.exact.forEach(function(b){o.constraints.exact[b]=new _e(b)}),this.adaptiveBinaryIndices=!t.hasOwnProperty("adaptiveBinaryIndices")||t.adaptiveBinaryIndices,this.transactional=!!t.hasOwnProperty("transactional")&&t.transactional,this.cloneObjects=!!t.hasOwnProperty("clone")&&t.clone,this.cloneMethod=t.hasOwnProperty("cloneMethod")?t.cloneMethod:"parse-stringify",this.asyncListeners=!!t.hasOwnProperty("asyncListeners")&&t.asyncListeners,this.disableMeta=!!t.hasOwnProperty("disableMeta")&&t.disableMeta,this.disableChangesApi=!t.hasOwnProperty("disableChangesApi")||t.disableChangesApi,this.disableDeltaChangesApi=!t.hasOwnProperty("disableDeltaChangesApi")||t.disableDeltaChangesApi,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=!!t.hasOwnProperty("autoupdate")&&t.autoupdate,this.serializableIndices=!t.hasOwnProperty("serializableIndices")||t.serializableIndices,this.disableFreeze=!t.hasOwnProperty("disableFreeze")||t.disableFreeze,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(t.ttl||-1,t.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.dirtyIds=[];var a=[];if(t&&t.indices)if("[object Array]"===Object.prototype.toString.call(t.indices))a=t.indices;else{if("string"!=typeof t.indices)throw new TypeError("Indices needs to be a string or an array of strings");a=[t.indices]}for(var c=0;c<a.length;c++)this.ensureIndex(a[c]);function g(b,E){var C=null!==E&&"object"==typeof E?Object.keys(E):null;if(C&&C.length&&["string","boolean","number"].indexOf(typeof E)<0){for(var x={},I=0;I<C.length;I++){var A=C[I];if(E.hasOwnProperty(A))if(!b.hasOwnProperty(A)||o.uniqueNames.indexOf(A)>=0||"$loki"==A||"meta"==A)x[A]=E[A];else{var q=g(b[A],E[A]);typeof q<"u"&&q!={}&&(x[A]=q)}}return 0===Object.keys(x).length?void 0:x}return b===E?void 0:E}function v(){o.changes=[]}this.observerCallback=function h(b){var E="function"==typeof Set?new Set:[];E.add||(E.add=function(C){return-1===this.indexOf(C)&&this.push(C),this}),b.forEach(function(C){E.add(C.object)}),E.forEach(function(C){if(!B.call(C,"$loki"))return o.removeAutoUpdateObserver(C);try{o.update(C)}catch{}})},this.getChangeDelta=function f(b,E){return E?g(E,b):JSON.parse(JSON.stringify(b))},this.getObjectDelta=g,this.getChanges=function(){return o.changes},this.flushChanges=v,this.setChangesApi=function(b){o.disableChangesApi=!b,b||(o.disableDeltaChangesApi=!1)},this.on("delete",function(E){o.disableChangesApi||o.createChange(o.name,"R",E)}),this.on("warning",function(b){o.lokiConsoleWrapper.warn(b)}),v()}function ke(e){return-1!==e.indexOf(".")}function Ye(e){return parseFloat(e,10)}function Xe(e,t){return e+t}function Re(e,t){return e-t}function Te(e){return e.reduce(Xe,0)/e.length}function he(e,t,o){if(!1===o)return e[t];for(var a=t.split("."),c=e;a.length>0;)c=c[a.shift()];return c}function de(e,t,o){for(var h,f,a=0,c=e.length;a<c;){if(0===(h=o.apply(null,[t,e[f=a+c>>1]])))return{found:!0,index:f};h<0?c=f:a=f+1}return{found:!1,index:c}}function ve(e){return function(t,o){return de(t,o,e)}}function Le(){}function oe(e){this.field=e,this.keyMap=Object.create(null),this.lokiMap=Object.create(null)}function _e(e){this.index=Object.create(null),this.field=e}return ie.prototype.events={},ie.prototype.asyncListeners=!1,ie.prototype.on=function(e,t){var o,a=this;return Array.isArray(e)?(e.forEach(function(c){a.on(c,t)}),t):((o=this.events[e])||(o=this.events[e]=[]),o.push(t),t)},ie.prototype.emit=function(e){var o,t=this;if(!e||!this.events[e])throw new Error("No event "+e+" defined");this.events[e].length&&(o=Array.prototype.slice.call(arguments,1),this.events[e].forEach(function(a){t.asyncListeners?setTimeout(function(){a.apply(t,o)},1):a.apply(t,o)}))},ie.prototype.addListener=ie.prototype.on,ie.prototype.removeListener=function(e,t){var o=this;if(Array.isArray(e))e.forEach(function(c){o.removeListener(c,t)});else if(this.events[e]){var a=this.events[e];a.splice(a.indexOf(t),1)}},(P.prototype=new ie).constructor=P,P.prototype.getIndexedAdapter=function(){return k(9820)},P.prototype.configureOptions=function(e,t){var a={fs:me,localStorage:fe,memory:ye};if(this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,typeof e<"u"){if(this.options=e,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof a[e.persistenceMethod]&&(this.persistenceMethod=e.persistenceMethod,this.persistenceAdapter=new a[e.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=e.adapter,this.options.adapter=null,this.isIncremental="incremental"===this.persistenceAdapter.mode),e.autoload&&t){var c=this;setTimeout(function(){c.loadDatabase(e,e.autoloadCallback)},1)}this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(e,e.autosaveCallback):this.autosaveEnable()),this.options.hasOwnProperty("throttledSaves")&&(this.throttledSaves=this.options.throttledSaves)}this.options.hasOwnProperty("serializationMethod")||(this.options.serializationMethod="normal"),this.options.hasOwnProperty("destructureDelimiter")||(this.options.destructureDelimiter="$<\n"),null===this.persistenceAdapter&&(this.persistenceMethod={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"}[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new a[this.persistenceMethod]))},P.prototype.copy=function(e){var o,a,t=new P(this.filename,{env:"NA"});if(e=e||{},t.loadJSONObject(this,{retainDirtyFlags:!0}),e.hasOwnProperty("removeNonSerializable")&&!0===e.removeNonSerializable)for(t.autosaveHandle=null,t.persistenceAdapter=null,o=t.collections.length,a=0;a<o;a++)t.collections[a].constraints=null,t.collections[a].ttl=null;return t},P.prototype.addCollection=function(e,t){var o,a=this.collections.length;if(t&&!0===t.disableMeta){if(!1===t.disableChangesApi)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(!1===t.disableDeltaChangesApi)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if("number"==typeof t.ttl&&t.ttl>0)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(o=0;o<a;o+=1)if(this.collections[o].name===e)return this.collections[o];var c=new D(e,t);return c.isIncremental=this.isIncremental,this.collections.push(c),this.verbose&&(c.lokiConsoleWrapper=console),c},P.prototype.loadCollection=function(e){if(!e.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(e)},P.prototype.getCollection=function(e){var t,o=this.collections.length;for(t=0;t<o;t+=1)if(this.collections[t].name===e)return this.collections[t];return this.emit("warning","collection "+e+" not found"),null},P.prototype.renameCollection=function(e,t){var o=this.getCollection(e);return o&&(o.name=t),o},P.prototype.listCollections=function(){for(var e=this.collections.length,t=[];e--;)t.push({name:this.collections[e].name,type:this.collections[e].objType,count:this.collections[e].data.length});return t},P.prototype.removeCollection=function(e){var t,o=this.collections.length;for(t=0;t<o;t+=1)if(this.collections[t].name===e){var a=new D(e,{}),c=this.collections[t];for(var h in c)c.hasOwnProperty(h)&&a.hasOwnProperty(h)&&(c[h]=a[h]);return void this.collections.splice(t,1)}},P.prototype.getName=function(){return this.name},P.prototype.serializeReplacer=function(e,t){switch(e){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":case"lokiConsoleWrapper":return null;case"throttledSavePending":case"throttledCallbacks":return;default:return t}},P.prototype.toJson=P.prototype.serialize=function(e){switch((e=e||{}).hasOwnProperty("serializationMethod")||(e.serializationMethod=this.options.serializationMethod),e.serializationMethod){case"normal":default:return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured()}},P.prototype.serializeDestructured=function(e){var t,o,a,c,f,h=[];if((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),!0===e.partitioned&&e.hasOwnProperty("partition")&&e.partition>=0)return this.serializeCollection({delimited:e.delimited,delimiter:e.delimiter,collectionIndex:e.partition});for((f=new P(this.filename)).loadJSONObject(this),t=0;t<f.collections.length;t++)f.collections[t].data=[];if(!0===e.partitioned&&-1===e.partition)return f.serialize({serializationMethod:"normal"});for(h.push(f.serialize({serializationMethod:"normal"})),f=null,t=0;t<this.collections.length;t++)if(a=this.serializeCollection({delimited:e.delimited,delimiter:e.delimiter,collectionIndex:t}),!1===e.partitioned&&!1===e.delimited){if(!Array.isArray(a))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(c=a.length,o=0;o<c;o++)h.push(a[o]),a[o]=null;h.push("")}else h.push(a);return e.partitioned?h:e.delimited?(h.push(""),h.join(e.delimiter)):(h.push(""),h)},P.prototype.serializeCollection=function(e){var t,o,a=[];if((e=e||{}).hasOwnProperty("delimited")||(e.delimited=!0),!e.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");for(t=this.collections[e.collectionIndex].data.length,a=[],o=0;o<t;o++)a.push(JSON.stringify(this.collections[e.collectionIndex].data[o]));return e.delimited?(a.push(""),a.join(e.delimiter)):a},P.prototype.deserializeDestructured=function(e,t){var c,g,C,o=[],f=0,v=1,b=!1;if((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),t.partitioned){if(t.hasOwnProperty("partition"))return-1===t.partition?c=JSON.parse(e[0]):this.deserializeCollection(e[t.partition+1],t);for(g=(c=JSON.parse(e[0])).collections.length,f=0;f<g;f++)c.collections[f].data=this.deserializeCollection(e[f+1],t);return c}if(t.delimited){if(o=e.split(t.delimiter),e=null,0===o.length)return null}else o=e;for(g=(c=JSON.parse(o[0])).collections.length,o[0]=null;!b;)""===o[v]?++f>g&&(b=!0):(C=JSON.parse(o[v]),c.collections[f].data.push(C)),o[v++]=null;return c},P.prototype.deserializeCollection=function(e,t){var a,c,o=[];for((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),t.delimited?(o=e.split(t.delimiter)).pop():o=e,c=o.length,a=0;a<c;a++)o[a]=JSON.parse(o[a]);return o},P.prototype.loadJSON=function(e,t){var o;if(0===e.length)o={};else switch(this.options.serializationMethod){case"normal":case"pretty":default:o=JSON.parse(e);break;case"destructured":o=this.deserializeDestructured(e)}this.loadJSONObject(o,t)},P.prototype.loadJSONObject=function(e,t){var c,h,f,g,v,b,o=0,a=e.collections?e.collections.length:0;function E(A){var ee,q=t[A.name];return q.proto?(ee=q.inflate||y.copyProperties,function(X){var z=new q.proto;return ee(X,z),z}):q.inflate}for(this.name=e.name,e.hasOwnProperty("throttledSaves")&&t&&!t.hasOwnProperty("throttledSaves")&&(this.throttledSaves=e.throttledSaves),this.collections=[];o<a;o+=1){if((h=this.addCollection((c=e.collections[o]).name,{disableChangesApi:c.disableChangesApi,disableDeltaChangesApi:c.disableDeltaChangesApi,disableMeta:c.disableMeta,disableFreeze:!c.hasOwnProperty("disableFreeze")||c.disableFreeze})).adaptiveBinaryIndices=!!c.hasOwnProperty("adaptiveBinaryIndices")&&!0===c.adaptiveBinaryIndices,h.transactional=c.transactional,h.asyncListeners=c.asyncListeners,h.cloneObjects=c.cloneObjects,h.cloneMethod=c.cloneMethod||"parse-stringify",h.autoupdate=c.autoupdate,h.changes=c.changes,h.dirtyIds=c.dirtyIds||[],h.dirty=!(!t||!0!==t.retainDirtyFlags)&&c.dirty,f=c.data.length,g=0,t&&t.hasOwnProperty(c.name))for(v=E(c);g<f;g++)b=v(c.data[g]),h.data[g]=b,h.addAutoUpdateObserver(b),h.disableFreeze||O(h.data[g]);else for(;g<f;g++)h.data[g]=c.data[g],h.addAutoUpdateObserver(h.data[g]),h.disableFreeze||O(h.data[g]);if(h.maxId=typeof c.maxId>"u"?0:c.maxId,typeof c.binaryIndices<"u"&&(h.binaryIndices=c.binaryIndices),typeof c.transforms<"u"&&(h.transforms=c.transforms),h.uniqueNames=[],c.hasOwnProperty("uniqueNames")&&(h.uniqueNames=c.uniqueNames),!(typeof c.DynamicViews>"u")){for(var C=0;C<c.DynamicViews.length;C++){var x=c.DynamicViews[C],I=h.addDynamicView(x.name,x.options);I.resultdata=x.resultdata,I.resultsdirty=x.resultsdirty,I.filterPipeline=x.filterPipeline,I.sortCriteriaSimple=x.sortCriteriaSimple,I.sortCriteria=x.sortCriteria,I.sortFunction=null,I.sortDirty=x.sortDirty,h.disableFreeze||(O(I.filterPipeline),I.sortCriteriaSimple?O(I.sortCriteriaSimple):I.sortCriteria&&O(I.sortCriteria)),I.resultset.filteredrows=x.resultset.filteredrows,I.resultset.filterInitialized=x.resultset.filterInitialized,I.rematerialize({removeWhereFilters:!0})}e.databaseVersion<1.5&&(h.ensureAllIndexes(!0),h.dirty=!0)}}},P.prototype.close=function(e){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&(this.saveDatabase(e),e=void 0)),e&&this.on("close",e),this.emit("close")},P.prototype.generateChangesNotification=function(e){function t(c){return c.name}var o=[],a=e||this.collections.map(t);return this.collections.forEach(function(c){-1!==a.indexOf(t(c))&&(o=o.concat(c.getChanges()))}),o},P.prototype.serializeChanges=function(e){return JSON.stringify(this.generateChangesNotification(e))},P.prototype.clearChanges=function(){this.collections.forEach(function(e){e.flushChanges&&e.flushChanges()})},ye.prototype.loadDatabase=function(e,t){var o=this;this.options.asyncResponses?setTimeout(function(){o.hashStore.hasOwnProperty(e)?t(o.hashStore[e].value):t(null)},this.options.asyncTimeout):this.hashStore.hasOwnProperty(e)?t(this.hashStore[e].value):t(null)},ye.prototype.saveDatabase=function(e,t,o){var c,a=this;this.options.asyncResponses?setTimeout(function(){c=a.hashStore.hasOwnProperty(e)?a.hashStore[e].savecount:0,a.hashStore[e]={savecount:c+1,lastsave:new Date,value:t},o()},this.options.asyncTimeout):(c=this.hashStore.hasOwnProperty(e)?this.hashStore[e].savecount:0,this.hashStore[e]={savecount:c+1,lastsave:new Date,value:t},o())},ye.prototype.deleteDatabase=function(e,t){this.hashStore.hasOwnProperty(e)&&delete this.hashStore[e],"function"==typeof t&&t()},ue.prototype.loadDatabase=function(e,t){var o=this;this.dbname=e,this.dbref=new P(e),this.adapter.loadDatabase(e,function(a){if(a){"string"!=typeof a&&t(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()"));var c=JSON.parse(a);o.dbref.loadJSONObject(c),c=null,0!==o.dbref.collections.length?(o.pageIterator={collection:0,pageIndex:0},o.loadNextPartition(0,function(){t(o.dbref)})):t(o.dbref)}else t(a)})},ue.prototype.loadNextPartition=function(e,t){var o=this.dbname+"."+e,a=this;if(!0===this.options.paging)return this.pageIterator.pageIndex=0,void this.loadNextPage(t);this.adapter.loadDatabase(o,function(c){var h=a.dbref.deserializeCollection(c,{delimited:!0,collectionIndex:e});a.dbref.collections[e].data=h,++e<a.dbref.collections.length?a.loadNextPartition(e,t):t()})},ue.prototype.loadNextPage=function(e){var o=this;this.adapter.loadDatabase(this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,function(a){var c=a.split(o.options.delimiter);a="";var f,h=c.length,g=""===c[h-1];for(g&&(c.pop(),""===c[(h=c.length)-1]&&1===h&&(c.pop(),h=c.length)),f=0;f<h;f++)o.dbref.collections[o.pageIterator.collection].data.push(JSON.parse(c[f])),c[f]=null;c=[],g?++o.pageIterator.collection<o.dbref.collections.length?o.loadNextPartition(o.pageIterator.collection,e):e():(o.pageIterator.pageIndex++,o.loadNextPage(e))})},ue.prototype.exportDatabase=function(e,t,o){var c,h=t.collections.length;for(this.dbref=t,this.dbname=e,this.dirtyPartitions=[-1],c=0;c<h;c++)t.collections[c].dirty&&this.dirtyPartitions.push(c);this.saveNextPartition(function(f){o(f)})},ue.prototype.saveNextPartition=function(e){var t=this,o=this.dirtyPartitions.shift(),a=this.dbname+(-1===o?"":"."+o);if(this.options.paging&&-1!==o)return this.pageIterator={collection:o,docIndex:0,pageIndex:0},void this.saveNextPage(function(h){0===t.dirtyPartitions.length?e(h):t.saveNextPartition(e)});var c=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:o});this.adapter.saveDatabase(a,c,function(h){h?e(h):0===t.dirtyPartitions.length?e(null):t.saveNextPartition(e)})},ue.prototype.saveNextPage=function(e){var t=this,o=this.dbref.collections[this.pageIterator.collection],a=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,c=0,h=o.data.length,f=this.options.delimiter.length,g="",v="",b=!1,E=!1,C=function(x){v="",x&&e(x),b?e(null):(t.pageIterator.pageIndex++,t.saveNextPage(e))};for(0===o.data.length&&(b=!0);;)if(b||(g=JSON.stringify(o.data[this.pageIterator.docIndex]),v+=g,c+=g.length,++this.pageIterator.docIndex>=h&&(b=!0)),c>=this.options.pageSize&&(E=!0),(!E||b)&&(v+=this.options.delimiter,c+=f),b||E)return void this.adapter.saveDatabase(a,v,C)},me.prototype.loadDatabase=function(t,o){var a=this;this.fs.stat(t,function(c,h){!c&&h.isFile()?a.fs.readFile(t,{encoding:"utf8"},function(g,v){o(g?new Error(g):v)}):o(null)})},me.prototype.saveDatabase=function(t,o,a){var c=this,h=t+"~";this.fs.writeFile(h,o,function(g){g?a(new Error(g)):c.fs.rename(h,t,a)})},me.prototype.deleteDatabase=function(t,o){this.fs.unlink(t,function(c){c?o(new Error(c)):o()})},fe.prototype.loadDatabase=function(t,o){V()?o(localStorage.getItem(t)):o(new Error("localStorage is not available"))},fe.prototype.saveDatabase=function(t,o,a){V()?(localStorage.setItem(t,o),a(null)):a(new Error("localStorage is not available"))},fe.prototype.deleteDatabase=function(t,o){V()?(localStorage.removeItem(t),o(null)):o(new Error("localStorage is not available"))},P.prototype.throttledSaveDrain=function(e,t){var o=this,a=(new Date).getTime();if(this.throttledSaves||e(!0),(t=t||{}).hasOwnProperty("recursiveWait")||(t.recursiveWait=!0),t.hasOwnProperty("recursiveWaitLimit")||(t.recursiveWaitLimit=!1),t.hasOwnProperty("recursiveWaitLimitDuration")||(t.recursiveWaitLimitDuration=2e3),t.hasOwnProperty("started")||(t.started=(new Date).getTime()),this.throttledSaves&&this.throttledSavePending){if(!t.recursiveWait)return void this.throttledCallbacks.push(e);this.throttledCallbacks.push(function(){return o.throttledSavePending?t.recursiveWaitLimit&&a-t.started>t.recursiveWaitLimitDuration?void e(!1):void o.throttledSaveDrain(e,t):void e(!0)})}else e(!0)},P.prototype.loadDatabaseInternal=function(e,t){var o=t||function(c,h){if(c)throw c},a=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,function(h){if("string"==typeof h){var f=!1;try{a.loadJSON(h,e||{}),f=!0}catch(g){o(g)}f&&(o(null),a.emit("loaded","database "+a.filename+" loaded"))}else{if(!h)return o(null),void a.emit("loaded","empty database "+a.filename+" loaded");if(h instanceof Error)return void o(h);if("object"==typeof h)return a.loadJSONObject(h,e||{}),o(null),void a.emit("loaded","database "+a.filename+" loaded");o("unexpected adapter response : "+h)}}):o(new Error("persistenceAdapter not configured"))},P.prototype.loadDatabase=function(e,t){var o=this;this.throttledSaves?this.throttledSaveDrain(function(a){if(a)return o.throttledSavePending=!0,void o.loadDatabaseInternal(e,function(c){0===o.throttledCallbacks.length?o.throttledSavePending=!1:o.saveDatabase(),"function"==typeof t&&t(c)});"function"==typeof t&&t(new Error("Unable to pause save throttling long enough to read database"))},e):this.loadDatabaseInternal(e,t)},P.prototype.saveDatabaseInternal=function(e){var a,t=e||function(c){if(c)throw c},o=this;this.persistenceAdapter?"incremental"===this.persistenceAdapter.mode?(this.ignoreAutosave=!0,this.persistenceAdapter.saveDatabase(this.filename,function(){if(o.ignoreAutosave=!1,!a){var h=o.copy({removeNonSerializable:!0});return a=o.collections.map(function(f){return[f.dirty,f.dirtyIds]}),o.collections.forEach(function(f){f.dirty=!1,f.dirtyIds=[]}),h}t(new Error("adapter error - getLokiCopy called more than once"))},function(h){o.ignoreAutosave=!1,h&&a&&o.collections.forEach(function(f,g){var v=a[g];f.dirty=f.dirty||v[0],f.dirtyIds=f.dirtyIds.concat(v[1])}),t(h)})):"reference"===this.persistenceAdapter.mode&&"function"==typeof this.persistenceAdapter.exportDatabase?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),function(h){o.autosaveClearFlags(),t(h)}):(this.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,this.serialize(),function(h){t(h)})):t(new Error("persistenceAdapter not configured"))},P.prototype.save=P.prototype.saveDatabase=function(e){if(this.throttledSaves)if(this.throttledSavePending)this.throttledCallbacks.push(e);else{var t=this.throttledCallbacks;this.throttledCallbacks=[],t.unshift(e),this.throttledSavePending=!0;var o=this;this.saveDatabaseInternal(function(a){o.throttledSavePending=!1,t.forEach(function(c){"function"==typeof c&&setTimeout(function(){c(a)},1)}),o.throttledCallbacks.length>0&&o.saveDatabase()})}else this.saveDatabaseInternal(e)},P.prototype.deleteDatabase=function(e,t){var o=t||function(a,c){if(a)throw a};"function"==typeof e&&!t&&(o=e),null!==this.persistenceAdapter?this.persistenceAdapter.deleteDatabase(this.filename,function(c){o(c)}):o(new Error("persistenceAdapter not configured"))},P.prototype.autosaveDirty=function(){for(var e=0;e<this.collections.length;e++)if(this.collections[e].dirty)return!0;return!1},P.prototype.autosaveClearFlags=function(){for(var e=0;e<this.collections.length;e++)this.collections[e].dirty=!1},P.prototype.autosaveEnable=function(e,t){this.autosave=!0;var o=5e3,a=this;typeof this.autosaveInterval<"u"&&null!==this.autosaveInterval&&(o=this.autosaveInterval),this.autosaveHandle=setInterval(function(){a.autosaveDirty()&&!a.ignoreAutosave&&a.saveDatabase(t)},o)},P.prototype.autosaveDisable=function(){typeof this.autosaveHandle<"u"&&null!==this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},M.prototype.reset=function(){return this.filteredrows.length>0&&(this.filteredrows=[]),this.filterInitialized=!1,this},M.prototype.toJSON=function(){var e=this.copy();return e.collection=null,e},M.prototype.limit=function(e){!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=this.collection.prepareFullDocIndex());var t=new M(this.collection);return t.filteredrows=this.filteredrows.slice(0,e),t.filterInitialized=!0,t},M.prototype.offset=function(e){!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=this.collection.prepareFullDocIndex());var t=new M(this.collection);return t.filteredrows=this.filteredrows.slice(e),t.filterInitialized=!0,t},M.prototype.copy=function(){var e=new M(this.collection);return this.filteredrows.length>0&&(e.filteredrows=this.filteredrows.slice()),e.filterInitialized=this.filterInitialized,e},M.prototype.branch=M.prototype.copy,M.prototype.transform=function(e,t){var o,a,c=this;if("string"==typeof e&&this.collection.transforms.hasOwnProperty(e)&&(e=this.collection.transforms[e]),"object"!=typeof e||!Array.isArray(e))throw new Error("Invalid transform");for(typeof t<"u"&&(e=y.resolveTransformParams(e,t)),o=0;o<e.length;o++)switch(a=e[o],a.type){case"find":c.find(a.value);break;case"where":c.where(a.value);break;case"simplesort":c.simplesort(a.property,a.desc||a.options);break;case"compoundsort":c.compoundsort(a.value);break;case"sort":c.sort(a.value);break;case"limit":c=c.limit(a.value);break;case"offset":c=c.offset(a.value);break;case"map":c=c.map(a.value,a.dataOptions);break;case"eqJoin":c=c.eqJoin(a.joinData,a.leftJoinKey,a.rightJoinKey,a.mapFun,a.dataOptions);break;case"mapReduce":c=c.mapReduce(a.mapFunction,a.reduceFunction);break;case"update":c.update(a.value);break;case"remove":c.remove()}return c},M.prototype.sort=function(e){!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=this.collection.prepareFullDocIndex());var o,a,t=(o=e,a=this.collection.data,function(c,h){return o(a[c],a[h])});return this.filteredrows.sort(t),this},M.prototype.simplesort=function(e,t){var a=10,c=this.collection.data.length,h=this.filteredrows.length,f=this.collection.binaryIndices.hasOwnProperty(e);if((typeof t>"u"||!1===t)&&(t={desc:!1}),!0===t&&(t={desc:!0}),0===h){if(this.filterInitialized)return this;if(this.collection.binaryIndices.hasOwnProperty(e))return this.collection.ensureIndex(e),this.filteredrows=this.collection.binaryIndices[e].values.slice(0),t.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!t.disableIndexIntersect&&f&&(t.useJavascriptSorting&&(a=6),c/h<=a||t.forceIndexIntersect)){var g,v=this.filteredrows,b={};for(g=0;g<h;g++)b[v[g]]=!0;return this.filteredrows=this.collection.binaryIndices[e].values.filter(function(x){return b[x]}),t.desc&&this.filteredrows.reverse(),this}if(t.useJavascriptSorting)return this.sort(function(x,I){return x[e]===I[e]?0:x[e]>I[e]?1:x[e]<I[e]?-1:void 0});var x,I,A,q,ee,X,C=(x=e,I=t.desc,A=this.collection.data,function(z,Q){return~x.indexOf(".")?(X=x.split("."),q=y.getIn(A[z],X,!0),ee=y.getIn(A[Q],X,!0)):(q=A[z][x],ee=A[Q][x]),N(q,ee,I)});return this.filteredrows.sort(C),this},M.prototype.compoundsort=function(e){if(0===e.length)throw new Error("Invalid call to compoundsort, need at least one property");var t;if(1===e.length)return t=e[0],Array.isArray(t)?this.simplesort(t[0],t[1]):this.simplesort(t,!1);for(var o=0,a=e.length;o<a;o+=1)t=e[o],Array.isArray(t)||(e[o]=[t,!1]);!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=this.collection.prepareFullDocIndex());var h,f,c=(h=e,f=this.collection.data,function(g,v){return function K(e,t,o){for(var c,h,f,g,v,a=0,E=0,C=e.length;E<C;E++)if(~(h=(c=e[E])[0]).indexOf(".")?(v=h.split("."),f=y.getIn(t,v,!0),g=y.getIn(o,v,!0)):(f=t[h],g=o[h]),0!==(a=N(f,g,c[1])))return a;return 0}(h,f[g],f[v])});return this.filteredrows.sort(c),this},M.prototype.$or=M.prototype.findOr=function(e){for(var t=null,o=0,a=0,c=[],h=[],f=0,v=(this.count(),0),b=e.length;v<b;v++)for(a=(t=this.branch().find(e[v]).filteredrows).length,o=0;o<a;o++)void 0===h[f=t[o]]&&(h[f]=!0,c.push(f));return this.filteredrows=c,this.filterInitialized=!0,this},M.prototype.$and=M.prototype.findAnd=function(e){for(var t=0,o=e.length;t<o;t++){if(0===this.count())return this;this.find(e[t])}return this},M.prototype.find=function(e,t){if(0===this.collection.data.length)return this.filteredrows=[],this.filterInitialized=!0,this;var a,c,h,f,g,v,b,o=e||"getAll",E=!1,C=[],x=[],I=null;if(t=t||!1,"object"==typeof o){for(a in o)(f={})[a]=o[a],x.push(f),B.call(o,a)&&(c=a,h=o[a]);if(x.length>1)return this.find({$and:x},t)}if(!c||"getAll"===o)return t&&(this.filterInitialized?this.filteredrows=this.filteredrows.slice(0,1):(this.filteredrows=this.collection.data.length>0?[0]:[],this.filterInitialized=!0)),this;if("$and"===c||"$or"===c)return this[c](h),t&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this;if(null===h||"object"!=typeof h||h instanceof Date)g="$eq",v=h;else{if("object"!=typeof h)throw new Error("Do not know what you want to do.");for(b in h)if(B.call(h,b)){g=b,v=h[b];break}}("$regex"===g||"object"==typeof v)&&(v=Pe(g,v));var A=-1!==c.indexOf(".");!this.filterInitialized&&this.collection.binaryIndices[c]&&Oe[g]&&(!0!==this.collection.adaptiveBinaryIndices&&this.collection.ensureIndex(c),E=!0,I=this.collection.binaryIndices[c]),!E&&"$in"===g&&Array.isArray(v)&&typeof Set<"u"&&(v=new Set(v),g="$inSet");var le,re,ee=ne[g],X=this.collection.data,z=0,Q=0,pe=0;if(this.filterInitialized){if(Q=(le=this.filteredrows).length,A){for(c=c.split("."),z=0;z<Q;z++)if(Z(re=X[pe=le[z]],c,ee,v,re)&&(C.push(pe),t))return this.filteredrows=C,this}else for(z=0;z<Q;z++)if(ee((re=X[pe=le[z]])[c],v,re)&&(C.push(pe),t))return this.filteredrows=C,this}else if(E){var Me=this.collection.calculateRange(g,c,v);if("$in"!==g){for(z=Me[0];z<=Me[1];z++)if(!0!==Oe[g]){if(Oe[g](y.getIn(X[I.values[z]],c,A),v)&&(C.push(I.values[z]),t))return this.filteredrows=C,this.filterInitialized=!0,this}else if(C.push(I.values[z]),t)return this.filteredrows=C,this.filterInitialized=!0,this}else for(z=0,Q=Me.length;z<Q;z++)if(C.push(I.values[Me[z]]),t)return this.filteredrows=C,this.filterInitialized=!0,this}else if(Q=X.length,A){for(c=c.split("."),z=0;z<Q;z++)if(Z(re=X[z],c,ee,v,re)&&(C.push(z),t))return this.filteredrows=C,this.filterInitialized=!0,this}else for(z=0;z<Q;z++)if(ee((re=X[z])[c],v,re)&&(C.push(z),t))return this.filteredrows=C,this.filterInitialized=!0,this;return this.filteredrows=C,this.filterInitialized=!0,this},M.prototype.where=function(e){var t,o=[];if("function"!=typeof e)throw new TypeError("Argument is not a stored view or a function");t=e;try{if(this.filterInitialized){for(var a=this.filteredrows.length;a--;)!0===t(this.collection.data[this.filteredrows[a]])&&o.push(this.filteredrows[a]);return this.filteredrows=o,this}for(var c=this.collection.data.length;c--;)!0===t(this.collection.data[c])&&o.push(c);return this.filteredrows=o,this.filterInitialized=!0,this}catch(h){throw h}},M.prototype.count=function(){return this.filterInitialized?this.filteredrows.length:this.collection.count()},M.prototype.data=function(e){var a,c,h,f,t=[],o=this.collection.data;if((e=e||{}).removeMeta&&!e.forceClones&&(e.forceClones=!0,e.forceCloneMethod=e.forceCloneMethod||"shallow"),!this.collection.disableDeltaChangesApi&&this.collection.disableFreeze&&(e.forceClones=!0,e.forceCloneMethod="parse-stringify"),!this.filterInitialized){if(0===this.filteredrows.length){if(this.collection.cloneObjects||e.forceClones){for(c=o.length,f=e.forceCloneMethod||this.collection.cloneMethod,h=0;h<c;h++)a=H(o[h],f),e.removeMeta&&(delete a.$loki,delete a.meta),t.push(a);return t}return o.slice()}this.filterInitialized=!0}var g=this.filteredrows;if(c=g.length,this.collection.cloneObjects||e.forceClones)for(f=e.forceCloneMethod||this.collection.cloneMethod,h=0;h<c;h++)a=H(o[g[h]],f),e.removeMeta&&(delete a.$loki,delete a.meta),t.push(a);else for(h=0;h<c;h++)t.push(o[g[h]]);return t},M.prototype.update=function(e){if("function"!=typeof e)throw new TypeError("Argument is not a function");!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=this.collection.prepareFullDocIndex());for(var t,o=this.filteredrows.length,a=this.collection.data,c=0;c<o;c++)this.disableFreeze&&!this.collection.cloneObjects&&this.collection.disableDeltaChangesApi?(e(a[this.filteredrows[c]]),this.collection.update(a[this.filteredrows[c]])):(e(t=H(a[this.filteredrows[c]],this.collection.cloneMethod)),this.collection.update(t));return this},M.prototype.remove=function(){return!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this},M.prototype.mapReduce=function(e,t){try{return t(this.data().map(e))}catch(o){throw o}},M.prototype.eqJoin=function(e,t,o,a,c){var f,v,b,h,g=[],E=[],C="function"==typeof t,x="function"==typeof o,I={};if(f=(h=this.data(c)).length,e instanceof D)g=e.chain().data(c);else if(e instanceof M)g=e.data(c);else{if(!Array.isArray(e))throw new TypeError("joinData needs to be an array or result set");g=e}v=g.length;for(var A=0;A<v;A++)I[b=x?o(g[A]):g[A][o]]=g[A];a||(a=function(ee,X){return{left:ee,right:X}});for(var q=0;q<f;q++)b=C?t(h[q]):h[q][t],E.push(a(h[q],I[b]||{}));return this.collection=new D("joinData"),this.collection.insert(E),this.filteredrows=[],this.filterInitialized=!1,this},M.prototype.map=function(e,t){var o=this.data(t).map(e);return this.collection=new D("mappedData"),this.collection.insert(o),this.filteredrows=[],this.filterInitialized=!1,this},(F.prototype=new ie).constructor=F,F.prototype.getSort=function(){return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple},F.prototype.rematerialize=function(e){var t,o,a;e=e||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new M(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0);var c=Object.isFrozen(this.filterPipeline);if(e.hasOwnProperty("removeWhereFilters"))for(c&&(this.filterPipeline=this.filterPipeline.slice()),o=t=this.filterPipeline.length;o--;)"where"===this.filterPipeline[o].type&&(o!==this.filterPipeline.length-1&&(this.filterPipeline[o]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var h=this.filterPipeline;for(this.filterPipeline=[],t=h.length,a=0;a<t;a++)this.applyFind(h[a].val,h[a].uid);return c&&Object.freeze(this.filterPipeline),this.data(),this.emit("rebuild",this),this},F.prototype.branchResultset=function(e,t){var o=this.resultset.branch();return typeof e>"u"?o:o.transform(e,t)},F.prototype.toJSON=function(){var e=new F(this.collection,this.name,this.options);return e.resultset=this.resultset,e.resultdata=[],e.resultsdirty=!0,e.filterPipeline=this.filterPipeline,e.sortFunction=this.sortFunction,e.sortCriteria=this.sortCriteria,e.sortCriteriaSimple=this.sortCriteriaSimple||null,e.sortDirty=this.sortDirty,e.collection=null,e},F.prototype.removeFilters=function(e){e=e||{},this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null;var t=Object.isFrozen(this.filterPipeline),o=this.filterPipeline.length>0;this.filterPipeline=[],t&&Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,!0===e.queueSortPhase&&this.queueSortPhase(),o&&this.emit("filter")},F.prototype.applySort=function(e){return this.sortFunction=e,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this.emit("sort"),this},F.prototype.applySimpleSort=function(e,t){return this.sortCriteriaSimple={propname:e,options:t||!1},this.collection.disableFreeze||O(this.sortCriteriaSimple),this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},F.prototype.applySortCriteria=function(e){return this.sortCriteria=e,this.collection.disableFreeze||O(this.sortCriteria),this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},F.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},F.prototype.commit=function(){return this.cachedresultset=null,this},F.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},F.prototype._indexOfFilterWithId=function(e){if("string"==typeof e||"number"==typeof e)for(var t=0,o=this.filterPipeline.length;t<o;t+=1)if(e===this.filterPipeline[t].uid)return t;return-1},F.prototype._addFilter=function(e){var t=Object.isFrozen(this.filterPipeline);t&&(this.filterPipeline=this.filterPipeline.slice()),this.collection.disableFreeze||O(e),this.filterPipeline.push(e),t&&Object.freeze(this.filterPipeline),this.resultset[e.type](e.val)},F.prototype.reapplyFilters=function(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);var e=this.filterPipeline,t=Object.isFrozen(e);this.filterPipeline=[];for(var o=0,a=e.length;o<a;o+=1)this._addFilter(e[o]);return t&&Object.freeze(this.filterPipeline),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},F.prototype.applyFilter=function(e){var t=this._indexOfFilterWithId(e.uid);if(t>=0){var o=Object.isFrozen(this.filterPipeline);return o&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline[t]=e,o&&(i(e),Object.freeze(this.filterPipeline)),this.reapplyFilters()}return this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(e),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},F.prototype.applyFind=function(e,t){return this.applyFilter({type:"find",val:e,uid:t}),this},F.prototype.applyWhere=function(e,t){return this.applyFilter({type:"where",val:e,uid:t}),this},F.prototype.removeFilter=function(e){var t=this._indexOfFilterWithId(e);if(t<0)throw new Error("Dynamic view does not contain a filter with ID: "+e);var o=Object.isFrozen(this.filterPipeline);return o&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline.splice(t,1),o&&Object.freeze(this.filterPipeline),this.reapplyFilters(),this},F.prototype.count=function(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()},F.prototype.data=function(e){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(e)},F.prototype.queueRebuildEvent=function(){if(!this.rebuildPending){this.rebuildPending=!0;var e=this;setTimeout(function(){e.rebuildPending&&(e.rebuildPending=!1,e.emit("rebuild",e))},this.options.minRebuildInterval)}},F.prototype.queueSortPhase=function(){if(!this.sortDirty){this.sortDirty=!0;var e=this;"active"===this.options.sortPriority?setTimeout(function(){e.performSortPhase()},this.options.minRebuildInterval):this.queueRebuildEvent()}},F.prototype.performSortPhase=function(e){!this.sortDirty&&!this.resultsdirty||(e=e||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),e.suppressRebuildEvent||this.emit("rebuild",this))},F.prototype.evaluateDocument=function(e,t){if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var o=this.resultset.filteredrows,a=t?-1:o.indexOf(+e),c=o.length,h=new M(this.collection);h.filteredrows=[e],h.filterInitialized=!0;for(var f,g=0,v=this.filterPipeline.length;g<v;g++)h[(f=this.filterPipeline[g]).type](f.val);var b=0===h.filteredrows.length?-1:0;if(-1!==a||-1!==b){if(-1===a&&-1!==b)return o.push(e),this.options.persistent&&this.resultdata.push(this.collection.data[e]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());if(-1!==a&&-1===b)return a<c-1?(o.splice(a,1),this.options.persistent&&this.resultdata.splice(a,1)):(o.length=c-1,this.options.persistent&&(this.resultdata.length=c-1)),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());if(-1!==a&&-1!==b)return this.options.persistent&&(this.resultdata[a]=this.collection.data[e]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())}},F.prototype.removeDocument=function(e){var t,o,a,c={},h={},f=[],g=this.resultset,v=this.resultset.filteredrows,b=v.length;if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(Array.isArray(e)||(e=[e]),a=e.length,o=0;o<a;o++)c[e[o]]=!0;for(t=0;t<b;t++)c[v[t]]&&(h[t]=!0);Object.keys(h).length>0&&(this.resultset.filteredrows=this.resultset.filteredrows.filter(function(C,x){return!h[x]}),this.options.persistent&&(this.resultdata=this.resultdata.filter(function(C,x){return!h[x]})),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var E=function(C){return function(x){return x<g.filteredrows[C]}};for(b=g.filteredrows.length,t=0;t<b;t++)f=e.filter(E(t)),g.filteredrows[t]-=f.length},F.prototype.mapReduce=function(e,t){try{return t(this.data().map(e))}catch(o){throw o}},(D.prototype=new ie).contructor=D,D.prototype.createChange=function(e,t,o,a){this.changes.push({name:e,operation:t,obj:"U"!=t||this.disableDeltaChangesApi?JSON.parse(JSON.stringify(o)):this.getChangeDelta(o,a)})},D.prototype.insertMeta=function(e){var t,o;if(!this.disableMeta&&e){if(Array.isArray(e)){for(t=e.length,o=0;o<t;o++)e[o].hasOwnProperty("meta")||(e[o].meta={}),e[o].meta.created=(new Date).getTime(),e[o].meta.revision=0;return}e.meta||(e.meta={}),e.meta.created=(new Date).getTime(),e.meta.revision=0}},D.prototype.updateMeta=function(e){return this.disableMeta||!e||(this.disableFreeze||((e=L(e)).meta=L(e.meta)),e.meta.updated=(new Date).getTime(),e.meta.revision+=1),e},D.prototype.createInsertChange=function(e){this.createChange(this.name,"I",e)},D.prototype.createUpdateChange=function(e,t){this.createChange(this.name,"U",e,t)},D.prototype.insertMetaWithChange=function(e){this.insertMeta(e),this.createInsertChange(e)},D.prototype.updateMetaWithChange=function(e,t,o){return e=this.updateMeta(e,o),this.createUpdateChange(e,t),e},D.prototype.lokiConsoleWrapper={log:function(){},warn:function(){},error:function(){}},D.prototype.addAutoUpdateObserver=function(e){!this.autoupdate||"function"!=typeof Object.observe||Object.observe(e,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])},D.prototype.removeAutoUpdateObserver=function(e){!this.autoupdate||"function"!=typeof Object.observe||Object.unobserve(e,this.observerCallback)},D.prototype.addTransform=function(e,t){if(this.transforms.hasOwnProperty(e))throw new Error("a transform by that name already exists");this.transforms[e]=t},D.prototype.getTransform=function(e){return this.transforms[e]},D.prototype.setTransform=function(e,t){this.transforms[e]=t},D.prototype.removeTransform=function(e){delete this.transforms[e]},D.prototype.byExample=function(e){var t,o,a;for(t in a=[],e)!e.hasOwnProperty(t)||a.push(((o={})[t]=e[t],o));return{$and:a}},D.prototype.findObject=function(e){return this.findOne(this.byExample(e))},D.prototype.findObjects=function(e){return this.find(this.byExample(e))},D.prototype.ttlDaemonFuncGen=function(){var e=this,t=this.ttl.age;return function(){var a=Date.now();e.chain().where(function(f){return t<a-(f.meta.updated||f.meta.created)}).remove()}},D.prototype.setTTL=function(e,t){e<0?clearInterval(this.ttl.daemon):(this.ttl.age=e,this.ttl.ttlInterval=t,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),t))},D.prototype.prepareFullDocIndex=function(){for(var e=this.data.length,t=new Array(e),o=0;o<e;o+=1)t[o]=o;return t},D.prototype.configureOptions=function(e){(e=e||{}).hasOwnProperty("adaptiveBinaryIndices")&&(this.adaptiveBinaryIndices=e.adaptiveBinaryIndices,this.adaptiveBinaryIndices&&this.ensureAllIndexes())},D.prototype.ensureIndex=function(e,t){if(typeof t>"u"&&(t=!1),null==e)throw new Error("Attempting to set index without an associated property");if((!this.binaryIndices[e]||t||this.binaryIndices[e].dirty)&&(!0!==this.adaptiveBinaryIndices||!this.binaryIndices.hasOwnProperty(e)||t)){var o={name:e,dirty:!0,values:this.prepareFullDocIndex()};this.binaryIndices[e]=o;var a=(h=this.data,v=!!~(c=e).indexOf(".")&&c.split("."),function(b,E){if(v?(f=y.getIn(h[b],v,!0),g=y.getIn(h[E],v,!0)):(f=h[b][c],g=h[E][c]),f!==g){if(S.lt(f,g,!1))return-1;if(S.gt(f,g,!1))return 1}return 0});o.values.sort(a),o.dirty=!1,this.dirty=!0}var c,h,f,g,v},D.prototype.checkAllIndexes=function(e){var t,o=this.binaryIndices,a=[];for(t in o)B.call(o,t)&&(this.checkIndex(t,e)||a.push(t));return a},D.prototype.checkIndex=function(e,t){(t=t||{}).randomSamplingFactor&&!1!==t.randomSampling&&(t.randomSampling=!0),t.randomSamplingFactor=t.randomSamplingFactor||.1,(t.randomSamplingFactor<0||t.randomSamplingFactor>1)&&(t.randomSamplingFactor=.1);var a,c,h,f,g,o=!0;if(!this.binaryIndices.hasOwnProperty(e))throw new Error("called checkIndex on property without an index: "+e);if(this.adaptiveBinaryIndices||this.ensureIndex(e),(f=(g=this.binaryIndices[e].values).length)!==this.data.length)return t.repair&&this.ensureIndex(e,!0),!1;if(0===f)return!0;var v=-1!==e.indexOf(".");if(1===f)o=0===g[0];else if(t.randomSampling){if(ne.$lte(y.getIn(this.data[g[0]],e,v),y.getIn(this.data[g[1]],e,v))||(o=!1),ne.$lte(y.getIn(this.data[g[f-2]],e,v),y.getIn(this.data[g[f-1]],e,v))||(o=!1),o)for(c=Math.floor((f-1)*t.randomSamplingFactor),a=0;a<c-1;a++)if(h=Math.floor(Math.random()*(f-1)),!ne.$lte(y.getIn(this.data[g[h]],e,v),y.getIn(this.data[g[h+1]],e,v))){o=!1;break}}else for(a=0;a<f-1;a++)if(!ne.$lte(y.getIn(this.data[g[a]],e,v),y.getIn(this.data[g[a+1]],e,v))){o=!1;break}return!o&&t.repair&&this.ensureIndex(e,!0),o},D.prototype.getBinaryIndexValues=function(e){var t,o=this.binaryIndices[e].values,a=[];for(t=0;t<o.length;t++)a.push(y.getIn(this.data[o[t]],e,!0));return a},D.prototype.getUniqueIndex=function(e,t){var o=this.constraints.unique[e];return!o&&t?this.ensureUniqueIndex(e):o},D.prototype.ensureUniqueIndex=function(e){var t=this.constraints.unique[e];return t||-1==this.uniqueNames.indexOf(e)&&this.uniqueNames.push(e),this.constraints.unique[e]=t=new oe(e),this.data.forEach(function(o){t.set(o)}),t},D.prototype.ensureAllIndexes=function(e){var t,o=this.binaryIndices;for(t in o)B.call(o,t)&&this.ensureIndex(t,e)},D.prototype.flagBinaryIndexesDirty=function(){var e,t=this.binaryIndices;for(e in t)B.call(t,e)&&(t[e].dirty=!0)},D.prototype.flagBinaryIndexDirty=function(e){this.binaryIndices[e]&&(this.binaryIndices[e].dirty=!0)},D.prototype.count=function(e){return e?this.chain().find(e).filteredrows.length:this.data.length},D.prototype.ensureId=function(){if(!this.idIndex){for(var e=this.data,t=0,o=e.length,a=new Array(o);t<o;t++)a[t]=e[t].$loki;this.idIndex=a}},D.prototype.ensureIdAsync=function(e){this.async(function(){this.ensureId()},e)},D.prototype.addDynamicView=function(e,t){var o=new F(this,e,t);return this.DynamicViews.push(o),o},D.prototype.removeDynamicView=function(e){this.DynamicViews=this.DynamicViews.filter(function(t){return t.name!==e})},D.prototype.getDynamicView=function(e){for(var t=0;t<this.DynamicViews.length;t++)if(this.DynamicViews[t].name===e)return this.DynamicViews[t];return null},D.prototype.findAndUpdate=function(e,t){"function"==typeof e?this.updateWhere(e,t):this.chain().find(e).update(t)},D.prototype.findAndRemove=function(e){this.chain().find(e).remove()},D.prototype.insert=function(e,t){if(!Array.isArray(e))return this.insertOne(e);var o,a=[],c=t&&!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0;c&&(this.adaptiveBinaryIndices=!1);try{this.emit("pre-insert",e);for(var h=0,f=e.length;h<f;h++){if(!(o=this.insertOne(e[h],!0)))return;a.push(o)}}finally{c&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}return this.emit("insert",a),1===(a=this.cloneObjects?H(a,this.cloneMethod):a).length?a[0]:a},D.prototype.insertOne=function(e,t){var a,o=null;if("object"!=typeof e?o=new TypeError("Document needs to be an object"):null===e&&(o=new TypeError("Object cannot be null")),null!==o)throw this.emit("error",o),o;var c=this.cloneObjects?H(e,this.cloneMethod):e;if(this.disableFreeze||(c=L(c)),this.disableMeta||(typeof c.meta>"u"?c.meta={revision:0,created:0}:this.disableFreeze||(c.meta=L(c.meta))),t||this.emit("pre-insert",c),this.add(c))return this.disableChangesApi?this.insertMeta(c):this.insertMetaWithChange(c),this.disableFreeze||O(c),a=this.cloneObjects?H(c,this.cloneMethod):c,t||this.emit("insert",a),this.addAutoUpdateObserver(a),a},D.prototype.clear=function(e){var t=this;e=e||{},this.data=[],this.idIndex=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,this.constraints={unique:{},exact:{}},!0===e.removeIndices?(this.binaryIndices={},this.uniqueNames=[]):Object.keys(this.binaryIndices).forEach(function(a){t.binaryIndices[a].dirty=!1,t.binaryIndices[a].values=[]})},D.prototype.update=function(e){var t,o,a;if(Array.isArray(e)){a=e.length,(t=!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0)&&(this.adaptiveBinaryIndices=!1);try{for(o=0;o<a;o+=1)this.update(e[o])}finally{t&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}}else{if(!B.call(e,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();var h,f,g,E,x,c=this.get(e.$loki,!0),v=this;if(!c)throw new Error("Trying to update a document not in collection.");h=c[0],g=c[1],f=this.cloneObjects||!this.disableDeltaChangesApi&&this.disableFreeze?H(e,this.cloneMethod):e,this.emit("pre-update",e),this.uniqueNames.forEach(function(I){v.getUniqueIndex(I,!0).update(h,f)}),this.data[g]=f,f!==e&&this.addAutoUpdateObserver(e);for(var b=0;b<this.DynamicViews.length;b++)this.DynamicViews[b].evaluateDocument(g,!1);if(this.adaptiveBinaryIndices){var C=this.binaryIndices;for(E in C)this.adaptiveBinaryIndexUpdate(g,E)}else this.flagBinaryIndexesDirty();return this.idIndex[g]=f.$loki,this.isIncremental&&this.dirtyIds.push(f.$loki),this.commit(),this.dirty=!0,f=this.disableChangesApi?this.updateMeta(f):this.updateMetaWithChange(f,h),this.disableFreeze||O(f),x=this.cloneObjects?H(f,this.cloneMethod):f,this.emit("update",x,h),x}catch(I){throw this.rollback(),this.lokiConsoleWrapper.error(I.message),this.emit("error",I),I}}},D.prototype.add=function(e){if("object"!=typeof e)throw new TypeError("Object being added needs to be an object");if(typeof e.$loki<"u")throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1);var t=this.maxId;e.$loki=t,this.disableMeta||(e.meta.version=0);for(var o=0,a=this.uniqueNames.length;o<a;o++)this.getUniqueIndex(this.uniqueNames[o],!0).set(e);this.idIndex&&this.idIndex.push(t),this.isIncremental&&this.dirtyIds.push(t),this.data.push(e);var c=this.data.length-1,h=this.DynamicViews.length;for(o=0;o<h;o++)this.DynamicViews[o].evaluateDocument(c,!0);if(this.adaptiveBinaryIndices){var f=this.binaryIndices;for(var g in f)this.adaptiveBinaryIndexInsert(c,g)}else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?H(e,this.cloneMethod):e}catch(v){throw this.rollback(),this.lokiConsoleWrapper.error(v.message),this.emit("error",v),v}},D.prototype.updateWhere=function(e,t){var c,o=this.where(e),a=0;try{for(;a<o.length;a++)c=t(o[a]),this.update(c)}catch(h){this.rollback(),this.lokiConsoleWrapper.error(h.message)}},D.prototype.removeWhere=function(e){var t;"function"==typeof e?(t=this.data.filter(e),this.remove(t)):this.chain().find(e).remove()},D.prototype.removeDataOnly=function(){this.remove(this.data.slice())},D.prototype.removeBatchByPositions=function(e){var a,c,h,b,t=e.length,o={},f=Object.keys(this.binaryIndices).length,g=Object.keys(this.constraints.unique).length,v=this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0,E=this;try{for(this.startTransaction(),this.ensureId(),h=0;h<t;h++)o[this.idIndex[e[h]]]=!0;if((a=this.DynamicViews.length)>0||f>0||g>0){if(a>0)for(c=0;c<a;c++)this.DynamicViews[c].removeDocument(e);if(this.adaptiveBinaryIndices&&!v){var C,x=this.binaryIndices;for(C in x)this.adaptiveBinaryIndexRemove(e,C)}else this.flagBinaryIndexesDirty();g&&this.uniqueNames.forEach(function(I){var A=E.getUniqueIndex(I);if(A)for(h=0;h<t;h++)null!=(b=E.data[e[h]])[I]&&A.remove(b[I])})}if(!this.disableChangesApi||this.events.delete.length>1)for(h=0;h<t;h++)this.emit("delete",this.data[e[h]]);if(this.data=this.data.filter(function(I){return!o[I.$loki]}),this.isIncremental)for(h=0;h<t;h++)this.dirtyIds.push(this.idIndex[e[h]]);this.idIndex=this.idIndex.filter(function(I){return!o[I]}),this.adaptiveBinaryIndices&&v&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(I){return this.rollback(),v&&(this.adaptiveBinaryIndices=!0),this.lokiConsoleWrapper.error(I.message),this.emit("error",I),null}},D.prototype.removeBatch=function(e){var a,t=e.length,o=this.data.length,c={},h=[];for(a=0;a<o;a++)c[this.data[a].$loki]=a;for(a=0;a<t;a++)h.push("object"==typeof e[a]?c[e[a].$loki]:c[e[a]]);this.removeBatchByPositions(h)},D.prototype.remove=function(e){if("number"==typeof e&&(e=this.get(e)),"object"!=typeof e)throw new Error("Parameter is not an object");if(Array.isArray(e))this.removeBatch(e);else{if(!B.call(e,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();var o=this.get(e.$loki,!0),a=o[1],c=this;this.uniqueNames.forEach(function(v){if(null!==e[v]&&typeof e[v]<"u"){var b=c.getUniqueIndex(v);b&&b.remove(e[v])}});for(var h=0;h<this.DynamicViews.length;h++)this.DynamicViews[h].removeDocument(a);if(this.adaptiveBinaryIndices){var f,g=this.binaryIndices;for(f in g)this.adaptiveBinaryIndexRemove(a,f)}else this.flagBinaryIndexesDirty();return this.data.splice(a,1),this.removeAutoUpdateObserver(e),this.idIndex.splice(a,1),this.isIncremental&&this.dirtyIds.push(e.$loki),this.commit(),this.dirty=!0,this.emit("delete",o[0]),this.disableFreeze||(e=L(e)),delete e.$loki,delete e.meta,this.disableFreeze||i(e),e}catch(v){return this.rollback(),this.lokiConsoleWrapper.error(v.message),this.emit("error",v),null}}},D.prototype.get=function(e,t){this.idIndex||this.ensureId();var o=t||!1,a=this.idIndex,c=a.length-1,h=0,f=h+c>>1;if(e="number"==typeof e?e:parseInt(e,10),isNaN(e))throw new TypeError("Passed id is not an integer");for(;a[h]<a[c];)a[f=h+c>>1]<e?h=f+1:c=f;return c===h&&a[h]===e?o?[this.data[h],h]:this.data[h]:null},D.prototype.getBinaryIndexPosition=function(e,t){var o=y.getIn(this.data[e],t,!0),a=this.binaryIndices[t].values,c=this.calculateRange("$eq",t,o);if(0===c[0]&&-1===c[1])return null;for(var f=c[1],g=c[0];g<=f;g++)if(a[g]===e)return g;return null},D.prototype.adaptiveBinaryIndexInsert=function(e,t){var o=-1!==t.indexOf("."),a=this.binaryIndices[t].values,c=y.getIn(this.data[e],t,o);!0===this.serializableIndices&&c instanceof Date&&(this.data[e][t]=c.getTime(),c=y.getIn(this.data[e],t));var h=0===a.length?0:this.calculateRangeStart(t,c,!0,o);this.binaryIndices[t].values.splice(h,0,e)},D.prototype.adaptiveBinaryIndexUpdate=function(e,t){var o,a=this.binaryIndices[t].values,c=a.length;for(o=0;o<c&&a[o]!==e;o++);this.binaryIndices[t].values.splice(o,1),this.adaptiveBinaryIndexInsert(e,t)},D.prototype.adaptiveBinaryIndexRemove=function(e,t,o){var c,h,f,g,b,E,C,a=this.binaryIndices[t],v={};if(Array.isArray(e)){if(1!==(g=e.length)){for(f=0;f<g;f++)v[e[f]]=!0;if(a.values=a.values.filter(function(I){return!v[I]}),!0===o)return;var x=e.slice();for(x.sort(function(I,A){return I-A}),c=a.values.length,h=0;h<c;h++){for(b=a.values[h],E=0,f=0;f<g&&b>x[f];f++)E++;a.values[h]-=E}return}e=e[0]}if(null===(C=this.getBinaryIndexPosition(e,t)))return null;if(a.values.splice(C,1),!0!==o)for(c=a.values.length,h=0;h<c;h++)a.values[h]>e&&a.values[h]--},D.prototype.calculateRangeStart=function(e,t,o,a){var c=this.data,h=this.binaryIndices[e].values,f=0,g=h.length-1,v=0;if(0===h.length)return-1;for(y.getIn(c[h[f]],e,a),y.getIn(c[h[g]],e,a);f<g;)S.lt(y.getIn(c[h[v=f+g>>1]],e,a),t,!1)?f=v+1:g=v;var C=f;return S.aeq(t,y.getIn(c[h[C]],e,a))?C:S.lt(t,y.getIn(c[h[C]],e,a),!1)?o?C:C-1:o?C+1:C},D.prototype.calculateRangeEnd=function(e,t,o){var a=this.data,c=this.binaryIndices[e].values,h=0,f=c.length-1,g=0;if(0===c.length)return-1;for(y.getIn(a[c[h]],e,o),y.getIn(a[c[f]],e,o);h<f;)S.lt(t,y.getIn(a[c[g=h+f>>1]],e,o),!1)?f=g:h=g+1;var E=f;return S.aeq(t,y.getIn(a[c[E]],e,o))?E:S.gt(t,y.getIn(a[c[E]],e,o),!1)?E+1:S.aeq(t,y.getIn(a[c[E-1]],e,o))?E-1:E},D.prototype.calculateRange=function(e,t,o){var v,b,E,a=this.data,c=this.binaryIndices[t].values,f=c.length-1;if(0===a.length)return[0,-1];var x=-1!==t.indexOf("."),I=y.getIn(a[c[0]],t,x),A=y.getIn(a[c[f]],t,x);switch(e){case"$eq":case"$aeq":case"$dteq":if(S.lt(o,I,!1)||S.gt(o,A,!1))return[0,-1];break;case"$gt":if(S.gt(o,A,!0))return[0,-1];if(S.gt(I,o,!1))return[0,f];break;case"$gte":if(S.gt(o,A,!1))return[0,-1];if(S.gt(I,o,!0))return[0,f];break;case"$lt":if(S.lt(o,I,!0))return[0,-1];if(S.lt(A,o,!1))return[0,f];break;case"$lte":if(S.lt(o,I,!1))return[0,-1];if(S.lt(A,o,!0))return[0,f];break;case"$between":return S.gt(o[0],A,!1)||S.lt(o[1],I,!1)?[0,-1]:((v=this.calculateRangeStart(t,o[0],!1,x))<0&&v++,(E=this.calculateRangeEnd(t,o[1],x))>f&&E--,S.gt(y.getIn(a[c[v]],t,x),o[0],!0)||v++,S.lt(y.getIn(a[c[E]],t,x),o[1],!0)||E--,E<v?[0,-1]:[v,E]);case"$in":for(var q=[],ee=[],X=0,z=o.length;X<z;X++)for(var Q=this.calculateRange("$eq",t,o[X]),le=Q[0];le<=Q[1];le++)void 0===q[le]&&(q[le]=!0,ee.push(le));return ee}switch(e){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":v=this.calculateRangeStart(t,o,!1,x),b=y.getIn(a[c[v]],t,x)}switch(e){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":E=this.calculateRangeEnd(t,o,x),y.getIn(a[c[E]],t,x)}switch(e){case"$eq":case"$aeq":case"$dteq":return S.aeq(b,o)?[v,E]:[0,-1];case"$gt":return S.aeq(y.getIn(a[c[E]],t,x),o)?[E+1,f]:[E,f];case"$gte":return S.aeq(y.getIn(a[c[v]],t,x),o)?[v,f]:[v+1,f];case"$lt":return S.aeq(y.getIn(a[c[v]],t,x),o)?[0,v-1]:[0,v];case"$lte":return S.aeq(y.getIn(a[c[E]],t,x),o)?[0,E]:[0,E-1];default:return[0,a.length-1]}},D.prototype.by=function(e,t){var o;if(void 0===t)return o=this,function(c){return o.by(e,c)};var a=this.getUniqueIndex(e,!0).get(t);return this.cloneObjects?H(a,this.cloneMethod):a},D.prototype.findOne=function(e){e=e||{};var t=this.chain().find(e,!0).data();return Array.isArray(t)&&0===t.length?null:this.cloneObjects?H(t[0],this.cloneMethod):t[0]},D.prototype.chain=function(e,t){var o=new M(this);return typeof e>"u"?o:o.transform(e,t)},D.prototype.find=function(e){return this.chain().find(e).data()},D.prototype.findOneUnindexed=function(e,t){for(var o=this.data.length;o--;)if(y.getIn(this.data[o],e,!0)===t)return this.data[o];return null},D.prototype.startTransaction=function(){if(this.transactional){this.cachedData=H(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices,this.cachedDirtyIds=this.dirtyIds;for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].startTransaction()}},D.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedDirtyIds=null;for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].commit()}},D.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex,this.dirtyIds=this.cachedDirtyIds);for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].rollback()}},D.prototype.async=function(e,t){setTimeout(function(){if("function"!=typeof e)throw new TypeError("Argument passed for async execution is not a function");e(),t()},0)},D.prototype.where=function(e){return this.chain().where(e).data()},D.prototype.mapReduce=function(e,t){try{return t(this.data.map(e))}catch(o){throw o}},D.prototype.eqJoin=function(e,t,o,a,c){return new M(this).eqJoin(e,t,o,a,c)},D.prototype.stages={},D.prototype.getStage=function(e){return this.stages[e]||(this.stages[e]={}),this.stages[e]},D.prototype.commitLog=[],D.prototype.stage=function(e,t){var o=JSON.parse(JSON.stringify(t));return this.getStage(e)[t.$loki]=o,o},D.prototype.commitStage=function(e,t){var a,o=this.getStage(e),c=(new Date).getTime();for(a in o)this.update(o[a]),this.commitLog.push({timestamp:c,message:t,data:JSON.parse(JSON.stringify(o[a]))});this.stages[e]={}},D.prototype.no_op=function(){},D.prototype.extract=function(e){for(var t=0,o=this.data.length,a=ke(e),c=[];t<o;t+=1)c.push(he(this.data[t],e,a));return c},D.prototype.max=function(e){return Math.max.apply(null,this.extract(e))},D.prototype.min=function(e){return Math.min.apply(null,this.extract(e))},D.prototype.maxRecord=function(e){for(var h,t=0,o=this.data.length,a=ke(e),c={index:0,value:void 0};t<o;t+=1)void 0!==h?h<he(this.data[t],e,a)&&(h=he(this.data[t],e,a),c.index=this.data[t].$loki):(h=he(this.data[t],e,a),c.index=this.data[t].$loki);return c.value=h,c},D.prototype.minRecord=function(e){for(var h,t=0,o=this.data.length,a=ke(e),c={index:0,value:void 0};t<o;t+=1)void 0!==h?h>he(this.data[t],e,a)&&(h=he(this.data[t],e,a),c.index=this.data[t].$loki):(h=he(this.data[t],e,a),c.index=this.data[t].$loki);return c.value=h,c},D.prototype.extractNumerical=function(e){return this.extract(e).map(Ye).filter(Number).filter(function(t){return!isNaN(t)})},D.prototype.avg=function(e){return Te(this.extractNumerical(e))},D.prototype.stdDev=function(e){return function Ae(e){var t=Te(e),a=Te(e.map(function(h){var f=h-t;return f*f}));return Math.sqrt(a)}(this.extractNumerical(e))},D.prototype.mode=function(e){var a,c,h,t={},o=this.extract(e);for(c in o.forEach(function(f){t[f]?t[f]+=1:t[f]=1}),t)a?a<t[c]&&(h=c):(h=c,a=t[c]);return h},D.prototype.median=function(e){var t=this.extractNumerical(e);t.sort(Re);var o=Math.floor(t.length/2);return t.length%2?t[o]:(t[o-1]+t[o])/2},Le.prototype={keys:[],values:[],sort:function(e,t){return e<t?-1:e>t?1:0},setSort:function(e){this.bs=new ve(e)},bs:function(){return new ve(this.sort)},set:function(e,t){var o=this.bs(this.keys,e);o.found?this.values[o.index]=t:(this.keys.splice(o.index,0,e),this.values.splice(o.index,0,t))},get:function(e){return this.values[de(this.keys,e,this.sort).index]}},oe.prototype.keyMap={},oe.prototype.lokiMap={},oe.prototype.set=function(e){var t=e[this.field];if(null!==t&&typeof t<"u"){if(this.keyMap[t])throw new Error("Duplicate key for property "+this.field+": "+t);this.keyMap[t]=e,this.lokiMap[e.$loki]=t}},oe.prototype.get=function(e){return this.keyMap[e]},oe.prototype.byId=function(e){return this.keyMap[this.lokiMap[e]]},oe.prototype.update=function(e,t){if(this.lokiMap[e.$loki]!==t[this.field]){var o=this.lokiMap[e.$loki];this.set(t),this.keyMap[o]=void 0}else this.keyMap[e[this.field]]=t},oe.prototype.remove=function(e){var t=this.keyMap[e];if(!(null!==t&&typeof t<"u"))throw new Error("Key is not in unique index: "+this.field);this.keyMap[e]=void 0,this.lokiMap[t.$loki]=void 0},oe.prototype.clear=function(){this.keyMap=Object.create(null),this.lokiMap=Object.create(null)},_e.prototype={set:function(t,o){this.index[t]?this.index[t].push(o):this.index[t]=[o]},remove:function(t,o){var a=this.index[t];for(var c in a)a[c]==o&&a.splice(c,1);a.length<1&&(this.index[t]=void 0)},get:function(t){return this.index[t]},clear:function(t){this.index={}}},P.deepFreeze=O,P.freeze=i,P.unFreeze=L,P.LokiOps=ne,P.Collection=D,P.DynamicView=F,P.Resultset=M,P.KeyValueStore=Le,P.LokiMemoryAdapter=ye,P.LokiPartitioningAdapter=ue,P.LokiLocalStorageAdapter=fe,P.LokiFsAdapter=me,P.persistenceAdapters={fs:me,localStorage:fe},P.aeq=R,P.lt=$,P.gt=Y,P.Comparators=S,P}()},void 0!==(G=j.apply(Ie,[]))&&(He.exports=G)}}]);